<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Fluxus Frequency]]></title>
  <link href="http://fluxusfrequency.github.io/atom.xml" rel="self"/>
  <link href="http://fluxusfrequency.github.io/"/>
  <updated>2014-09-12T06:32:19-06:00</updated>
  <id>http://fluxusfrequency.github.io/</id>
  <author>
    <name><![CDATA[Ben Lewis]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
    <title type="html"><![CDATA[Looking For A Needle In A Haystack! (or Using Ack To Improve Your Development Workflow)]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/09/04/looking-for-a-needle-in-a-haystack-with-ack/"/>
    
    <updated>2014-09-04T06:19:42-06:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/09/04/looking-for-a-needle-in-a-haystack-with-ack</id>
    
    <content type="html"><![CDATA[<p>This post originally appeared on the <a href="http://quickleft.com/blog/looking-for-a-needle-in-a-haystack-or-using-ack-to-improve-your-development-workflow">Quick Left Blog</a>.</p>

<p>Every day when I&rsquo;m programming, I invariably come to a point where I&rsquo;m looking for a certain line of code in my project. I could just use my editor&rsquo;s &ldquo;find in files&rdquo; feature and look for it, but sometimes I need more fine grained control. What if I want to find all the lines of code that don&rsquo;t contain a certain phrase? What if I want to search on a Regular Expression? What if I want to easily save the search results to a file?</p>

<p>When I need MOAR POWER in finding something, I turn my favorite command line search tool: ack. In this blog post, we&rsquo;ll explore the ins and outs of this fantastic application.</p>

<p><a href="http://quickleft.com/blog/looking-for-a-needle-in-a-haystack-or-using-ack-to-improve-your-development-workflow">Read more</a></p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[AngularJS Unit Testing, For Real Though]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/07/24/angular-js-unit-testing-for-real-though/"/>
    
    <updated>2014-07-24T06:20:37-06:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/07/24/angular-js-unit-testing-for-real-though</id>
    
    <content type="html"><![CDATA[<p>This post originally appeared on the <a href="http://quickleft.com/blog/angularjs-unit-testing-for-real-though">Quick Left Blog</a>.</p>

<p>When it comes to contemporary web development, AngularJS is the new hotness. Its unique approach to HTML compilation and two-way data binding make it an effective tool for efficiently building client-side web apps. But when it comes to the testing, many tutorials on the interwebs hand-wave testing. This article covers some of the &ldquo;gotchas&rdquo; you&rsquo;ll come across when trying to test Angular. Let&rsquo;s build our chops, so we can get into a &ldquo;Red-Green-Refactor&rdquo; flow when testing Angular.</p>

<p><a href="http://quickleft.com/blog/angularjs-unit-testing-for-real-though">Read more</a></p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Five Capybara Hacks To Make Your Testing Experience Less Painful]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/05/20/five-capybara-hacks-to-make-your-testing-experience-less-painful/"/>
    
    <updated>2014-05-20T06:20:08-06:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/05/20/five-capybara-hacks-to-make-your-testing-experience-less-painful</id>
    
    <content type="html"><![CDATA[<p>This post originally appeared on the <a href="http://quickleft.com/blog/five-capybara-hacks-to-make-your-testing-experience-less-painful">Quick Left Blog</a>.</p>

<p>Everyone knows it&rsquo;s important to test your code. But sometimes, the experience can be a little bit painful. Ok, sometimes it&rsquo;s very painful. Like when you&rsquo;re trying to feature test a JavaScript-heavy Rails app.</p>

<p>What to do? Abandon the tests? Never! Smokey, this is not &lsquo;Nam. This is coding. There are rules.</p>

<p><a href="http://quickleft.com/blog/five-capybara-hacks-to-make-your-testing-experience-less-painful">Read more</a></p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Service Oriented Architecture]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/02/14/service-oriented-architecture/"/>
    
    <updated>2014-02-14T06:40:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/02/14/service-oriented-architecture</id>
    
    <content type="html"><![CDATA[<p>We just finished up our penultimate project at gSchool, an application built using a Service Oriented Architecture (SOA). The project ideas were generated in small groups, and focused a the theme of health and wellness. Once the ideas were decided, our teacher Jeff Casimir generated a randomized list of the students, and we drafted projects.</p>

<p>I went first, and selected an idea that was close to my heart: an app to help home vegetable gardeners plan out their beds for the season. Having spent several years as an organic farm worker, garden company owner, and home garden hobbyist, I was excited to use this app. Every spring, before the ground warms up, my partner and I sit down with a pencel and graph paper to plan out the different beds in my garden: what will go where, how it will be spaced, when it will be harvested, and what we&rsquo;ll plant there afterwards.</p>

<p>I had big hopes for our project, dubbed <a href="http://plantingseason.tk">Planting Season</a> (<a href="https://github.com/VirginSoil">code</a>). A user would have several gardens, each with many beds. The app would keep track of her plans from month to month, and she would be able to click on a month to see what she&rsquo;d planned to plant there, which spots were empty, and which plants were ready for harvest. It would find her USDA Hardiness Zone and suggest plants well-suited to grow there. If there was impending frost, or a bed needed water, it would send her a text message, email, or a Google voice message.</p>

<p>Ah, the dreams of the young and inexperienced&hellip;</p>

<h2>Planting Season&rsquo;s Structure</h2>

<p>Two of my group members had just completed <a href="https://github.com/foofoberry">FooFoBerry</a>, an SOA app that exposed and consumed APIs from various project management tools, such as GitHub, Travis, and Code Climate. With their experience setting up services, I figured that getting the project up and running would be a breeze. In practice, it was more challenging than I expected.</p>

<p>I&rsquo;m a big fan of a &ldquo;lean startup&rdquo; / &ldquo;minimum viable product&rdquo; approach in my projects. I like to get a simple product up as fast as possible, then expand on it, adding value. Given that we had three weeks, we planned three iterations for Planting Season:</p>

<p>Week 1 - Put up a landing page where users could enter their email to be notified when the app was ready.</p>

<p>Week 2 - Change the landing page to allow users to sign up or sign in, then send them to a dashboard page, where they could add and remove plants from a single garden.</p>

<p>Week 3 - Add functionality for multiple beds, text and email weather notifications, and a timeline for the garden through the year.</p>

<p>With this functionality in mind, we decided to build the following services:</p>

<ol>
<li>Landing Page App</li>
<li>User Authentication App</li>
<li>Client-Facing Dashboard (&ldquo;Coordinator&rdquo;) App</li>
<li>RESTful JSON API with Bed and Plant data</li>
<li>A gem to facilitate communication between the Dashboard and the API</li>
<li>External Services - Weather and Geolocation APIs</li>
</ol>


<p>Here&rsquo;s how the project ended up looking in the end:</p>

<p><br /></p>

<p><img class="center" src="http://s5.postimg.org/w893s8cuf/planting_season_graph.png" title="Planting Season Project Structure" alt="A web application diagram"></p>

<h2>Project Management &amp; Workflow</h2>

<p>Over the course of gSchool, I&rsquo;ve been learning a lot about the social aspect programming. I worked solo in my ealiest projects, then graduated to pairing, and later went on to work in groups of three or four. In the beginning, I was just doing my own thing, but as I started getting into the larger groups, project management became a key skill. I&rsquo;ve found myself in the role of Project Manager in many successive projects. The first couple of times were messy: I didn&rsquo;t make enough space for people to express how they were <em>feeling</em> at our standups, our iteration planning was nonexistent, and I didn&rsquo;t understand how to use Pivotal Tracker at all. As I learned from these experiences, I began to firmly value things like daily standups with technical <em>and</em> emotional checkins, persona and wireframing UX design, iteration planning, proper use of Pivotal Tracker, consistent version control practices, and continuous integration.</p>

<p>We started Planting Season with the best of intentions, but this time around, it proved harder to practice these strategies than I hoped. At our checkins, it was clear that we were all feeling unfocused and pulled in different directions by job applications and interviews, burnout, and Jeff&rsquo;s absence after his wife gave birth to their latest addition to the family. We planned our iterations, but we didn&rsquo;t meet the first one because a couple of us were out of town or at interviews. Soon we fell behind. On top of that, Pivotal Tracker stopped letting us edit our stories, because our free trial was expired. The Travis CI specs wouldn&rsquo;t pass, because the specs couldn&rsquo;t talk to the API (more on this in a minute). Of all the agile practices we hoped to use, only the UX planning went well.</p>

<h2>Nginx, Passenger, and VPS Woes</h2>

<p>Our troubles were compounded by the difficulty of getting our services to talk to each other. Our plan was to run Foreman locally, booting our apps onto different ports on localhost, then use Nginx to route everything through different namespaced routes on port 8080. Getting Foreman up and running was easy enough, but Nginx was a bear to configure. Meanwhile, getting Phusion Passenger and Nginx to play nicely on our VPS was also a struggle. It turns out that you have to install Passenger first, then add Nginx as an extension to it. If you install Nginx first, you end up with two conflicting versions. Additionally, one of our team mates was having RVM issues, and had to reinstall Ruby and all of his gems twice.</p>

<p>In the second week, we lost two solid days of of development time to the fight with the Nginx config file, Passenger, and RVM.</p>

<p>For posterity&rsquo;s sake, here&rsquo;s a snapshot of the <code>nginx.conf</code> file that finally worked for local production:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>worker_processes  1<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>error_log  logs/error.log<span class="p">;</span>
</span><span class='line'><span class="c">#pid        logs/nginx.pid;</span>
</span><span class='line'>
</span><span class='line'>events <span class="o">{</span>
</span><span class='line'>    worker_connections  1024<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>http <span class="o">{</span>
</span><span class='line'>    include       mime.types<span class="p">;</span>
</span><span class='line'>    default_type  application/octet-stream<span class="p">;</span>
</span><span class='line'>    <span class="c">#passenger_root /usr/local/opt/passenger/libexec/lib/phusion_passenger/locations.ini;</span>
</span><span class='line'>    <span class="c">#passenger_ruby /usr/bin/ruby;</span>
</span><span class='line'>
</span><span class='line'>    server <span class="o">{</span>
</span><span class='line'>        listen       8080<span class="p">;</span>
</span><span class='line'>        server_name  localhost<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># PLANTING SEASON</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Landing Page</span>
</span><span class='line'>        location / <span class="o">{</span>
</span><span class='line'>          proxy_pass        http://127.0.0.1:3000<span class="p">;</span>
</span><span class='line'>          proxy_set_header  X-Real-IP  <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Auth</span>
</span><span class='line'>        location /auth <span class="o">{</span>
</span><span class='line'>          proxy_pass        http://127.0.0.1:3001<span class="p">;</span>
</span><span class='line'>          proxy_set_header  X-Real-IP  <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Coordinator</span>
</span><span class='line'>        location /dashboard <span class="o">{</span>
</span><span class='line'>          proxy_pass        http://127.0.0.1:3002<span class="p">;</span>
</span><span class='line'>          proxy_set_header  X-Real-IP  <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># API</span>
</span><span class='line'>        location /api <span class="o">{</span>
</span><span class='line'>          proxy_pass        http://127.0.0.1:3003<span class="p">;</span>
</span><span class='line'>          proxy_set_header  X-Real-IP  <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Troubles</h2>

<p>Once we had the services running on a single port, we figured everything would be gravy. We added the VCR gem to save the results of our API calls, and began testing. We covered the landing page, auth app, and our gem.</p>

<p>Then I started to dig in on some Capybara tests for the coordinator app, and had some major headaches. In order to view the dashboard, I needed to set a signed cookie to simulate the authorization app. Easy enough. All you have to do is use:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">page</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">set_cookie</span> <span class="s1">&#39;user_id=1&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That is, unless you&rsquo;re using Poltergeist for a JS driver. Then, you clearly use:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">page</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>But now, I had a different problem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Failure/Error: within <span class="s1">&#39;#bed-functions&#39;</span> <span class="k">do</span>
</span><span class='line'>     Capybara::ElementNotFound:
</span><span class='line'>       Unable to find css <span class="s2">&quot;#bed-functions&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using the launchy gem and <code>save_and_open_page</code>, <code>#bed-functions</code> was there, all right. I could feel another configuration battle coming on as we headed into the third week.</p>

<h2>Getting Back on the Horse</h2>

<p>On Monday morning of the week the project was due, we had little to show for our two weeks of work. There were services, but they couldn&rsquo;t talk to each other on the server. There were mock-ups, but the CSS wasn&rsquo;t in the views yet. The tests were thin. We had a meeting with Jeff, and told him we planned to bolster the test coverage and solidify what we already had. His advice: &ldquo;that would be  a good idea if you had a thing, but right now you don&rsquo;t. You might want to make a thing first.&rdquo;</p>

<p>So we saddled up, and the cowboy coding began.</p>

<h2>jQuery Sparkle</h2>

<p>The next two days were actually pretty fun, if a little painful (coding without tests makes me uncomfortable). We got the CSS hooked up, integrated with the weather service, and added a healthy dose of JavaScript to the dashboard. Although we would have liked to explore Ember.js, we decided to stick to plain old jQuery in the interest of time. We quickly coded 275 lines of jQuery sparkle, and we had a thing! If you&rsquo;re interested, go <a href="http://plantingseason.tk/">check out</a> what we made!</p>

<p>My favorite part was adding the ability to click and drag on the garden bed squares for multi-selection. Here&rsquo;s what that looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">thisClass</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">toggleSquare</span><span class="p">(</span><span class="nx">thisClass</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>   <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">isMouseDown</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">thisClass</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">toggleSquare</span><span class="p">(</span><span class="nx">thisClass</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">mouseup</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you want to see more of what we did with the JS, you can check out the <a href="https://github.com/VirginSoil/planting_season_coordinator/tree/master/app/assets/javascripts">code on GitHub</a>.</p>

<h2>Conclusion</h2>

<p>From the beginning of gSchool, the SOA project was one of the things I was looking forward to the most. Although Jeff said he thought that it was probably &ldquo;not a reasonable thing&rdquo; to start a project from the beginning with SOA, I set out with the highest of expectations. But the problems along the way were numerous.</p>

<p>The job search was a distraction. But more troubling to me was the difficulty of testing. I&rsquo;ve gotten really comfortable with using Travis CI, and driving my development with Pivotal Tracker user stories translated into Capybara feature tests. It was really hard to do with services. Between setting up Passenger and Nginx and the testing troubles, we lost a <em>lot</em> of time on configuration.</p>

<p>Reflecting on the experience, I&rsquo;d say that SOA is probably a practice better left until it is needed. If I were in charge building a new app for a startup, I would still start by iterate on delivering business value with successive MVPs. When I began to feel the pain of scaling, then I would think about splitting off services.</p>

<p>However, it&rsquo;s possible that I&rsquo;ve only come to this conclusion because the process was so painful. There&rsquo;s another way of looking at this.</p>

<p>Here&rsquo;s a lesson that I&rsquo;ve learned about programming again and again over the last six months:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">The</span> <span class="nx">first</span> <span class="nx">time</span> <span class="nx">you</span> <span class="k">do</span> <span class="nx">something</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">hard</span> <span class="nx">and</span> <span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">make</span> <span class="nx">any</span> <span class="nx">sense</span><span class="p">.</span>
</span><span class='line'><span class="nx">The</span> <span class="nx">second</span> <span class="nx">time</span> <span class="nx">you</span> <span class="k">do</span> <span class="nx">it</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">seems</span> <span class="nx">vaguely</span> <span class="nx">familiar</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">makes</span> <span class="nx">a</span> <span class="nx">little</span> <span class="nx">bit</span> <span class="nx">of</span> <span class="nx">sense</span><span class="p">.</span>
</span><span class='line'><span class="nx">From</span> <span class="nx">then</span> <span class="nx">on</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">makes</span> <span class="nx">sense</span> <span class="nx">and</span> <span class="nx">feels</span> <span class="nx">natural</span> <span class="nx">to</span> <span class="k">do</span> <span class="nx">it</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>If this is true (which it seems to be for me), then it might actually make sense to build apps using services from the get go, if you expect them to have to scale down the road. I&rsquo;d love to nail down a workflow for getting Passenger, Foreman, and Nginx set up in less than 30 minutes. I&rsquo;d also like to learn how to better test services and get them set up with continuous integration. I think that if I understood these things, SOA would be a tool I&rsquo;d be a lot more likely to reach for.</p>

<p>If you have any tips about these two aspects of services, let&rsquo;s talk! Tweet at me: @fluxusfrequency.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Building a Binary Search]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/31/building-a-binary-search/"/>
    
    <updated>2014-01-31T10:34:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/31/building-a-binary-search</id>
    
    <content type="html"><![CDATA[<p>A couple of days ago I had an interview with a big startup in Boulder. I was really excited about the possibility of working there, because they solve some <em>really</em> hard problems on a daily basis, and because I&rsquo;ve heard great things about their office culture.</p>

<p>It was just supposed to be a quick interview, but it ended up taking a few hours. First, I met up with the CTO. It all started off innocent enough. We went to a restaurant on Pearl Street for lunch. He asked me about my background and skills, and I asked him about the company. We shared personal stories about the flood last summer. After hearing about the way he treats his workers (like adults), and some of the technical details of what they were working on, I was even more excited about the company. We headed went to a coffee shop for a drink, then went back to the office.</p>

<p>When we got there, he introduced me to the head of the team that the best fit for me if I worked there. The team lead, one of his coworkers and I headed back to the coffee shop. We chatted about Rails, <a href="http://www.exercism.io">Exercism</a>, TDD, and Ember.js, and life at their company. Pretty soon, the CTO came in again. Seeing that we were still talking, he asked the team lead to take me back and &ldquo;dig in technically&rdquo; a little bit.</p>

<p>We went back to the office again, and found a conference room. He asked me to solve <a href="http://en.wikipedia.org/wiki/Fizz_buzz">FizzBuzz</a> in JavaScript. I fired up Jasmine-Node and built it with tests the whole way. That went fairly well, I thought. Then he asked me a couple of CSS questions. I answered them, and he said that I answered them better than many of the people he interviews.</p>

<p>Finally, we came to some algorithm questions. Although I&rsquo;ve learned a lot at gSchool in the last five months, algorithms are something that I haven&rsquo;t spent as much time on, yet. I&rsquo;ve only had enough programming context to begin understanding them for the last two of those months. I&rsquo;ve played around with them as much as I could, solving Linked List, the Luhn Algorithm, Nth Prime Factor, Sum of Squares, and Binary Search Tree. I&rsquo;ve also had a go at writing the MD5 algorithm. But compared to someone with a four year CS degree, I haven&rsquo;t had much time to get comfortable with them.</p>

<p>My interviewer drew an array on the board, and asked me how I would find a given element&rsquo;s position within 2-3 queries. I thought about it, made a guess that it had to do with bit operators, and finally conceded that I had no idea. My heart sunk. Things were going so well. When I asked for the solution, he told me that it was to use a Binary Search. I got excited, because I <em>had</em> done a Binary Search Tree. But no, this was just plain old Binary Search.</p>

<p>Bitten that I didn&rsquo;t know how to do Binary Search, I set out to build it on my own. This rest of this post is a walkthrough of how I solved it.</p>

<h2>Research</h2>

<p>First, I visited Wikipedia and read up on <a href="http://en.wikipedia.org/wiki/Binary_search_algorithm">Binary Search</a>. It was pretty easy to follow. So easy, in fact, I decided to lift some of the text verbatim and translate it into a set of tests to drive my implementation. Here&rsquo;s what I found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Searching a sorted collection is a common task. A dictionary is a sorted list of
</span><span class='line'> word definitions. Given a word, one can find its definition. A telephone book
</span><span class='line'> is a sorted list of people's names, addresses, and telephone numbers. Knowing
</span><span class='line'> someone's name allows one to quickly find their telephone number and address.
</span><span class='line'>
</span><span class='line'>If the list to be searched contains more than a few items (a dozen, say) a
</span><span class='line'>binary search will require far fewer comparisons than a linear search, but it
</span><span class='line'>imposes the requirement that the list be sorted.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>In computer science, a binary search or half-interval search algorithm finds
</span><span class='line'>the position of a specified input value (the search "key") within an array
</span><span class='line'>sorted by key value.
</span><span class='line'>
</span><span class='line'>In each step, the algorithm compares the search key value with the key value of
</span><span class='line'>the middle element of the array.
</span><span class='line'>
</span><span class='line'>If the keys match, then a matching element has been found and its index, or
</span><span class='line'>position, is returned.
</span><span class='line'>
</span><span class='line'>Otherwise, if the search key is less than the middle element's key, then the
</span><span class='line'>algorithm repeats its action on the sub-array to the left of the middle element
</span><span class='line'>or, if the search key is greater, on the sub-array to the right.
</span><span class='line'>
</span><span class='line'>If the remaining array to be searched is empty, then the key cannot be found in
</span><span class='line'>the array and a special "not found" indication is returned.
</span><span class='line'>
</span><span class='line'>A binary search halves the number of items to check with each iteration, so
</span><span class='line'>locating an item (or determining its absence) takes logarithmic time. A binary
</span><span class='line'>search is a dichotomic divide and conquer search algorithm.</span></code></pre></td></tr></table></div></figure>


<p>I decided to take this step-by-step description and turn each step into a test.</p>

<h2>Setting Up the Binary Search Test &amp; Class</h2>

<p>The first step was to create an object that knew about &ldquo;an array sorted by key value&rdquo;, or as I like to call it, a list. I wrote a test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BinarySearchTest</span> <span class="o">&lt;</span> <span class="no">MiniTest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_it_has_list_data</span>
</span><span class='line'>    <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">list</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And a class to make it pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BinarySearch</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:list</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@list</span> <span class="o">=</span> <span class="n">data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That was easy! Next, it needed to be able to check whether the list was actually sorted, so I wrote a test to make sure it would throw an error if it wasn&rsquo;t:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_raises_error_for_unsorted_list</span>
</span><span class='line'>  <span class="n">assert_raises</span> <span class="no">ArgumentError</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make it pass, I implemented the following check: compare the input with itself in sorted form. Not that elegant, but it worked:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BinarySearch</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:list</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="k">raise</span> <span class="no">ArgumentError</span> <span class="k">unless</span> <span class="n">data</span><span class="o">.</span><span class="n">sort</span> <span class="o">==</span> <span class="n">data</span>
</span><span class='line'>    <span class="vi">@list</span> <span class="o">=</span> <span class="n">data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>According to the Wikipedia article, the algorithm was going to have to find &ldquo;the key value of the middle element of the array&rdquo;. So I wrote a test to make sure that it knew where the middle of its list was:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_finds_position_of_middle_item</span>
</span><span class='line'>  <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">3</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">middle</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was fairly trivial to solve:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BinarySearch</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:list</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">middle</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the class all set up, I turned my attention to the actual search algorithm itself.</p>

<h2>Building the Search Algorithm</h2>

<p>The goal was to search for the index of a specific element, so I wrote a test for a method that did that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_finds_position_of_search_data</span>
</span><span class='line'>  <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next came the hard part. I took the text from Wikipedia and broke it down into pseudo-code:</p>

<ul>
<li>Get the search value</li>
<li>Find the middle element in the list</li>
<li>Check if they are equal</li>
<li>If they are equal, return the position of the middle element in the list</li>
<li>If they are not equal, branch:</li>
</ul>


<p>If the search key is less than the middle index:</p>

<ul>
<li>Cut the list we&rsquo;re searching in half</li>
<li>Instantiate a new BinarySearch</li>
<li>Pass the first half of the list into it</li>
<li>Call the search method on the new object, with the same search key</li>
<li>Repeat until the keys are equal</li>
<li>If they&rsquo;re never equal, raise &ldquo;Not Found&rdquo;</li>
</ul>


<p>If the search key is more than the middle index:</p>

<ul>
<li>Cut the list we&rsquo;re searching in half</li>
<li>Instantiate a new BinarySearch</li>
<li>Pass the second half of the list into it</li>
<li>Call the search method on the new object, with the same search key</li>
<li>Repeat until the keys are equal</li>
<li>If they&rsquo;re never equal, raise &ldquo;Not Found&rdquo;</li>
</ul>


<p>With this plan in place, I started to build the method. First, I created the method and passed in the search key:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I checked it against the middle element in the list, returning the index if they were equal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next thing on my to do list was to branch for the other two conditions: whether the key was less than or greater than the middle value:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="c1"># ???</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="c1"># ???</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I filled in the branches some more of my pseudo-code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="c1"># Cut the list we&#39;re searching in half</span>
</span><span class='line'>    <span class="c1"># Instantiate a new BinarySearch</span>
</span><span class='line'>    <span class="c1"># Pass the first half of the list into it</span>
</span><span class='line'>    <span class="c1"># Call the search on the new object, with the same search key</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="c1"># Cut the list we&#39;re searching in half</span>
</span><span class='line'>    <span class="c1"># Instantiate a new BinarySearch</span>
</span><span class='line'>    <span class="c1"># Pass the second half of the list into it</span>
</span><span class='line'>    <span class="c1"># Call the search on the new object, with the same search key</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I filled them in with real code, one step at a time:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="c1"># Cut the list we&#39;re searching in half</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.middle</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Instantiate a new BinarySearch</span>
</span><span class='line'>    <span class="c1"># Pass the first half of the list into it</span>
</span><span class='line'>    <span class="n">search</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Call the search on the new object, with the same search key</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="c1"># Cut the list we&#39;re searching in half</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Instantiate a new BinarySearch</span>
</span><span class='line'>    <span class="c1"># Pass the first half of the list into it</span>
</span><span class='line'>    <span class="n">search</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Call the search on the new object, with the same search key</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Seeing some duplication here, I went ahead and refactored:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.middle</span><span class="o">]</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Time to run the tests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Expected: 5
</span><span class='line'>  Actual: 2
</span></code></pre></td></tr></table></div></figure>


<p>Fail.</p>

<p>Why? I did some <code>pry</code> action and discovered that I was getting back the index of the <em>new</em> list&rsquo;s middle element, not the <em>original</em> list&rsquo;s middle element. To fix this, I added the current list&rsquo;s middle to the recursive call. That meant undoing my refactor. I guess I refactored too soon.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.middle</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="n">middle</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The tests were now passing. Good. Time to try with another example. This time looking for keys on both sides of the middle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_finds_position_in_a_larger_list</span>
</span><span class='line'>  <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Whoops! <code>stack level too deep</code>! I forgot to change value of the search on line 3. I was getting an infinite loop when I searched for a bad value. I skipped this test and wrote one for the bad search condition, instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_raises_error_for_data_not_in_list</span>
</span><span class='line'>  <span class="n">assert_raises</span> <span class="no">RuntimeError</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make this pass, I had to validate that the search wasn&rsquo;t stuck looking through the same sublist over and over:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">middle</span> <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">==</span> <span class="n">key</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">key</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.middle</span><span class="o">]</span>
</span><span class='line'>    <span class="k">raise</span> <span class="s2">&quot;Not Found&quot;</span> <span class="k">if</span> <span class="n">sublist</span> <span class="o">==</span> <span class="n">list</span>
</span><span class='line'>    <span class="k">return</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">sublist</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">middle</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>    <span class="k">raise</span> <span class="s2">&quot;Not Found&quot;</span> <span class="k">if</span> <span class="n">sublist</span> <span class="o">==</span> <span class="n">list</span>
</span><span class='line'>    <span class="k">return</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="n">middle</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It passed! I went back and rewrote the other test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_finds_position_in_a_larger_list</span>
</span><span class='line'>  <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">7</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Passed again! How about one more for good measure? I also wanted to check if the middle was still coming out right when I passed in a list with an even number of elements. All the others had been of an odd length.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_it_finds_correct_position_in_a_list_with_an_even_number_of_elements</span>
</span><span class='line'>  <span class="n">binary</span> <span class="o">=</span> <span class="no">BinarySearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">377</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assert_equal</span> <span class="mi">6</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok! Green!</p>

<h2>Conclusion</h2>

<p>Even if I didn&rsquo;t know my stuff in the conference room at that moment, I&rsquo;m glad that my interviewer asked me about Binary Search. It was fun to learn, and it turned out to be a little easier than I expected. I always expect algorithms to be really hard to grasp, but maybe now that I&rsquo;ve done a few algorithms that use recursion, it&rsquo;s not such a jump for me to understand it.</p>

<p>At any rate, it&rsquo;s pretty cool to be able to find an element in a list with so few queries. Lately, I&rsquo;ve really been enjoying pure math programming problems like this one. I&rsquo;m going to try to find a few more like this to do in the near future.</p>

<h2>Footnote</h2>

<p>Since I had already done all of the work, I went ahead and submitted this as a new exercise for <a href="http://www.exercism.io">Exercism.io</a>. So, if you use Exercism, and you enjoy doing algorithms, I&rsquo;d suggest giving Binary Search a go yourself. If you get stuck, you know where to find the answer!</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Refactoring 4: Remove Middle Man]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/27/refactoring-4-remove-middle-man/"/>
    
    <updated>2014-01-27T19:34:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/27/refactoring-4-remove-middle-man</id>
    
    <content type="html"><![CDATA[<p>Today, in my latest journey on the <a href="http://martinfowler.com/books/refactoringRubyEd.html">Refactor</a> Tractor, I&rsquo;ll be taking a look at a strategy called Move Method.</p>

<p>Move Method is used to help remove duplication. Sometimes, in the interest of encapsulation, it&rsquo;s a good idea to make an object as unaware of another object as possible. If the first needs to access the second, though, it may have to &ldquo;reach through&rdquo; a third object. If this reaching is minimal, it can sometimes be a worthwhile trade off. But when it becomes an ongoing pattern, you can end up with a lot of duplication. And a lot of what my teacher Franklin Webber calls &ldquo;bad touching&rdquo;. The Refactoring book points out that &ldquo;it&rsquo;s hard to figure out what the right amount of hiding is&rdquo;,  but it&rsquo;s easy to change your mind with refactoring. Using a combination of this strategy and Hide Delegate, you can always change it again later.</p>

<p>Today I&rsquo;ll be practicing Remove Middle Man on another example from the <a href="https://github.com/fluxusfrequency/mancala">Mancala</a> app I was refactoring in my recent post: <a href="fluxusfrequency.github.io/blog/2014/01/17/refactoring-2-replace-method-with-method-object/">Refactoring 2 - Replace Method With Method Object</a>.</p>

<p>Here are the steps to Remove Middle Man:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Create an accessor for the delegate.
</span><span class='line'>
</span><span class='line'>2. For each client use of a delegate method, remove the method from the server and replace the call in the client to call the method on the delegate.
</span><span class='line'>
</span><span class='line'>3. Test after each method.
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s fairly cryptic. I think it means: just pass a reference to the distant object into the first object, and access it directly (instead of through object two).</p>

<h2>Mancala Game View</h2>

<p>There are many poorly-built parts to Mancala. That&rsquo;s probably because I didn&rsquo;t test it at all as I was writing it. At the time, I thought I was taking a shortcut. In reality, I was making a big mess that was difficult to understand and deal with. I didn&rsquo;t realize it at the time, but <a href="http://blog.testdouble.com/posts/2014-01-25-the-failures-of-intro-to-tdd.html">&ldquo;TDD&rsquo;s primary benefit is to improve the design of our code&rdquo;</a>.</p>

<p>One of my poorly designed classes is called the MancalaGameView. Its job is to draw the beads in their respective pits, and print the winner to the screen, using <a href="https://github.com/jashkenas/ruby-processing">Ruby Processing</a>. Here&rsquo;s the problem with my design: I pass in the &lsquo;app&rsquo; object, then call through it to get information about the &lsquo;rules&rsquo; and &lsquo;model&rsquo; objects. Here&rsquo;s what it looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:app</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">all_pits</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pit</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">all_stores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">store</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">print_winner</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">fill</span> <span class="mi">225</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="n">pit</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">9</span>
</span><span class='line'>      <span class="n">draw_x_beads</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">draw_many_beads</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fill_a_random_color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">store</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">draw_beads_in_player_one_store</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">store</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span>
</span><span class='line'>      <span class="n">draw_beads_in_player_two_store</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">print_winner</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">475</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_1</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Player two is the winner!&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">250</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_2</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Tie Game!&quot;</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">475</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:tie</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The calls to <code>app.fill</code> and <code>app.text</code> are built into Ruby Processing. Outside of that, I&rsquo;m not going to get into the details of what some of these methods, like <code>draw_x_beads</code> and <code>draw_beads_in_player_one_store</code>. Because the coupling in this app is so high, it would require pulling in too many methods.</p>

<h2>Setting Up the Test</h2>

<p>I&rsquo;m going to stub out a few things, so that we can build a test without having to drag in the rest of the app and the Ruby Processing Gem.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:app</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">all_pits</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pit</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">all_stores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">store</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">print_winner</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">print_winner</span>
</span><span class='line'>    <span class="k">return</span> <span class="s2">&quot;Player one is the winner!&quot;</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_1</span>
</span><span class='line'>    <span class="k">return</span> <span class="s2">&quot;Player two is the winner!&quot;</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_2</span>
</span><span class='line'>    <span class="k">return</span> <span class="s2">&quot;Tie Game!&quot;</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:tie</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">App</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:model</span><span class="p">,</span> <span class="ss">:ruler</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ruler</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="n">model</span>
</span><span class='line'>    <span class="vi">@ruler</span> <span class="o">=</span> <span class="n">ruler</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Model</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">all_pits</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">all_stores</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Ruler</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">winner</span>
</span><span class='line'>    <span class="n">winners</span> <span class="o">=</span> <span class="o">[</span><span class="ss">:player_1</span><span class="p">,</span> <span class="ss">:player_2</span><span class="p">,</span> <span class="ss">:tie</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@winner</span> <span class="o">||=</span> <span class="n">winners</span><span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">game_over?</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now, to build a test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">GameViewTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="no">Model</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="vi">@ruler</span> <span class="o">=</span> <span class="no">Ruler</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@model</span><span class="p">,</span> <span class="vi">@ruler</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@view</span> <span class="o">=</span> <span class="no">MancalaGameView</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@app</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_draw_all_beads_succeeds</span>
</span><span class='line'>    <span class="n">expected</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span> <span class="s2">&quot;Player two is the winner!&quot;</span><span class="p">,</span> <span class="s2">&quot;Tie Game!&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">draw_all_beads</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">expected</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s15.postimg.org/uh17pf8ij/Green_Pattern.jpg" title="All Green" alt="The color green"></p>

<p>This test is green. I don&rsquo;t like to start from green. It&rsquo;s supposed to be: &ldquo;red, green, refactor&rdquo;! I could comment out some code or change <code>game_over?</code> to false, but that wouldn&rsquo;t prove anything about the code. Since this is an instance of Test After, and the code is already understood, I&rsquo;m feel comfortable going forward from green here.</p>

<h2>Applying the Strategy</h2>

<p>Now, to begin removing the middle man object, <code>app</code>. There are two classes I&rsquo;m accessing through <code>app</code>: <code>Model</code> and <code>Ruler</code>. I&rsquo;ll extract them one at a time, beginning with <code>Model</code>. The first step is to &ldquo;create an accessor for the delegate&rdquo;. I could just do this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">model</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">model</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But I would rather pass the model into the MancalaGameView directly:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:app</span><span class="p">,</span> <span class="ss">:model</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="n">model</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step two is to change &ldquo;client&rdquo; calls so that they use the new accessor instead of calling through the &ldquo;server&rdquo; (which is <code>app</code> in this case). Step three is to test after each method. So here we go:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># OLD VERSION</span>
</span><span class='line'><span class="c1"># def draw_all_beads</span>
</span><span class='line'><span class="c1">#   app.model.all_pits.each do |pit|</span>
</span><span class='line'><span class="c1">#     draw_beads_in_pit(pit)</span>
</span><span class='line'><span class="c1">#   end</span>
</span><span class='line'><span class="c1">#   app.model.all_stores.each do |store|</span>
</span><span class='line'><span class="c1">#     draw_beads_in_store(store)</span>
</span><span class='line'><span class="c1">#   end</span>
</span><span class='line'><span class="c1">#   print_winner if app.ruler.game_over?</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>  <span class="n">model</span><span class="o">.</span><span class="n">all_pits</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pit</span><span class="o">|</span>
</span><span class='line'>    <span class="n">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">model</span><span class="o">.</span><span class="n">all_stores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">store</span><span class="o">|</span>
</span><span class='line'>    <span class="n">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">print_winner</span> <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s30.postimg.org/va1jflych/red_pattern.jpg" title="Red Tests" alt="The color red"></p>

<p>The test fails with: <code>wrong number of arguments (1 for 2)</code>. The problem lies in the test setup. I now need to pass in the model when I create the <code>MancalaGameView</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">GameViewTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>    <span class="c1"># Code omitted</span>
</span><span class='line'>    <span class="vi">@view</span> <span class="o">=</span> <span class="no">MancalaGameView</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@app</span><span class="p">,</span> <span class="vi">@app</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s15.postimg.org/uh17pf8ij/Green_Pattern.jpg" title="All Green" alt="The color green"></p>

<p>Ahh, that&rsquo;s better. Now to repeat the process with the <code>ruler</code>. Step one: create the accessor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:app</span><span class="p">,</span> <span class="ss">:model</span><span class="p">,</span> <span class="ss">:ruler</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ruler</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="n">model</span>
</span><span class='line'>    <span class="vi">@ruler</span> <span class="o">=</span> <span class="n">ruler</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Steps two and three: replace the method calls to use the accessor instead of reaching through <code>app</code>. Test after each step.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>  <span class="c1"># Code omitted</span>
</span><span class='line'>  <span class="n">print_winner</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s30.postimg.org/va1jflych/red_pattern.jpg" title="Red Tests" alt="The color red"></p>

<p>It fails, because I&rsquo;m not passing <code>ruler</code> into the test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">GameViewTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>    <span class="c1"># Code omitted</span>
</span><span class='line'>    <span class="vi">@view</span> <span class="o">=</span> <span class="no">MancalaGameView</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@app</span><span class="p">,</span> <span class="vi">@app</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="vi">@app</span><span class="o">.</span><span class="n">ruler</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s15.postimg.org/uh17pf8ij/Green_Pattern.jpg" title="All Green" alt="The color green"></p>

<p>That gets me back to green. Now to refactor the <code>print_winner</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># OLD VERSION</span>
</span><span class='line'><span class="c1"># def print_winner</span>
</span><span class='line'><span class="c1">#   return &quot;Player one is the winner!&quot; if app.ruler.winner == :player_1</span>
</span><span class='line'><span class="c1">#   return &quot;Player two is the winner!&quot; if app.ruler.winner == :player_2</span>
</span><span class='line'><span class="c1">#   return &quot;Tie Game!&quot; if app.ruler.winner == :tie</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">print_winner</span>
</span><span class='line'>  <span class="k">return</span> <span class="s2">&quot;Player one is the winner!&quot;</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_1</span>
</span><span class='line'>  <span class="k">return</span> <span class="s2">&quot;Player two is the winner!&quot;</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:player_2</span>
</span><span class='line'>  <span class="k">return</span> <span class="s2">&quot;Tie Game!&quot;</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="ss">:tie</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s15.postimg.org/uh17pf8ij/Green_Pattern.jpg" title="All Green" alt="The color green"></p>

<p>Success! That was pretty easy.</p>

<h2>Further Refactoring</h2>

<p>Now that I&rsquo;ve cleaned up the MancalaGameView somewhat, I&rsquo;m going to refactor a few other things. Along the way, I noticed that <code>print_winner</code> is pretty ugly, so I changed it to use a hash lookup instead.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># OLD VERSION</span>
</span><span class='line'><span class="c1"># def print_winner</span>
</span><span class='line'><span class="c1">#   return &quot;Player one is the winner!&quot; if ruler.winner == :player_1</span>
</span><span class='line'><span class="c1">#   return &quot;Player two is the winner!&quot; if ruler.winner == :player_2</span>
</span><span class='line'><span class="c1">#   return &quot;Tie Game!&quot; if ruler.winner == :tie</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">print_winner</span>
</span><span class='line'>  <span class="n">win_messages</span><span class="o">[</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">win_messages</span>
</span><span class='line'>  <span class="p">{</span> <span class="ss">:player_1</span> <span class="o">=&gt;</span> <span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:player_2</span> <span class="o">=&gt;</span> <span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:tie</span>      <span class="o">=&gt;</span> <span class="s2">&quot;Tie Game!&quot;</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I also decided to use extract method on the loops in <code>draw_all_beads</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># OLD VERSION</span>
</span><span class='line'><span class="c1"># def draw_all_beads</span>
</span><span class='line'><span class="c1">#   model.all_pits.each do |pit|</span>
</span><span class='line'><span class="c1">#     draw_beads_in_pit(pit)</span>
</span><span class='line'><span class="c1">#   end</span>
</span><span class='line'><span class="c1">#   model.all_stores.each do |store|</span>
</span><span class='line'><span class="c1">#     draw_beads_in_store(store)</span>
</span><span class='line'><span class="c1">#   end</span>
</span><span class='line'><span class="c1">#   print_winner if ruler.game_over?</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>  <span class="n">draw_pits</span>
</span><span class='line'>  <span class="n">draw_stores</span>
</span><span class='line'>  <span class="n">print_winner</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw_pits</span>
</span><span class='line'>  <span class="n">model</span><span class="o">.</span><span class="n">all_pits</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pit</span><span class="o">|</span>
</span><span class='line'>    <span class="n">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw_stores</span>
</span><span class='line'>  <span class="n">model</span><span class="o">.</span><span class="n">all_stores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">store</span><span class="o">|</span>
</span><span class='line'>    <span class="n">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s much better. Here&rsquo;s the final result:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaGameView</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:app</span><span class="p">,</span> <span class="ss">:model</span><span class="p">,</span> <span class="ss">:ruler</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ruler</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="n">model</span>
</span><span class='line'>    <span class="vi">@ruler</span> <span class="o">=</span> <span class="n">ruler</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_all_beads</span>
</span><span class='line'>    <span class="n">draw_pits</span>
</span><span class='line'>    <span class="n">draw_stores</span>
</span><span class='line'>    <span class="n">print_winner</span> <span class="k">if</span> <span class="n">ruler</span><span class="o">.</span><span class="n">game_over?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">print_winner</span>
</span><span class='line'>    <span class="n">win_messages</span><span class="o">[</span><span class="n">ruler</span><span class="o">.</span><span class="n">winner</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_pits</span>
</span><span class='line'>    <span class="n">model</span><span class="o">.</span><span class="n">all_pits</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pit</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_pit</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw_stores</span>
</span><span class='line'>    <span class="n">model</span><span class="o">.</span><span class="n">all_stores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">store</span><span class="o">|</span>
</span><span class='line'>      <span class="n">draw_beads_in_store</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">win_messages</span>
</span><span class='line'>    <span class="p">{</span> <span class="ss">:player_1</span> <span class="o">=&gt;</span> <span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:player_2</span> <span class="o">=&gt;</span> <span class="s2">&quot;Player one is the winner!&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:tie</span>      <span class="o">=&gt;</span> <span class="s2">&quot;Tie Game!&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>Remove Middle Man was really easy to use. Maybe it&rsquo;s because I&rsquo;ve heard Franklin harp on the evils of &ldquo;bad touching&rdquo; so much, or maybe it&rsquo;s just that I&rsquo;m violating the Law of Demeter, but I start to feel pretty nervous when I see two dots in my method calls. This was a quick and easy refactor that I&rsquo;m sure I&rsquo;ll use regularly. Since it sets you up for <a href="http://codeulate.com/2013/01/a-criticism-of-dhhs-post-on-dependency-injection/">Dependency Injection</a>, it also opens up the class&rsquo;s possibilities for <a href="http://en.wikipedia.org/wiki/Duck_typing">Duck Typing</a> and easy mocking.</p>

<p>As I continue to code and refactor, Remove Middle Man will be a vital tool in my tool kit.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Refactoring 3 - Introduce Named Parameter / Introduce Class Annotation]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/18/refactoring-3-introduce-named-parameter-and-introduce-class-annotation/"/>
    
    <updated>2014-01-18T13:22:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/18/refactoring-3-introduce-named-parameter-and-introduce-class-annotation</id>
    
    <content type="html"><![CDATA[<p>I&rsquo;ve been trying to get better at refactoring lately. To do that, I&rsquo;m digging into my old code from the first months of gSchool and applying strategies from <a href="http://martinfowler.com/books/refactoringRubyEd.html">Refactoring Ruby</a> by Jay Fields, Shane Harvie, Martin Folwer, and Kent Beck.</p>

<p>Just a couple of days ago I posted about trying out <a href="http://fluxusfrequency.github.io/blog/2014/01/17/refactoring-2-replace-method-with-method-object/">Replace Method with Method Object</a>. Almost immediately afterwards, I read about two more strategies that seemed like they would fit well with the same refactoring example, so I thought I&rsquo;d give them a try: Introduce Named Parameter and Introduce Class Annotation.</p>

<h2>Introduce Named Parameter</h2>

<p>According to the book, naming your parameters is a good thing to do if you want to improve the readability of a method. Using it prevents the work of having to go searching through dependency objects to figure out what&rsquo;s going on. It works easily with the new <code>BeadDistributor</code> class I created in my last article. Here&rsquo;s that code again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">first_pit_id</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">player</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compute</span>
</span><span class='line'>    <span class="n">fix_landing_on_spot_12</span>
</span><span class='line'>    <span class="n">take_both_if_own_empty</span>
</span><span class='line'>    <span class="n">distribute_beads</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads</span>
</span><span class='line'>    <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="n">rules</span><span class="o">.</span><span class="n">execute_store_logic</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="n">app</span><span class="o">.</span><span class="n">add_bead_to_model</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">next_pit_id</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">find_next_pit_in_model</span><span class="p">(</span><span class="n">first_pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">take_both_if_own_empty</span>
</span><span class='line'>    <span class="n">rules</span><span class="o">.</span><span class="n">take_both_sides</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="k">if</span> <span class="n">landed_on_players_own_empty_pit?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landed_on_players_own_empty_pit?</span>
</span><span class='line'>    <span class="n">rules</span><span class="o">.</span><span class="n">landed_on_empty?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">app</span><span class="o">.</span><span class="n">check_if_pit_belongs_to_player</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landing_spot</span>
</span><span class='line'>    <span class="vi">@landing_spot</span> <span class="o">||=</span> <span class="n">next_pit_id</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">fix_landing_on_spot_12</span>
</span><span class='line'>    <span class="vi">@landing_spot</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">landing_spot</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The most important parts here will be the <code>attr_reader</code>s and the <code>initialize</code> method.</p>

<p>Here are the steps for Introduce Named Parameter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Choose the parameters that you want to name. If you are not naming all of the parameters, move the parameters that you want to name to the end of the parameter list.
</span><span class='line'>
</span><span class='line'>2. Test
</span><span class='line'>
</span><span class='line'>3. Replace the parameters in the calling code with name/value pairs.
</span><span class='line'>
</span><span class='line'>4. Replace the parameters with a Hash object in the receiving method. Modify the receiving method to use the new Hash.
</span><span class='line'>
</span><span class='line'>5. Test.
</span></code></pre></td></tr></table></div></figure>


<p>As always, I started with the tests. They were still passing after my last refactoring adventure:</p>

<p><img src="http://s5.postimg.org/iav0trapz/All_green_start.png" title="All Green to Start" alt="A set of passing Ruby tests"></p>

<p>For the purposes of this example, I wanted to make all of the parameters required, so I skipped steps 1 and 2.</p>

<p>Here are the relevant parts of the code again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">first_pit_id</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">player</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 3: Replace the params in the calling method with key/value pairs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span class='line'>      <span class="ss">:rules</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:app</span> <span class="o">=&gt;</span> <span class="n">app</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:first_pit_id</span> <span class="o">=&gt;</span> <span class="n">first_pit_id</span><span class="p">,</span>
</span><span class='line'>      <span class="n">player</span> <span class="o">=&gt;</span> <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="n">count</span><span class="p">})</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 4: Modify the params taken into the receiving object to take a hash.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:rules</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:app</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:first_pit_id</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:player</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:count</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 5: Test.</p>

<p><img src="http://s5.postimg.org/ypoy6bsp3/Failing_after_first_refactor.png" title="Failing After First Refactor" alt="A set of passing Ruby tests"></p>

<p>The test is failing, because I haven&rsquo;t modified it to send a hash instead of the individual params. After fixing this, it passes again.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributorTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_compute_returns_the_correct_count</span>
</span><span class='line'>    <span class="n">rules</span> <span class="o">=</span> <span class="no">MancalaKalahRules</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>    <span class="n">player</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'>    <span class="n">distributor</span> <span class="o">=</span> <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span class='line'>      <span class="ss">:rules</span> <span class="o">=&gt;</span> <span class="n">rules</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:app</span> <span class="o">=&gt;</span> <span class="n">app</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="nb">id</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:player</span> <span class="o">=&gt;</span> <span class="n">player</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="n">count</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expected</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="n">expected</span><span class="p">,</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://s5.postimg.org/6e7zn0y6f/Passing_after_test_fix.png" title="Passing After Test Fix" alt="A set of passing Ruby tests"></p>

<p>At this point, everything&rsquo;s working. But why did I do it? If anything, it just added duplication to what was already there. Here&rsquo;s why: you can combine it with the Introduce Class Annotation strategy to DRY up object initialization.</p>

<h2>Introduce Class Annotation</h2>

<p>Although I&rsquo;ve heard from many developers more experienced than I am that metaprogramming is generally a bad idea, I also get the impression that many of them consider doing it anyway a guilty pleasure, particularly in non-production code.</p>

<p>However you feel about it, gird yourself, because we&rsquo;re heading into a little bit of <code>define_method</code> territory.</p>

<p>I&rsquo;m going to use the same annotation the book gives as an example. It&rsquo;s a way of defining a helper along the lines of <code>attr_reader</code>, <code>attr_writer</code>, and <code>attr_successor</code>. In it, you wrap all of the object initialization code into a neat new method called <code>hash_initializer</code>.</p>

<p>Here are the steps:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Decide on the signature of your class annotation. Declare it in the appropriate class.
</span><span class='line'>
</span><span class='line'>2. Convert the original method to a class method. Make the apppropriate changes so that the method works at the class scope.
</span><span class='line'>
</span><span class='line'>3. Test.
</span><span class='line'>
</span><span class='line'>4. Consider using Extract Module on the class method to make the annotation more prominent in your class definition.
</span></code></pre></td></tr></table></div></figure>


<p>Here we go.</p>

<p>Step 1: Declare the new class annotation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">hash_initializer</span><span class="p">(</span><span class="o">*</span><span class="n">attribute_names</span><span class="p">)</span>
</span><span class='line'>    <span class="n">define_method</span><span class="p">(</span><span class="ss">:initialize</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">first</span> <span class="o">||</span> <span class="p">{}</span>
</span><span class='line'>      <span class="n">attribute_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute_name</span><span class="o">|</span>
</span><span class='line'>        <span class="nb">instance_variable_set</span> <span class="s2">&quot;@</span><span class="si">#{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">[</span><span class="n">attribute_name</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:rules</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:app</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:first_pit_id</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:player</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:count</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 2: Convert the method to a class method. I also called the <code>hash_initializer</code> at the top of the <code>BeadDistributor</code> class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">hash_initializer</span><span class="p">(</span><span class="o">*</span><span class="n">attribute_names</span><span class="p">)</span>
</span><span class='line'>    <span class="n">define_method</span><span class="p">(</span><span class="ss">:initialize</span><span class="p">)</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
</span><span class='line'>      <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">first</span> <span class="o">||</span> <span class="p">{}</span>
</span><span class='line'>      <span class="n">attribute_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute_name</span><span class="o">|</span>
</span><span class='line'>        <span class="nb">instance_variable_set</span> <span class="s2">&quot;@</span><span class="si">#{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">[</span><span class="n">attribute_name</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">hash_initializer</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 3: Test.</p>

<p>All green!</p>

<p><img src="http://s5.postimg.org/lqrqh1xc7/Passing_after_metaprogramming.png" title="Passing After Metaprogramming" alt="A set of passing Ruby tests"></p>

<p>Step 4: Extract the class annotation into a module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">CustomInitializers</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">hash_initializer</span><span class="p">(</span><span class="o">*</span><span class="n">attribute_names</span><span class="p">)</span>
</span><span class='line'>    <span class="n">define_method</span><span class="p">(</span><span class="ss">:initialize</span><span class="p">)</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
</span><span class='line'>      <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">first</span> <span class="o">||</span> <span class="p">{}</span>
</span><span class='line'>      <span class="n">attribute_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute_name</span><span class="o">|</span>
</span><span class='line'>        <span class="nb">instance_variable_set</span> <span class="s2">&quot;@</span><span class="si">#{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">[</span><span class="n">attribute_name</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">CustomInitializers</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">hash_initializer</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>                   <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To me, the module you get at the end is like the gift that keeps on giving. Now I have a cool utility modult that I can use in other objects that take a hash of parameters. Right away, I can think of a program where I can use it in at least six classes.</p>

<p>Running the tests once more, everything is still cool.</p>

<p><img src="http://s5.postimg.org/i8fqknwg7/Everything_is_still_cool.png" title="Everything is Still Cool" alt="A set of passing Ruby tests"></p>

<h2>Conclusion</h2>

<p>As I got toward the end of the fifth chapter, Refactoring got pretty deep into some <code>method_missing</code> and <code>define_method</code> metaprogramming madness. While I can&rsquo;t say I&rsquo;m very excited to use these things in my day-to-day refactoring, it&rsquo;s nice to have them there as a reference in case I ever need them. If nothing else, tricks like the ones I tried out here help me think about the relationships between classes in new ways. Next week, I&rsquo;ll try some strategies from the next chapter: &ldquo;Moving Features Between Objects&rdquo;.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Refactoring 2: Replace Method with Method Object]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/17/refactoring-2-replace-method-with-method-object/"/>
    
    <updated>2014-01-17T09:06:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/17/refactoring-2-replace-method-with-method-object</id>
    
    <content type="html"><![CDATA[<p>As I mentioned last week, I&rsquo;m doing a series of posts on refactoring. As gSchool wraps up, I&rsquo;m working on my refactoring skills, so that I&rsquo;ll be a better developer when I get my first job. I&rsquo;m trying some of the strategies outlined in the book <a href="http://martinfowler.com/books/refactoringRubyEd.html">Refactoring Ruby</a>.</p>

<p>Today I&rsquo;ll be trying out a strategy called Replace Method with Method Object. This is a good approach to take when you have a long method with many variables in it, and using <a href="http://fluxusfrequency.github.io/blog/2014/01/10/refactoring-1-extract-method/">Extract Method</a> wouldn&rsquo;t be practical. Essentially, it consists of removing the method from its class and turning it into a class of its own. From there, you can more easily refactor using Extract Method and other simple strategies.</p>

<p>Here are the steps as outlined in the book:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Create a new class, name it after the method.
</span><span class='line'>
</span><span class='line'>2. Give the new class an attribute for the object that hosted the original method (the source object) and an attribute for each temporary vairable and each parameter in the method.
</span><span class='line'>
</span><span class='line'>3. Give the new class a constructor that takes the source object and each parameter.
</span><span class='line'>
</span><span class='line'>4. Give the new class a method named "compute".
</span><span class='line'>
</span><span class='line'>5. Copy the body of the original method into "compute". Use the source object instance variable for any invocations of methods on the original subject.
</span><span class='line'>
</span><span class='line'>6. Test.
</span><span class='line'>
</span><span class='line'>7. Replace the old method with one that creates the new method and call "compute".
</span></code></pre></td></tr></table></div></figure>


<h2>Mancala</h2>

<p>I took a look around my Github repositories, and found this little wonder from a <a href="https://github.com/fluxusfrequency/mancala">Mancala</a> app I wrote in Ruby Processing during the first month of gSchool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">first_pit_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="vi">@i</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">execute_store_logic</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="k">break</span> <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span>
</span><span class='line'>      <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_bead_to_pit</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="n">next_pit_id</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">landing_spot</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">landed_on_empty?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="n">take_both_sides</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="vi">@i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>What a mess.</p>

<h2>Setting Up Tests</h2>

<p>To begin the refactoring process, I had to make sure the tests were in place first. This was fairly difficult, as this method is highly coupled to other methods throughout the app. For testing purposes, I added a couple of stubbed methods to <code>KalahRules</code>, and created dummy <code>App</code> and <code>Model</code> classes with stubbed methods of their own. Also, <code>distribute_beads_for_player</code> did not return anything meaningful, so I changed it to do return the value of <code>@i</code>.</p>

<p>In the end, here&rsquo;s the code I used to make the test pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;minitest/autorun&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;minitest/pride&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;./kalah_rules&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">KalahRulesTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_distribute_beads_for_player_returns_the_correct_count</span>
</span><span class='line'>    <span class="n">rules</span> <span class="o">=</span> <span class="no">MancalaKalahRules</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>    <span class="n">player</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expected</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="n">expected</span><span class="p">,</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">first_pit_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="vi">@i</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">execute_store_logic</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="k">break</span> <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span>
</span><span class='line'>      <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_bead_to_pit</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="n">next_pit_id</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">landing_spot</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">landed_on_empty?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="n">take_both_sides</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="vi">@i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="vi">@i</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">execute_store_logic</span><span class="p">(</span><span class="n">pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">take_both_sides</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landed_on_empty?</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">App</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">model</span>
</span><span class='line'>    <span class="no">Model</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Model</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_next_pit_by_id</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_bead_to_pit</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>All green! Time to start refactoring!</p>

<p><img src="http://s5.postimg.org/540zghpmv/All_green_before_refactor.png" title="All Green Before Refactor" alt="A set of passing Ruby tests"></p>

<h2>Applying the Strategy</h2>

<p>Step 1: Create a new class named after the method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 2: Give the new class an attribute of the source object and its parameters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 3: Give the new class a constructor that takes the new attributes. I chose to add attr_readers as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">first_pit_id</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">player</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 4: Give the new class a <em>compute</em> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compute</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 5: Copy the original method into <em>compute</em>. I also copied in the stubbed methods for testing purposes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Code omitted for brevity</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compute</span>
</span><span class='line'>    <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">first_pit_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="vi">@i</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">execute_store_logic</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="k">break</span> <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span>
</span><span class='line'>      <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_bead_to_pit</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="n">next_pit_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@i</span> <span class="o">==</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="n">next_pit_id</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">landing_spot</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">landing_spot</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">landed_on_empty?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">app</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="n">take_both_sides</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>          <span class="k">break</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="vi">@i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="vi">@i</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">execute_store_logic</span><span class="p">(</span><span class="n">pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">take_both_sides</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landed_on_empty?</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 6: Test. I tested the newly created <code>BeadDistributor</code> class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributorTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_compute_returns_the_correct_count</span>
</span><span class='line'>    <span class="n">rules</span> <span class="o">=</span> <span class="no">MancalaKalahRules</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>    <span class="n">player</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'>    <span class="n">distributor</span> <span class="o">=</span> <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expected</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">distributor</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="n">expected</span><span class="p">,</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>All green!</p>

<p><img src="http://s5.postimg.org/s81g92sxz/All_green_after_refactor.png" title="All Green After Refactor" alt="A set of passing Ruby tests"></p>

<p>Step 7: Replace the old method by instantiating the new object, passing the old object into it, and calling <em>compute</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, I ran the test2 again. The original one passed! Yay!</p>

<p><img src="http://s5.postimg.org/f55tpt2pz/Still_green.png" title="Still Green" alt="Another set of passing Ruby tests"></p>

<p>After completing the object extraction, I was free to refactor the new BeadDistributor using more common strategies. Here&rsquo;s what I ended up with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BeadDistributor</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:rules</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:app</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:first_pit_id</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:player</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:count</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
</span><span class='line'>    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
</span><span class='line'>    <span class="vi">@first_pit_id</span> <span class="o">=</span> <span class="n">first_pit_id</span>
</span><span class='line'>    <span class="vi">@player</span> <span class="o">=</span> <span class="n">player</span>
</span><span class='line'>    <span class="vi">@count</span> <span class="o">=</span> <span class="n">count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compute</span>
</span><span class='line'>    <span class="n">fix_landing_on_spot_12</span>
</span><span class='line'>    <span class="n">take_both_if_own_empty</span>
</span><span class='line'>    <span class="n">distribute_beads</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads</span>
</span><span class='line'>    <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="n">rules</span><span class="o">.</span><span class="n">execute_store_logic</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="n">app</span><span class="o">.</span><span class="n">add_bead_to_model</span><span class="p">(</span><span class="n">next_pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">next_pit_id</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">find_next_pit_in_model</span><span class="p">(</span><span class="n">first_pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">take_both_if_own_empty</span>
</span><span class='line'>    <span class="n">rules</span><span class="o">.</span><span class="n">take_both_sides</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="k">if</span> <span class="n">landed_on_players_own_empty_pit?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landed_on_players_own_empty_pit?</span>
</span><span class='line'>    <span class="n">rules</span><span class="o">.</span><span class="n">landed_on_empty?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">app</span><span class="o">.</span><span class="n">check_if_pit_belongs_to_player</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landing_spot</span>
</span><span class='line'>    <span class="vi">@landing_spot</span> <span class="o">||=</span> <span class="n">next_pit_id</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">fix_landing_on_spot_12</span>
</span><span class='line'>    <span class="vi">@landing_spot</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">landing_spot</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MancalaKalahRules</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">distribute_beads_for_player</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="no">BeadDistributor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">first_pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">execute_store_logic</span><span class="p">(</span><span class="n">pit_id</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">take_both_sides</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">landed_on_empty?</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">App</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">model</span>
</span><span class='line'>    <span class="no">Model</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_bead_to_model</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="n">model</span><span class="o">.</span><span class="n">add_bead_to_pit</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_next_pit_in_model</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="n">model</span><span class="o">.</span><span class="n">find_next_pit_by_id</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">check_if_pit_belongs_to_player</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>    <span class="n">model</span><span class="o">.</span><span class="n">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">landing_spot</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Model</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_next_pit_by_id</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>    <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_bead_to_pit</span><span class="p">(</span><span class="n">pit_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_all_pit_ids_on_players_side</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the tests one more time, I saw that everything was still green. Although I could have gone on to refactor some of the other methods in the original class that <code>distribute_beads_for_player</code> was coupled to, I decided to call it a day.</p>

<p><img src="http://s5.postimg.org/8fza9shdz/Final_green.png" title="Final Green" alt="Another set of passing Ruby tests"></p>

<h2>Conclusion</h2>

<p>I enjoyed the Replace Method with Method Object strategy. It&rsquo;s a pretty cool way to think about the microcosm/macrocosm relationship between methods and objects. Although it&rsquo;s not probably useful for every refactoring case, I imagine it would come in really handy when cleaning up a hairy method like <code>distribute_beads_for_player</code>. I&rsquo;m learning a lot from Refactoring Ruby, and I&rsquo;m looking forward to seeing what other strategies it offers.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Refactoring 1: Extract Method]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/10/refactoring-1-extract-method/"/>
    
    <updated>2014-01-10T09:07:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/10/refactoring-1-extract-method</id>
    
    <content type="html"><![CDATA[<p>I&rsquo;m reading <a href="http://martinfowler.com/books/refactoringRubyEd.html">Refactoring Ruby</a> by Jay Fields, Sean Harvie, Martin Fowler and Kent Beck. As I&rsquo;m heading into the last couple of months at gSchool, I want to clean up some of the code I wrote, and practice my refactoring skills. I&rsquo;ll be doing a series of articles detailing the strategies I learn. This is the first.</p>

<p>Today I&rsquo;ll be talking about the &ldquo;Extract Method&rdquo; strategy. Here&rsquo;s how the book describes it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>1. Create a new method, and name it after the intention of the method (name it by what it does, not by how it does it).
</span><span class='line'>If the code you want to extract is very simple, such as a single message or function call, you should extract it if the name of the new method reveals the intention of the code in a better way. If you cant come up with a more meaningful name, dont extract the code.
</span><span class='line'>
</span><span class='line'>2. Copy the extracted code from the source method into the new target method.
</span><span class='line'>
</span><span class='line'>3. Scan the extracted code for references to any variables that are local in scope to the source method. These are local variables and parameters to the method.
</span><span class='line'>
</span><span class='line'>4. See whether any temporary variables are used only within this extracted code. If so, declare them in the target method as temporary variables.
</span><span class='line'>
</span><span class='line'>5. Look to see whether any of these local-scope variables are modified by the extracted code. If one variable is modified, see whether you can treat the extracted code as a query and assign the result to the variable con- cerned. If this is awkward, or if there is more than one such variable, you cant extract the method as it stands. You may need to use Split Tempo- rary Variable and try again. You can eliminate temporary variables with Replace Temp with Query (see the discussion in the examples).
</span><span class='line'>
</span><span class='line'>6. Pass into the target method as parameters local-scope variables that are read from the extracted code.
</span><span class='line'>
</span><span class='line'>7. Replace the extracted code in the source method with a call to the target method.
</span><span class='line'>If you moved any temporary variables over to the target method, look to see whether they were declared outside the extracted code. If so, you can now remove the declaration.
</span><span class='line'>
</span><span class='line'>8. Test.
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s some code from a Sinatra app I wrote early on in gSchool, called <a href="http://ideabox-flux.herokuapp.com">IdeaBox</a>. For this project, we couldn&rsquo;t use ActiveRecord or DataMapper, but had to hand build an ORM.</p>

<p> I selected these methods from my Finders module. They work together to search through a YAML file for records that match a search string. The <code>find_raw</code> method looked really long and complex, so I thought this would be a good place to do some refactoring.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Finders</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_raw</span><span class="p">({</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_raw</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>      <span class="n">query_hash</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>        <span class="n">query_string</span> <span class="o">=</span> <span class="n">query_hash</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>        <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>            <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>          <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>        <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="k">rescue</span>
</span><span class='line'>      <span class="o">[]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>My first step was to check the tests for the method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SearchingTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_it_can_search_for_ideas_with_title_description_or_tags</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Recreation&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bicycles In The Park&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bike&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Sundays&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;In the park with George&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;gerschwin&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="mi">2</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>    <span class="n">assert_kind_of</span> <span class="no">Idea</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;Gerschwin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To be thorough, I added a a couple of assertions, one to test the title field search, one for cases where there&rsquo;s nothing in the database, and one for a nil search.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">test_search_for_can_find_ideas_by_title_description_or_tags</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Recreation&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bicycles In The Park&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bike&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
</span><span class='line'>      <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Sundays&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;In the park with George&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;gerschwin&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="mi">1</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;Recreation&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="mi">2</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;park&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>    <span class="n">assert_kind_of</span> <span class="no">Idea</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;Gerschwin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_search_for_doesnt_blow_up_on_nil</span>
</span><span class='line'>    <span class="no">IdeaStore</span><span class="o">.</span><span class="n">create</span><span class="p">({})</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="o">[]</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="s2">&quot;anything&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_equal</span> <span class="o">[]</span><span class="p">,</span> <span class="no">IdeaStore</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This last test broke on <code>undefined method</code>downcase&#8217; for nil`, so I updated the search_for method to protect against nil, and also return empty searched don&rsquo;t yield any results.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_raw</span><span class="p">({</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With tests in place to make sure that I wouldn&rsquo;t break any of the existing functionality, I began to make changes. My first step was to rename the find_raw method to find_yaml_data, reflecting its real intention. I then had to change the method call in <code>search_for</code>.</p>

<p>Beginning the extraction, I created a new method called find_in_database_for_mutliple_queries (step 1) and pulled the code from find_yaml_data into it (step 2).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_yaml_data</span><span class="p">({</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>        <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="k">rescue</span>
</span><span class='line'>      <span class="o">[]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">query_hash</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>      <span class="n">query_string</span> <span class="o">=</span> <span class="n">query_hash</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">found</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In step 3, I looked at the original method and found that the result of the code now living in <code>find_multiple_queries_in_database</code> was being used on the next line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, I didn&rsquo;t see any variables used only in the new code that needed to be moved over (step 4), because I&rsquo;d already moved <code>found = []</code>. I could therefore safely skip step 5, which helps deal with any such variables.</p>

<p>Turning my attention to the new method, I identified the <code>query_hash</code> variable as a problem, because the new method didn&rsquo;t know about it. Step 6 has you turn local variables like these into parameters to the new method. Here, I decided to rename it from <code>query_hash</code> to <code>queries</code>, because the fact that it&rsquo;s a hash is an implementation detail.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">queries</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>      <span class="n">query_string</span> <span class="o">=</span> <span class="n">query_hash</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">found</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, in step 7, I made a call to the new method from the body of the old, and assigned it to the local variable needed to pass it to the next line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>      <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>        <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="k">rescue</span>
</span><span class='line'>      <span class="o">[]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, I went ahead and ran the tests (step 8). They were failing, but I couldn&rsquo;t tell why because of the begin/end block. I decided to remove it. I wrote it when I was still pretty new to programming, and was afraid of nil.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the tests again, I could now see the error: <code>undefined local variable or method</code>query_hash&#8217;<code>. I saw that I had forgotten to rename the variable in the new method from</code>query_hash<code>to</code>queries`, so I fixed it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">queries</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>      <span class="n">query_string</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">found</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>All of the tests now passed. Looking at my code, I now had:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_yaml_data</span><span class="p">({</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="n">queries</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>      <span class="n">query_string</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">found</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I still wasn&rsquo;t happy with the complexity, so I decided to extract some more methods. I went after this bit in <code>find_yaml_data</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I extracted it, following the same process:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># Step 1: Create a new method</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 2: Copy over the code</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span>
</span><span class='line'>    <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 3: Look for local variables in the source method</span>
</span><span class='line'>  <span class="c1"># Here, there&#39;s one called &#39;found&#39;</span>
</span><span class='line'>  <span class="n">found</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 4: Look for temporary variables in the extracted code.</span>
</span><span class='line'>  <span class="c1"># There aren&#39;t any.</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 5: If any temps are modified, replace them with queries.</span>
</span><span class='line'>  <span class="c1"># Again, there aren&#39;t any.</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 6: Pass locals into the new method as parameters.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="n">build_idea_from_data</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Step 7: Replace extracted code with a call to</span>
</span><span class='line'>  <span class="c1"># the new method in the source method.</span>
</span><span class='line'>  <span class="c1"># I also renamed the temp from &#39;found&#39; to &#39;ideas&#39; for clarity.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Step 8 is to test. All green! Taking another look at the whole thing, I now had this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>     <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>     <span class="n">find_yaml_data</span><span class="p">({</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span> <span class="o">=&gt;</span> <span class="n">query</span><span class="p">})</span>
</span><span class='line'>   <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>     <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">query_hash</span><span class="p">)</span>
</span><span class='line'>     <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>     <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>   <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="n">build_idea_from_data</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
</span><span class='line'>     <span class="n">found</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>     <span class="n">queries</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>       <span class="n">query_string</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>       <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>         <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>           <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>         <span class="k">end</span>
</span><span class='line'>         <span class="n">found</span> <span class="o">&lt;&lt;</span> <span class="n">result</span>
</span><span class='line'>       <span class="k">end</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>     <span class="n">found</span>
</span><span class='line'>   <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>My next thought was to clean up <code>find_multiple_queries_in_database</code>. I started by replacing the #each call with a #map instead. This let me remove all references to the <code>found</code> local variable, and cleaned the whole thing up considerably.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
</span><span class='line'>    <span class="n">queries</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>      <span class="n">query_string</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">key</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reflecting further, I saw that the hash I was creating in the <code>search_for</code> method was unneccesary, as all of the values were the same. I moved the keys out into an array, and adjusted the <code>find_yaml_data</code> method to accept a string rather than a hash.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_yaml_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">fields_to_search</span>
</span><span class='line'>    <span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">find_multiple_queries_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the tests, this wasn&rsquo;t working, as the <code>find_multiple_queries_in_database</code> method still expected a hash. I changed it as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">find_mutliple_queries_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fields_to_search</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I didn&rsquo;t like the name anymore, so I changed it to search_fields_for_query. This last refactoring was a sweeping change, and removing the hash cleaned up a lot of things. All of the tests were still green. The code now looked like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="n">find_yaml_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">fields_to_search</span>
</span><span class='line'>    <span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_yaml_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fields_to_search</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>          <span class="n">idea</span><span class="o">[</span><span class="n">field</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I could see that <code>search_fields_for_query</code> still had another candidate for extraction, so I went ahead with it, following the same steps:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fields_to_search</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>      <span class="n">idea</span><span class="o">[</span><span class="n">field</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I then realized that I could push the #downcase call from <code>search_for</code> fown into the database query. This cleaned up the former nicely:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>    <span class="n">find_yaml_data</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>      <span class="n">idea</span><span class="o">[</span><span class="n">field</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since search_for was now just delegating to <code>find_yaml_data</code>, I deleted the latter and pulled its code into <code>search_for</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As a finishing touch, I pulled the transformation of raw data into an object out of <code>build_ideas_from_raw_data</code> and into a new method. This increased the lines of code, but I thought it was clearer, and the new method could potentially be reused elsewhere.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># Before</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>   <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>     <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>   <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># After</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="n">build_idea_from_data</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_idea_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>All tests still green. Here&rsquo;s the final result:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">to_s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="n">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ideas</span> <span class="o">=</span> <span class="n">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span><span class='line'>    <span class="n">select_current_portfolio_only</span><span class="p">(</span><span class="n">ideas</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">search_fields_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fields_to_search</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
</span><span class='line'>      <span class="n">database</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">fields_to_search</span>
</span><span class='line'>    <span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">find_query_in_database</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span class='line'>    <span class="n">database</span><span class="o">[</span><span class="s1">&#39;ideas&#39;</span><span class="o">].</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">idea</span><span class="o">|</span>
</span><span class='line'>      <span class="n">idea</span><span class="o">[</span><span class="n">field</span><span class="o">].</span><span class="n">downcase</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_ideas_from_raw_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw</span><span class="o">|</span>
</span><span class='line'>      <span class="n">build_idea_from_data</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_idea_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Idea</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahh, much better. Thanks, Extract Method strategy!</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Looking Ahead to the Last Two Months of gSchool]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2014/01/03/looking-ahead-to-the-last-two-months-of-gschool/"/>
    
    <updated>2014-01-03T09:01:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2014/01/03/looking-ahead-to-the-last-two-months-of-gschool</id>
    
    <content type="html"><![CDATA[<p>We&rsquo;re coming into the home stretch at gSchool. With only 56 days left, I&rsquo;m reflecting on what I&rsquo;ve learned so far, and trying to sort out what I want to make of the time I have left.</p>

<h2>Goals - Where I&rsquo;ve Been</h2>

<p>My biggest goals for gSchool have been to become a great developer, and to build a solid foundation for continued learning.</p>

<p>I&rsquo;ve worked hard to get good at pure Ruby, focusing on writing clean, DRY, test-driven code. I&rsquo;ve prioritized learning how to do Rails &ldquo;the right way&rdquo;, and to understand its intricacies. I&rsquo;ve also prioritized JavaScript as a second area of expertise, learning to use it in the DOM, in the context of client-side frameworks, and dabbled in a little bit of Node.js.</p>

<p>So far, I&rsquo;ve been meeting all of these goals. I really enjoy working with these technologies, and am feeling more comfortable with them every day.</p>

<h2>Goals - Where I&rsquo;m Going</h2>

<p>During January and February, I want to continue to hone my skills with Ruby and JavaScript. Now that I understand the basis of these languages, I&rsquo;m working on using the best idioms and designs for each.</p>

<p>I&rsquo;ll keep doing a lot of reading. I&rsquo;ve just completed <a href="http://pragprog.com/book/jvrails2/crafting-rails-4-applications">Crafting Rails 4 Applications</a>, and I&rsquo;m still reading <a href="https://leanpub.com/multi-tenancy-rails">Multitenancy With Rails</a>, and I&rsquo;m excited about starting <a href="http://designpatternsinruby.com/">Design Patterns in Ruby</a> this weekend.</p>

<p>Pure computer science topics have started to interest me lately. I&rsquo;m hoping that Ruby Design Patterns will help me understand patterns like Factories, Facades, and Observers. I&rsquo;ll also continue to look at algorithms. One of my current projects is implementing a linked list in JavaScript. In the future, I&rsquo;ll explore Binary Trees, the A* algorithm, and perhaps the MD5 algorithm.</p>

<h2>Milestones</h2>

<p>For me, the easiest way to break up the coming time is to think of it in terms of the projects we&rsquo;ll complete. We&rsquo;re just starting Feed Engine. After that, it&rsquo;s the Service Oriented Architecture project, then the personal mastery project. Every project in gSchool thus far has built on the last. I&rsquo;m looking forward to growing through each of these remaining experiences.</p>

<h2>How I Will Succeed</h2>

<p>There is little blocking me from succeess, in my mind. As long as I can keep my energy level up, I&rsquo;ll be able to grok everything left on the docket: what it takes to build killer Rails apps, consuming APIs, feeds, and SOAs. Hopefully, I&rsquo;ll pick up a few other tricks along the way. Given the good rest I got over the holidays, I feel refreshed and ready to keep working hard for the last two months, so I feel confident.</p>

<p>The parts of my personality that will best serve me are my stubbornness/tenacity, curiousity and resourcefulness. I find it hard to give up on problems, so I follow through on them. I&rsquo;m always finding new things to learn about, and I&rsquo;m good at finding ways to learn more about the things I&rsquo;m interested in.</p>

<p>Finally, I&rsquo;ve been really interested in productivity lately. Some of my strategies to &ldquo;work smarter, not harder&rdquo; are:</p>

<ul>
<li>Avoid distractions</li>
<li>Use a todo list</li>
<li>Clarify my goals at the start of each day</li>
<li>Stay true to the pomodore timer</li>
</ul>


<p>With the combination of my love for learning and my productivity, I know I&rsquo;ll succeed in the last couple of months as a gSchool student, and will also continue to be a valuable programmer and a life-long learner.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[What I've Been Reading]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/12/30/what-ive-been-reading/"/>
    
    <updated>2013-12-30T15:44:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/12/30/what-ive-been-reading</id>
    
    <content type="html"><![CDATA[<p>This post is a list of the books I&rsquo;ve read and am currently reading.</p>

<h2>Currently Reading</h2>

<ul>
<li><a href="http://www.amazon.com/Introduction-Algorithms-Thomas-H-Cormen/dp/0262033844">Introduction to Algorithms</a>, Charles E. Leiserson, Ronald Rivest, Thomas H. Cormen, and Clifford Stein</li>
</ul>


<h2>Previous Titles</h2>

<h3>JavaScript</h3>

<ul>
<li><a href="http://addyosmani.github.io/backbone-fundamentals/">Developing Backbone.js Applications</a>, Addy Osmani</li>
<li><a href="http://eloquentjavascript.net/">Eloquent JavaScript</a>, Marijn Haverbeke</li>
<li><a href="http://www.javascriptenlightenment.com/">JavaScript Enlightenment</a>, Cody Lindley</li>
<li><a href="http://shop.oreilly.com/product/9780596806767.do">JavaScript Patterns</a>, Stoyan Stefanov</li>
<li><a href="http://shop.oreilly.com/product/9780596517748.do">JavaScript: The Good Parts</a>, Douglas Crockford</li>
<li><a href="http://arcturo.github.io/library/coffeescript/">The Little Book on CoffeeScript</a>, Alex MacCaw</li>
<li><a href="http://shop.oreilly.com/product/0636920021506.do">What is Node.js?</a>, Brett McLaughlin</li>
</ul>


<h3>Ruby</h3>

<ul>
<li><a href="http://pragprog.com/book/jvrails2/crafting-rails-4-applications">Crafting Rails 4 Applications</a>, Jos Valim</li>
<li><a href="http://designpatternsinruby.com/">Design Patterns in Ruby</a>, Russ Olsen</li>
<li><a href="http://eloquentruby.com/">Eloquent Ruby</a>, Russ Olsen</li>
<li><a href="http://www.sitepoint.com/store/jump-start-sinatra/">Jump Start Sinatra</a>, Darren Jones</li>
</ul>


<!-- Multitenancy With Rails](https://leanpub.com/multi-tenancy-rails), Ryan Bigg -->


<ul>
<li><a href="http://www.poodr.com/">Practical Object-Oriented Design in Ruby</a>, Sandi Metz</li>
<li><a href="http://martinfowler.com/books/refactoringRubyEd.html">Refactoring Ruby</a>, Jay Fields, Sean Harvie, Martin Fowler and Kent Beck</li>
<li><a href="http://guides.rubyonrails.org/">The Rails Guides</a>, Open Source</li>
<li><a href="http://www.therailsview.com/">The Rails View</a>, Bruce Williams and John Athayde</li>
<li><a href="http://shop.oreilly.com/product/0636920019664.do">Sinatra: Up and Running</a>, Alan Harris and Konstantin Haase</li>
</ul>


<h3>Design</h3>

<ul>
<li><a href="http://abovethefoldbook.com/">Above the Fold</a>, Brian Miller</li>
<li><a href="http://www.abookapart.com/products/designing-for-emotion">Designing For Emotion</a>, Aaron Walter</li>
<li><a href="http://www.htmlandcssbook.com/">HTML and CSS</a>, Jon Duckett</li>
<li><a href="http://www.amazon.com/The-Non-Designers-Design-Book-Edition/dp/0321534042">The Non-Designer&rsquo;s Design Book</a>, Robin Williams</li>
<li><a href="http://www.amazon.com/The-Principles-Beautiful-Web-Design/dp/098057689X/ref=sr_1_2?ie=UTF8&amp;qid=1385902814&amp;sr=8-2&amp;keywords=sitepoint+web+design">The Principles of Beautiful Web Design</a>, Jason Beaird</li>
</ul>


<h3>Other</h3>

<ul>
<li><a href="http://www.danpink.com/books/drive/">Drive: The Surprising Truth About What Motivates Us</a>, Daniel H. Pink</li>
<li><a href="http://www.amazon.com/How-Count-Programming-Mere-Mortals-ebook/dp/B005DPIKPE/ref=sr_1_1?ie=UTF8&amp;qid=1385903319&amp;sr=8-1&amp;keywords=how+to+count+programming+for+mere+mortals">How to Count (Programming for Mere Mortals)</a>, Steven Frank</li>
<li><a href="http://shop.oreilly.com/product/9780596003425.do">Learning Unix for OS X: Going Deep With the Terminal and Shell</a>, Dave Taylor</li>
<li><a href="http://chadfowler.com/passionate-programmer/">The Passionate Programmer</a>, Chad Fowler</li>
<li><a href="http://37signals.com/rework/">ReWork</a>, Jason Fried and David Heinemeier Hansson</li>
<li><a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530">Test Driven Development by Example</a>, Kent Beck</li>
</ul>

]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[How To Find Big Directories in OS X (Darwin Linux)]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/12/30/how-to-find-big-directories-in-os-x-darwin-linux/"/>
    
    <updated>2013-12-30T14:36:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/12/30/how-to-find-big-directories-in-os-x-darwin-linux</id>
    
    <content type="html"><![CDATA[<p>My Dropbox was full this morning. Since I couldn&rsquo;t afford to buy more space, I needed to clear some room. I set out to find the biggest files and delete them.</p>

<p>Before I got comfortable with the command line, I always downloaded some junky freeware to solve this problem. But today, I figured that there must be a smart way to do this with some arcane Linux incantation, so I did a little research and figured it out. It turned out to be really easy. Here&rsquo;s what to do:</p>

<h2>Step 1</h2>

<p>Navigate to the folder you want to search through.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd Dropbox</span></code></pre></td></tr></table></div></figure>


<h2>Step 2</h2>

<p>Use the <code>du</code> (Disk Usage) command to get a list of the files in your current folder (indicated by a <code>.</code>) and their sizes. Pass the <code>-a</code> flag to search all the files (not just directories), and the <code>-h</code> flag to have it display a human readable format.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ du -a -h .</span></code></pre></td></tr></table></div></figure>


<h2>Step 3</h2>

<p>Use a pipe to send the results to the <code>sort</code> command. Pass <code>-n</code> to sort the results numerically, and <code>-r</code> to make the biggest files show up at the top of the list.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ du -a -h . | sort -n -r</span></code></pre></td></tr></table></div></figure>


<h2>Step 4</h2>

<p>Limit the results to only ten entries so you only have the biggest files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ du -a -h . | sort -n -r | head -n 10</span></code></pre></td></tr></table></div></figure>


<h2>Step 5</h2>

<p>Optionally, dump the whole thing into a text file using the <code>&gt;</code> shovel, so you can reference it while you are deleting files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ du -a -h . | sort -n -r | head -n 10 &gt; file_sizes.txt</span></code></pre></td></tr></table></div></figure>


<p>Open file_sizes.txt in your favorite text editor, and start deleting files in the terminal. To keep the text file up to date, you can hit up arrow a couple of times to get the above command back and run it again after you&rsquo;ve deleted a few things.</p>

<h2>Conclusion</h2>

<p>Now you can find the biggest files on any part of your hard drive. Just navigate to the folder you want to look at before running the command, or replace the <code>.</code> with the path you want to search (e.g. <code>$ du -a -h ~/Dropbox | sort -n -r | head -n 10 &gt; file_sizes.txt</code>).</p>

<p>Enjoy!</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Contributing to Open Source &amp; Git Squash]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/12/15/contributing-to-open-source-and-git-squash/"/>
    
    <updated>2013-12-15T21:01:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/12/15/contributing-to-open-source-and-git-squash</id>
    
    <content type="html"><![CDATA[<h2>Open Source</h2>

<p>I&rsquo;ve been really interested in contributing to open source lately. In part, because it seems like a really good way to learn about the gems I use. Also, because I am on a campaign of giving right now in my life, and contributing is an easy way to do so in computer code (which is basically all I do/breathe/sleep right now).</p>

<p>I started off with something small, a contribution to the <a href="http://emberjs.com/guides/">Ember.js guides</a>. I noticed that there was an inconsistency in one step of the tutorial: sometimes they called the everyProperty() method, and other times they called everyBy(). I corrected it to use everyProperty() throughout and submitted. Even though my pull request was not accepted, because the latter method was deprecated in favor of the former, it was a magical experience. The people working on Ember were talking to me! And I was helping them make Ember better! I was feeling into it.</p>

<p>Over the next month or so, I submitted some other documentation pull requests. I had pull requests accepted to Sinatra, Express.js, and even Rails! After being scolded for not including &ldquo;[ci skip]&rdquo; in my commit message (to prevent the continuous integration build from running for a simple documentation fix), I got a tip in the form of less than 1% of a Bitcoin. This was getting exciting.</p>

<p>Emboldened, I decided to try for something bigger. As I was reading Addy Osmani&rsquo;s <a href="http://addyosmani.github.io/backbone-fundamentals/">Developing Backbone.js Applications</a>, I noticed that a portion of the chapter on Marionette was not working. I dug into the source code for the book and for the Marionette example, and discovered they didn&rsquo;t match. I updated the book and submitted a pull request. Several days later, it was merged. I contributed to a book! Cool!</p>

<p>About this time, I saw that one of my classmates&#8217; mentors, Austen Ito, was doing the <a href="http://24pullrequests.com/">24 Pull Requests</a> challenge, submitting a pull request every day in December up until Christmas. I decided to jump on board.</p>

<p>In my pursuit of Rails Ninja status, I&rsquo;d been working on learning how to use engines. Ryan Bigg&rsquo;s <a href="https://leanpub.com/multi-tenancy-rails">Multitenancy with Rails</a> and Jos Valim&rsquo;s <a href="http://pragprog.com/book/jvrails2/crafting-rails-4-applications">Crafting Rails 4 Applications</a> got me off to a good start. An excellent start, actually. I decided to go further with my favorite source for Rails research, <a href="http://guides.rubyonrails.org">The Rails Guides</a>. I was disappointed to find that the engine guide was pretty hard to read, mostly due to a lot of run-on sentences. I decided to edit the whole thing as I went.</p>

<h2>Git Squash</h2>

<p>Things weren&rsquo;t as easy with this pull request. As I went through and made spelling and grammar fixes, I also removed some word wrapping. I submitted the pull request. The Rails contributors on Github were very nice, but were hoping I could change about seven things. I did, and submitted a new commit. Then they asked me to fix the wrapping in a separate commit, so I did that. Now I was up to four commits, when I should really only have two.</p>

<p>How did that git squashing thing work again?</p>

<p>I could have created a new branch, cherry-picked my commits, and submitted a new pull request. But I was feeling stubborn, and wanted to figure out squashing. I asked many of my friends and teachers. We tried <code>git rebase -i</code>, like all of the articles we found online suggested, but it wasn&rsquo;t working. I&rsquo;d either end up with the same commits, or lost in some kind of detached head rebasing state that I couldn&rsquo;t resolve. <a href="http://www.ndpsoftware.com/git-cheatsheet.html">My favorite guide to git</a> was no help. Even <code>git reflog</code> wasn&rsquo;t pointing the way out.</p>

<p>In the end, Katrina Owen came to the rescue (via email, from home). Here was my message to her:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>Hey Katrina,
</span><span class='line'>
</span><span class='line'>Thanks for helping. I was trying to use git rebase -i for this, but not getting the results I wanted.
</span><span class='line'>
</span><span class='line'>I'm contributing edits to the rails guide for engines. I was asked to revise my original commit, then squash it. I was also asked to send a separate commit with word wrapping.
</span><span class='line'>
</span><span class='line'>Here's the history of the branch I'm working on:
</span><span class='line'>
</span><span class='line'>* 0cdcf46 2013-12-11 | Word wrap to engines guide \[ci skip] (HEAD, patch-4) [Ben Lewis]
</span><span class='line'>* 492ac2a 2013-12-11 | Revision to guide edits (origin/patch-4) [Ben Lewis]
</span><span class='line'>* b55a803 2013-12-04 | Clarification, grammar fixes, punctuation, and capitalization \[ci skip] [Ben Lewis]
</span><span class='line'>* 49ed8a1 2013-12-04 | Run Travis tests using Ruby 2.1.0-preview2 too [Santiago Pastorino]
</span><span class='line'>
</span><span class='line'>I need to squash them so that I only have 0cdcf46 and 492ac2a (although I would like to take the message from b55a803). Here's what I want to see:
</span><span class='line'>
</span><span class='line'>* 0cdcf46 2013-12-11 | Word wrap to engines guide \[ci skip] (HEAD, patch-4) [Ben Lewis]
</span><span class='line'>* 492ac2a 2013-12-11 | Clarification, grammar fixes, punctuation, and capitalization \[ci skip] [Ben Lewis]
</span><span class='line'>* 49ed8a1 2013-12-04 | Run Travis tests using Ruby 2.1.0-preview2 too [Santiago Pastorino]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>What should I do?
</span><span class='line'>
</span><span class='line'>Thanks!
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s what she replied:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>A separate commit, or a separate pull request?
</span><span class='line'>
</span><span class='line'>If it's a separate pull request, here's how I'd do it:
</span><span class='line'>
</span><span class='line'>Create a separate branch from the most recent upstream master,
</span><span class='line'>and then do:
</span><span class='line'>
</span><span class='line'>   git cherry-pick 0cdcf46
</span><span class='line'>
</span><span class='line'>Then you can submit that branch as a separate pull request.
</span><span class='line'>
</span><span class='line'>On your branch that you've been working on, you could get rid
</span><span class='line'>of the most recent commit with
</span><span class='line'>
</span><span class='line'>   git reset --hard HEAD~1
</span><span class='line'>
</span><span class='line'>Then you can rebase -i with:
</span><span class='line'>
</span><span class='line'>   git rebase -i HEAD~4 # or something
</span><span class='line'>
</span><span class='line'>Next to the second commit that you want to squash into the first commit,
</span><span class='line'>replace 'pick' with 'squash'.
</span><span class='line'>
</span><span class='line'>Then write and quit, and it will re-open a new editor and ask you to fix
</span><span class='line'>the message. It will give you both of the previous ones, and you can
</span><span class='line'>pick one or the other or write a whole new message.
</span></code></pre></td></tr></table></div></figure>


<p>It was an easy fix: just use the HEAD~X for the number of commits you want to work with. Worked like a charm! I was able to squash the commits just as I wanted, and resubmit them. Next up, I had to remove the wrapping changes from the first commit (b55a803). This was a good chance to practice squashing again. This time around, I did end up using some cherry-picking magic from a separate branch, but I was still able to squash my commits. Success!</p>

<p>It&rsquo;s crazy how hard it has been to get used to git. Probably, a lot of the overwhelm comes from <a href="https://www.codefellows.org/blogs/this-is-why-learning-rails-is-hard">all of the other things</a> I have been learning at the same time. Anyway, now I know how to squash.</p>

<h2>Moving Forward</h2>

<p>I&rsquo;m really interested in contributing some actual code to projects. I&rsquo;ve been looking around at the issues on Rails, Sorcery, Mechanize, and other popular gems, but I often find that they&rsquo;re way over my head. I was able to fix a small todo in the <a href="http://www.exercism.io">Exercism</a> source code, but beyond that, I&rsquo;m pretty much lost. If anyone reading this has any good leads for something that an advanced beginner can do (somewhere between documentation edits and http response parsing level insanity) please hit me up on Twitter!</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Multitenancy and Legacy Code]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/12/06/multitenancy-and-legacy-code/"/>
    
    <updated>2013-12-06T09:03:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/12/06/multitenancy-and-legacy-code</id>
    
    <content type="html"><![CDATA[<p>This week at gSchool, we started a new rails project called <a href="http://tutorials.jumpstartlab.com/projects/fourth_meal.html">Fourth Meal</a>. The assignment&rsquo;s basic premise is to build a multi-tenant platform for restaurant ordering, along the lines of <a href="https://www.grubhub.com/">GrubHub</a>. This is our first time dealing with multi-tenancy. It&rsquo;s also the first time that we are building from a legacy code base - we&rsquo;re using our last projects. Mine was <a href="http://onoburrito.herokuapp.com">OnoBurrito</a>, and that&rsquo;s the project my group chose to build on for this assignment. Finally, this will also be the first time we optimize our apps for performance.</p>

<h2>Project Management</h2>

<p>We&rsquo;re using Pivotal Tracker very seriously in Fourth Meal, with our instructors pretending to be clients that have hired us to build this app. I&rsquo;ve found Tracker restrictive in the past. But I think I felt that way because I was using it as more of a to-do list than a project management tool. After having Jeff help us write about 13 clear stories yesterday, I feel a lot more positive about using it to drive my group&rsquo;s progress. At this point, Tracker is helping me feel more organized. I can translate stories into tests and use Capybara to drive development &ldquo;from the top down&rdquo;.</p>

<h2>Legacy Code</h2>

<p>Although we&rsquo;re working from code that I had a large part in writing, I feel like I&rsquo;m floundering to turn OnoBurrito into a platform. There are a lot of things I would do differently if I were to build the app over again. For example, the category views are stuck inside of the item views, making it really hard to separate them. We also used Active Admin before, so we&rsquo;ve had to rip it out and start the admin panel over again. My group decided to retrofit the admin part of Billy&rsquo;s restaurant onto Ono Burrito, and it&rsquo;s been kind of tricky to get everything working. Currently, I&rsquo;m having a lot of trouble getting carts and orders working. It&rsquo;s hard to decide which of the pieces to store in the session, application, and database.</p>

<h2>Class Progress</h2>

<p>We&rsquo;re now just past the halfway mark for gSchool. Although I can see how other programs would stop here and send their students out into the marketplace, I&rsquo;m very glad that we have some time left to practice proper Test Driven Development, learn about scaling and performance optimization, and hone our Rails chops.</p>

<p>I do feel like I&rsquo;m starting to lose momentum a little bit. I was going full-bore every day (except weekends) up until now, but I could feel that burnout was around the corner. So I&rsquo;ve throttled back a little bit, taking time to cook, read, and exercise so I feel more balanced. I&rsquo;m still totally dedicated to being the best developer I can be by the end of the program, and I think that these changes will help me do that. Meanwhile, I feel like a lot of my classmates have been making amazing progress. No matter who I work with lately, I feel like I am collaborating with a confident, smart, and capable programmer.</p>

<h2>Young Entrepreneurs</h2>

<p>Last night we kicked off a project with Young Entrepreneurs. Several school-aged children came to Galvanize and met with us to get help building a website for their businesses. I&rsquo;m in a small group with Nathaniel and Meeka, two classmates that I really enjoy working with. We&rsquo;re helping a 15-year-old entrepreneur named Jonah, who runs a local snack company. It&rsquo;s a little disheartening that we won&rsquo;t be able to use Sinatra or Rails to help him him, because he&rsquo;ll need the ability to update his site, and we likely don&rsquo;t have time to build a content management system. We&rsquo;ll probably help him get going on <a href="http://www.wix.com">Wix</a>, or a similar platform.</p>

<p>I feel a little conficted about this project. In a way, the kickoff was really bad timing, because I&rsquo;m feeling so overwhelmed by Fourth Meal. On the other hand, it&rsquo;s nice to get back to working with kids. That&rsquo;s the thing I miss most about my previous career as a teacher. More importantly to me, I&rsquo;ve been focusing on trying to find ways to be more generous, so this is a good opportunity to practice doing that.</p>

<h2>New Mentor</h2>

<p>I met my new mentor, Justin Smestad, this week. He&rsquo;s a maintainer of the <a href="https://github.com/hassox/warden">Warden</a> gem, a security specialist, and a musician. I think it&rsquo;s going to be a good fit. I&rsquo;ll miss my old mentor, Mike Pack, but I think that he&rsquo;s willing to keep working with me too. Now I&rsquo;ll have twice the support!</p>

<h2>Overall</h2>

<p>I&rsquo;m feeling really excited about web development. Thanksgiving break really helped me rest up and feel ready to tackle more. I am learning a lot of new things all the time, and I love it. On the other hand, I am feeling somewhat overwhelmed by Rails, and beginning to consider the job search makes me a little anxious. In the end, I&rsquo;m optimistic. I think that the coming weekend will help me get grounded, and I&rsquo;ll come back next week ready to get some good work done on Fourth Meal.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Practical Object-Oriented Design in Ruby - Takeaways]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/12/01/practical-object-oriented-design-in-ruby-takeaways/"/>
    
    <updated>2013-12-01T06:10:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/12/01/practical-object-oriented-design-in-ruby-takeaways</id>
    
    <content type="html"><![CDATA[<p><img class="right" src="http://s5.postimg.org/yh888oh3b/POODR.jpg" width="250" height="327" title="Practical Object-Oriented Design in Ruby" alt="The cover of a programming book"></p>

<p>I just finished reading <a href="http://www.poodr.com/">Practical Object-Oriented Design in Ruby</a> by Sandi Metz.</p>

<p>Here were my takeaways.</p>

<h2>Object-Oriented Design</h2>

<ul>
<li>Plan your application structure around the messages, rather than the objects.</li>
<li>Objects should be seen as black boxes that can receive and send specific messages.</li>
<li>Use <a href="http://www.tracemodeler.com/articles/a_quick_introduction_to_uml_sequence_diagrams/">UML sequence diagrams</a> to help clarify architectural decisions before writing code.</li>
<li>Defer design decisions as long as you can, waiting for more information. Having three concrete examples of an object before commiting to a solution is best.</li>
</ul>


<h3>Embracing Change</h3>

<ul>
<li>Write code that is: transparent, reasonable, usable, exemplary (TRUE).</li>
<li>Write classes and methods that have only a single responsibility (Single Reponsibility Principle).</li>
<li>Subtypes should be substitutable for their supertypes (Liskov Substitution Principle).</li>
</ul>


<h3>Dependencies</h3>

<ul>
<li>Dependencies are best managed through Injection, Isolation, and Reliance on Abstractions.</li>
<li>Dependency Injection: when you have a dependency, inject it into your object as an attribute, without calling another class directly. Then your object can use any other (duck-typed) object that responds to the needed method call.</li>
<li>Isolation: if you must keep a dependency, isolate it from other code to make it easy to spot and refactor.</li>
<li>Reliance on Abstractions: objects should depend on things that change less than they do (abstractions).</li>
</ul>


<h3>Interfaces</h3>

<ul>
<li>Minimize an object&rsquo;s need for context to get its job done.</li>
<li>Write public interfaces that are explicitly identified, are about <em>what</em> more than <em>how</em>, have names that will not change, and take initialization attributes in a hash (so that order and presence are not required).</li>
<li>Law of Demeter: dont reach through a class to get at another classs data or methods.</li>
</ul>


<h3>Duck-Types</h3>

<ul>
<li>Sometimes an object expects many different subjects to all respond to the same method. Even if they are of different classes, they all respond. These are duck-types.</li>
</ul>


<h3>Three Approaches to OO Architecture</h3>

<ol>
<li><p>Use inheritance for <em>is-a</em> relationships. This means using classical inheritance and module mix-ins. With this approach, big changes can be made with little code, which is a double-edged sword. Inheritance is specialization. - Bertrand Meyer</p></li>
<li><p>Use duck-types for <em>behaves-like-a</em> relationships. Use when there is a <em>role</em> that needs to be filled (e.g. <em>schedulable</em>).</p></li>
<li><p>Use composition for <em>has-a</em> relationships. Composition is modular and flexible, but harder to comprehend all at once. Use composition when the behavior is more than the sum of its parts. - Grady Booch</p></li>
</ol>


<h3>Testing</h3>

<ul>
<li>Dont write tightly coupled tests.</li>
<li>Test the right thing only once, in the right place.</li>
<li>Concentrate on incoming and outgoing messages that cross an objects boundaries. That is, test its most stable part: its interface.</li>
<li>Incoming messages should be tested for the state they return. Use <em>object doubles</em> for this, when appropriate.</li>
<li>Outgoing command messages should be tested to ensure they are sent. Use <em>mocks</em> for this.</li>
<li>Outgoing query essays should not be tested.</li>
<li>Testing duck-types: write a module and mix it into the test for each of the duck-types.</li>
</ul>


<h2>Conclusion</h2>

<p>I really liked this book. It clarified some of the little parts of writing code that had previously eluded me. I can&rsquo;t wait to put some of its principles into practice!</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Full Stack Javascript]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/11/22/full-stack-javascript/"/>
    
    <updated>2013-11-22T11:12:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/11/22/full-stack-javascript</id>
    
    <content type="html"><![CDATA[<h2>UPDATE:</h2>

<p>I now have a working version of JetFuel Express live on Heroku at <a href="http://jfx.herokuapp.com/">http://jfx.herokuapp.com</a>. Please check it out!</p>

<p>This was JavaScript week at gSchool. For me, this was great. As I&rsquo;ve been learning Ruby, I&rsquo;ve been working on a lot of JavaScript on the side. From what I hear, knowing JS is going to be indispensible as I enter the professional development world. Having done a bit of browser scripting with vanilla JS and jQuery in the past, I&rsquo;ve recently been digging into <a href="http://fluxusfrequency.github.io/blog/2013/10/26/so-many-javascript-libraries/">libraries and frameworks</a>. In the last couple of weeks, I&rsquo;ve been focusing really hard on Backbone.js in particular, and this week gave me a chance to apply my skills with it to build a project. As I went along, I discovered quite a few other new tools written in JavaScript. After hacking away all week, my key takeaway was this:</p>

<p>You can develop full stack with Javascript.</p>

<p>I decided to try to build <a href="http://tutorials.jumpstartlab.com/projects/jet_fuel.html">JetFuel</a>, a Jumpstart Lab project in which you clone <a href="https://bitly.com/">Bitly</a>. But instead of building it with ActiveRecord and Sinatra, I decided to build it all in JS.</p>

<p>At the moment, I have a basic link shortening service working. Here&rsquo;s a glimpse of what it looks like:</p>

<p><img src="http://s5.postimg.org/ihxudv1xj/Jet_Fuel_Express_Production_Shot.png" title="JetFuel Express" alt="A Bitly clone website in production"></p>

<p>And here are the technologies I&rsquo;m using:</p>

<h2>The App</h2>

<h3><a href="http://backbonejs.org/">Backbone.js</a></h3>

<p>I&rsquo;ve been working really hard at learning Backbone, a client-side MVC (actually MV*) library, over the past few weeks. I had started to look into Ember.js, and was having a hard time. My mentor, Mike Pack (who works at <a href="http://modeset.com/">Mode Set</a>), suggested looking into Backbone first, because: &ldquo;you&rsquo;re going to burn a lot of mental cycles trying to learn Ember and Rails at the same time&rdquo;. This has turned out to be some really good advice. For me, Backbone fairly intuitive, yet still quite challenging to learn.</p>

<p>I did a few tutorials. I found this <a href="http://railscasts.com/episodes/323-backbone-on-rails-part-1">RailsCasts</a> one to be the most approachable. This <a href="https://tutsplus.com/course/backbone-on-rails/">Nuttuts+ Premium Tutorial</a> was interesting. It was written with Coffeescript and Handlebars. There were <a href="http://coenraets.org/blog/2011/12/backbone-js-wine-cellar-tutorial-part-1-getting-started/">some</a> <a href="https://www.youtube.com/watch?v=FZSjvWtUxYk">others</a> that were less remarkable, but they still helped me get familiar with the library.</p>

<p>I still felt like I needed to understand more, so I checked out the book <a href="http://addyosmani.github.io/backbone-fundamentals/">Developing Backbone.js Applications</a> by Addy Osmani, available free online. It covers many Backbone topics, and has quite a few tutorials. In the first one, it walks you through building a simple to-do app called <a href="http://todomvc.com/">TodoMVC</a> in Backbone.</p>

<p>My favorite tutorial from the book was the <a href="http://addyosmani.github.io/backbone-fundamentals/#exercise-2-book-library---your-first-restful-backbone.js-app">Book Library</a> tutorial. It really makes it clear how to use Backbone to talk to an API. It also teaches you build that API in Express.js. It was essentially the inspiration for my app.</p>

<p>Backbone can be really hard to debug. The value of the keyword &lsquo;this&rsquo; can get kind of tricky, in particular. For example, in my UrlsView class, the value of &lsquo;this&rsquo; shifts from the Backbone View object to the urlCollection, so I have to assign it to &lsquo;that&rsquo; before passing it into the callback function. This was a subtle problem that was breaking my view, until Mike helped me fix it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">jetfuelexpress</span> <span class="o">=</span> <span class="nx">jetfuelexpress</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">jetfuelexpress</span><span class="p">.</span><span class="nx">UrlsView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;.url-list&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">initialUrls</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">urlCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">jetfuelexpress</span><span class="p">.</span><span class="nx">UrlCollection</span><span class="p">();</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">urlCollection</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">reset</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">that</span><span class="p">.</span><span class="nx">fetched</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">urlCollection</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderUrl</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">urlCollection</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s a look at how I built the rest of my stack:</p>

<h2>The Database</h2>

<h3><a href="http://www.mongodb.org/">MongoDB</a></h3>

<p>I&rsquo;m using of MongoDB to store my data. It plays nicely with my other components, since it stores documents in a JSON-like format. It&rsquo;s also handy that it uses JavaScript internally on the server-side, and has a shell that&rsquo;s based on JS. As a database, it feels a little crazy, because it doesn&rsquo;t auto=increment an id attribute like Postgres. I like it though. It&rsquo;s fast and flexible. My server interfaces with the database via:</p>

<h3><a href="http://mongoosejs.com/">Mongoose.js</a></h3>

<p>It&rsquo;s summed up well on the Mongoose website. Mongoose is a &ldquo;MongoDB object modeling tool designed to work in an asynchronous environment&rdquo;. It&rsquo;s like DataMapper or ActiveRecord in Ruby. It has some really powerful validations baked in:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">UrlSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">originalUrl</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">validate</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">u</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^((http(?:s)?\:\/\/)?[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*\.[a-zA-Z]{2,6}(?:\/?|(?:\/[\w\-]+)*)(?:\/?|\/\w+\.[a-zA-Z]{2,4}(?:\?[\w]+\=[\w\-]+)?)?(?:\&amp;[\w]+\=[\w\-]+)*)$/</span><span class="p">);</span> <span class="p">},</span>
</span><span class='line'>            <span class="s1">&#39;Visits must be positive!&#39;</span><span class="p">]</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">slug</span>        <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">active</span>      <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">visits</span>      <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">validate</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">},</span>
</span><span class='line'>            <span class="s1">&#39;Visits must be positive!&#39;</span><span class="p">]</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">userId</span>      <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">createdDate</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Server</h2>

<h3><a href="http://nodejs.org/">Node.js</a></h3>

<p>Built on Google&rsquo;s V8 JavaScript engine, Node is a super fast platform that compiles JS directly to the hardware without having to be interpreted. It has &ldquo;a built-in HTTP server library, making it possible to run a web server without the use of external software&rdquo;.</p>

<h3><a href="http://expressjs.com/%E2%80%8E">Express.JS</a></h3>

<p>This lovely framework is the foundation of my backend. It is architecturally based on Sinatra, and is very similar to work with. It was really easy to get a project up and running quickly in Express using Node Package Manager (see below). Since it&rsquo;s built on Node, it is very fast. I used it to set up an API server to send and recieve JSON requests from my front end.</p>

<h2>The Tests</h2>

<h3><a href="http://pivotal.github.io/jasmine/">Jasmine-Node</a></h3>

<p>We used this testing framework quite a bit in class for <a href="http://exercism.io/">Exercism</a> exercises. It felt like a natural choice. Although I am usually more comfortable with &lsquo;assert&rsquo; style test statements like you find in Minitest, I found Jasmine to be pretty intuitive. Here&rsquo;s an example of one of my tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;api route&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Url</span><span class="p">.</span><span class="nx">remove</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(){});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should respond successfully with to an API request&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">request</span><span class="p">(</span><span class="s2">&quot;http://localhost:3000/api&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="s2">&quot;JetFuelExpress API is running!&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">error</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3><a href="http://visionmedia.github.io/mocha/">Mocha</a></h3>

<p>A couple days into this project, I was tweeting about what I was up to, and an Express.js dev tweeted back at me, suggesting I check out his <a href="http://webapplog.com/expressworks/">Express.js tutorials</a>. He also recommended the Mocha testing framework. I haven&rsquo;t had a chance to dig in yet, but it looks promising. The website says that you can use your favorite style of assertion (&lsquo;should&rsquo;, &lsquo;expect&rsquo;, or &lsquo;assert&rsquo;) by loading different libraries - Chai, Should.js, Expect.js, or Better Assert.</p>

<h3><a href="http://zombie.labnotes.org/">Zombie.js</a></h3>

<p>I was looking around for some kind of acceptance test solution along the lines of Capybara. I couldn&rsquo;t really find anything I liked, but I did stumble on this &ldquo;headless browser&rdquo; testing framework. Although it looks promising, I&rsquo;ve had a lot of trouble making it work the way I want. I wouldn&rsquo;t really recommend it, unless you have extra time to figure out how to make it do what you want.</p>

<h2>The View</h2>

<h3><a href="http://handlebarsjs.com/">Handlebars.js</a></h3>

<p>After giving a lightning talk about <a href="http://mustache.github.io/">Mustache</a> a few weeks ago, I just had to try Handlebars for this project. It went pretty well, as long as I didn&rsquo;t try to inject anything that was null into my templates. When I did that, it killed the server.</p>

<h3><a href="http://www.getbootstrap.com">Bootstrap</a></h3>

<p>Because I was already in over my head with all of these JavaScript libraries, I decided to punt on the design for this one. I bought a template from <a href="http://wrapbootstrap.com/">Wrap Bootstrap</a>.</p>

<h2>Bits and Pieces</h2>

<h3><a href="http://gruntjs.com/">Grunt.js</a></h3>

<p>Having a browser fetching 18 JavaScript files can be slow, so it&rsquo;s nice to uglify and concatenate them all into one big file. Grunt can automate this task for you. It&rsquo;s sort of like Rake in Ruby. Here&rsquo;s what that looked like. I copied the code from gSchool[0] student Raphael Weiner&rsquo;s <a href="https://github.com/raphweiner/elefeely-ui">Elefeely UI</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">connect</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">port</span><span class="o">:</span> <span class="s2">&quot;3000&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="nx">hostname</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="nx">keepalive</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">uglify</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">build</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;main.js&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;main.js&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">concat</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;src&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;public/javascripts/lib/jquery-1.10.1.min.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/lib/json3.min.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/lib/handlebars.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/lib/underscore-min.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/lib/backbone-min.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/app.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/routers/router.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/models/url_model.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/collections/url_collection.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/app_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/header_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/footer_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/shorten_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/home_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/url_view.js&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;public/javascripts/views/urls_view.js&quot;</span><span class="p">],</span>
</span><span class='line'>        <span class="s1">&#39;dest&#39;</span><span class="o">:</span> <span class="s1">&#39;main.js&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-connect&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-concat&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-uglify&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Node Package Manager (NPM)</h3>

<p>I really like how easy it is to install Node.js dependencies. I&rsquo;ve been spoiled with Bundle, so it felt comfortable to be able to add things I needed with ease. You just declare your dependencies in a package.json file in your application root, then run &lsquo;npm install&rsquo;. The package file is in JSON, so it&rsquo;s not as pretty as a Gemfile, but it will give you all the things you need. Here&rsquo;s what mine looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;JetFuelExpress&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;A url shortening service&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;private&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;node app.js&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;express&quot;</span><span class="o">:</span> <span class="s2">&quot;3.4.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;jade&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;less-middleware&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.4.9&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;request&quot;</span><span class="o">:</span> <span class="s2">&quot;2.27.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;mongoose&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.5.5&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;grunt&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;grunt-contrib-connect&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;grunt-contrib-concat&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;grunt-contrib-uglify&quot;</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Wrapping Up</h2>

<p>Coming to JS app development from Ruby, I felt really uncomfortable at first. There are <strong><em>so</em></strong> many JavaScript libraries and frameworks. I was pretty sure I was in over my head. But somehow I held it together. I think it&rsquo;s because JS has components that serve the same functions as certain Ruby gems:</p>

<p>Mongoose is kind of like ActiveRecord.</p>

<p>Express  is kind of like Sinatra.</p>

<p>Jasmine  is kind of like RSpec.</p>

<p>Zombie   is kind of like Capybara.</p>

<p>Grunt    is kind of like Rake.</p>

<p>NPM      is kind of like Bundle.</p>

<p>Backbone isn&rsquo;t really like anything, but at least its MV* pattern is close enough to Rails that I feel at home.</p>

<p>I saw this <a href="http://coding.smashingmagazine.com/2013/11/21/introduction-to-full-stack-javascript/">cool article</a> in the JavaScript Weekly newsletter today. Reading it made me understand what I&rsquo;d been learning all week: full stack JavaScript development. Up until then, I hadn&rsquo;t quite seen it for what it was.</p>

<p>JS is not as friendly an environment as Ruby, where you get to use intuitive syntax, the community is better established, and there are lots and lots of gems available. But it is very fast and scalable, and at least the components feel familiar when transferring from Sinatra and Rails.</p>

<p>I&rsquo;m looking foward to continuing with JetFuel Express. It&rsquo;s been a good project for extending my understanding of JavaScript.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Dinner Dash Complete]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/11/18/dinner-dash-complete/"/>
    
    <updated>2013-11-18T08:12:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/11/18/dinner-dash-complete</id>
    
    <content type="html"><![CDATA[<p>Last Thursday, my group and I wrapped up the <a href="http://tutorials.jumpstartlab.com/projects/dinner_dash.html">Dinner Dash</a> tutorial we were working on. It was essentially the website for a restaurant with an administrative back end.</p>

<p>Here&rsquo;s a link to our <a href="http://onoburrito.herokuapp.com/">Dinner Dash Project</a>.</p>

<p><img src="http://s5.postimg.org/5ddkt77uv/Ono_Burrito_Website_Screenshot.png" title="Ono Burrito" alt="A Ruby on Rails website"></p>

<p>I learned a lot. Aside from this being my first full-blown Rails project, I discovered many other useful things about Rails projects along the way.</p>

<h2>Rails Gems</h2>

<p>Here are some of the technologies I tried out for the first time</p>

<ul>
<li><p><a href="http://sass-lang.com/">SASS/CSS</a>. I intentionally spent a lot of time on the front end in this project. Although I feel strong in HTML5/CSS3, I would really like to get better at design. Because of this, I worked hard on building up the view <strong><em>without Bootstrap</em></strong>, using partials and SCSS to make things cleaner. I was also reading <a href="http://www.therailsview.com/">The Rails View</a>, and tried to incorporate lessons learned from it into what I was doing.</p></li>
<li><p><a href="http://guides.rubyonrails.org/">The Rails Guides</a>. After losing my mind trying to figure out how to work with form_for during the first week of the project, I discovered the Rails Guides. I read all of the ActiveRecord and ActionView documentation over the weekend, and felt a lot more confident afterwards. The Rails Guides rock!</p></li>
<li><p><a href="http://www.activeadmin.info/">Active Admin</a>. This little number let us add an administrative backend to our app with next to no effort. It was kind of cheating to use it here, but it was also really cool to find out about. It may come it very handy in the future.</p></li>
<li><p><a href="https://github.com/nixme/jazz_hands">Jazz Hands</a>, a gem that improves the Rails Console by making it Pry-based, and adding pretty print to make it easier to look through data.</p></li>
<li><p><a href="https://github.com/colszowka/simplecov">Simplecov</a>. This is a great way to check your test coverage. I&rsquo;m somewhat ashamed to admit that our project was only about 69% covered.</p></li>
<li><p><a href="https://github.com/stympy/faker">Faker</a>. Made it easy to generate seed data for our database.</p></li>
<li><p><a href="https://github.com/evrone/quiet_assets">Quiet Assets</a>. I got pretty tired of looking at the assets in Guard every time I ran a test. Quiet Assets made the server logs a lot easier to look at.</p></li>
</ul>


<h2>Soft Skills</h2>

<p>One of the most challenging aspects of the project for me was managing the social aspect of this project. Since I was percieved as the strongest member of our group programming-wise, the others looked to me for guidance. But I am not a natural leader. Although I was able to chart our best course for finishing the project, I didn&rsquo;t do a great job of checking in with everyone emotionally. At the end, I found out that one member of my group felt left out and behind. In the future, when I lead, I will work to make more space for people to express how things are going, not just in terms of code progress, but also how they&rsquo;re feeling about the project.</p>

<p>We also used <a href="https://www.pivotaltracker.com/">Pivotal Tracker</a>. This was a first for me. Although I liked learning to use Gherkin, I wasn&rsquo;t wild about the application&rsquo;s UI. We ended up switching to Milestones and Issues on Github for the last part of the project.</p>

<p>However, looking back now, I actually think that using Pivotal Tracker did improve my experience, compared with the previous project. I&rsquo;ll definitely give it another go for the next project. I would really like to try translating the Tracker stories into Capybara or Cucumber tests right out of the gate.</p>

<h2>What&rsquo;s Next</h2>

<p>This week, we&rsquo;ll be working on JavaScript. I&rsquo;m really excited about this, because I&rsquo;ve been working hard at it on the side. Right now I&rsquo;m working through Addy Osmani&rsquo;s <a href="http://addyosmani.github.io/backbone-fundamentals/">Developing Backbone.js Applications</a>, and I&rsquo;m loving it. I&rsquo;m also building a Backbone app with a Rails API with my mentor as a side project.</p>

<p>After Thanksgiving, we&rsquo;ll be building a multi-tenant platform based on Dinner Dash: <a href="http://tutorials.jumpstartlab.com/projects/fourth_meal.html">Fourth Meal</a>. It looks intimidating, but I&rsquo;m stoked to be able to build a platform like this. It seems like you could build a great business around a platform like this. <a href="http://bandzoogle.com/">Bandzoogle</a> comes to mind.</p>

<p>We&rsquo;re less than halfway through gSchool now, but we&rsquo;ve learned many of the skills we&rsquo;ll need as Ruby on Rails developers. I&rsquo;m glad that we&rsquo;ll have time to practice these skills for the rest of the program. I think I&rsquo;ll feel very confident about what I&rsquo;m doing when we graduate in February. I shudder to think that if I had gone to a different bootcamp, I might be heading out into the job market right now. Although I can certainly build web apps now, I still have so much to learn. I&rsquo;m really glad to be at gSchool; the curriculum is excellent, my peers are supportive, hardworking, and smart, and my teachers are always willing to go the extra mile to help me figure things out.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[JavaScript Enlightenment]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/11/10/javascript-enlightenment/"/>
    
    <updated>2013-11-10T21:30:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/11/10/javascript-enlightenment</id>
    
    <content type="html"><![CDATA[<p>I read <a href="http://www.javascriptenlightenment.com/">JavaScript Enlightenment</a> by Cory Lindley over the weekend. It was the perfect thing for me right now, as an advanced beginner. It really breaks down all the parts of tha langauge in an understandable way. I feel like I get the &lsquo;big picture&rsquo; much better after having read it. Here are some notes I took along the way.</p>

<h1>Explanations</h1>

<h2>Objects</h2>

<p>In javascript, object is king.
An object is a set of properties with keys and values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>
</span><span class='line'><span class="nx">myObject</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="err"></span><span class="nx">Ben</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">myObject</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">29</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Javascripts Native Object Constructors</h2>

<p>These are the nine object constructors built into JavaScript:</p>

<ul>
<li>Number()</li>
<li>String()</li>
<li>Boolean()</li>
<li>Object()</li>
<li>Array()</li>
<li>Function()</li>
<li>Date()</li>
<li>RegExp()</li>
<li>Error()</li>
</ul>


<p>Theres also Math, which is not a constructor. It acts like an instantiated object.</p>

<p>Thus, you can do:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But NOT:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myMath</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="k">new</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Contructors &amp; Instantiating With Constructors</h2>

<p>Every object can be built with a constructor. You instantiate the object with the new keyword.</p>

<p>Heres the syntax:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also define your own constructors, like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">age</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>     <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>     <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// People can be instantiated like this:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Ben</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="err"></span><span class="nx">Ben</span><span class="err"></span><span class="p">,</span> <span class="mi">29</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Object Literal Notation</h2>

<p>Instead of using the new keyword, you can create an object with the literal syntax:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">*</span><span class="kd">var</span> <span class="nx">myNumber</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
</span><span class='line'><span class="o">*</span><span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="err"></span><span class="nx">Hello</span><span class="p">,</span> <span class="nx">world</span><span class="o">!</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="o">*</span><span class="kd">var</span> <span class="nx">myBoolean</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myRegExp</span> <span class="o">=</span> <span class="sr">/.*/</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myError</span> <span class="o">=</span> <span class="p">(</span><span class="err"></span><span class="nx">crap</span><span class="o">!</span><span class="err"></span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>* These tjree literals do NOT return an object, but a Javascript primitive. Their constructors DO return objects.
A primitive is an irreducible value.
If they are later treated as an object, for example by calling a method on them, they are temporarily wrapped in an object.</p>

<h2>The Third Notation</h2>

<p>Another way to create a primitive (does not use the new keyword):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myNumber</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">23</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myBoolean</span> <span class="o">=</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Complex Objects</h2>

<p>Objects that contain multiple values, which can be primitives or other complex objects.
These are objects created created with the new keyword, or literal notation (and are NOT one of the primitives).</p>

<p>They are also known as composite objects or a reference types.
These objects store an address reference to an object.
If you copy them, the copies are also references to the same address.
Therefore, they will all mutate if the object is changed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVarC</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="err"></span><span class="nx">Ben</span><span class="err"></span><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVarD</span> <span class="o">=</span> <span class="nx">myVarC</span><span class="p">;</span>
</span><span class='line'><span class="nx">myVarC</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="err"></span><span class="nx">John</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myVarD</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="err"></span><span class="nx">John</span><span class="err">&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Complex Objects - Native Properties</h2>

<h3>&lsquo;constructor&rsquo;</h3>

<p>In addition to their basic property keys, all instantiated objects have a property called &lsquo;constructor&rsquo;.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVarE</span> <span class="o">=</span> <span class="p">{</span><span class="nx">age</span><span class="o">:</span> <span class="mi">29</span><span class="p">};</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myVarE</span><span class="p">.</span><span class="nx">constructor</span><span class="p">);</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="nb">Object</span>
</span></code></pre></td></tr></table></div></figure>


<h3>&lsquo;instanceof&rsquo;</h3>

<p>The type of an instantiated object can be checked with &lsquo;instanceof&rsquo;.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">MyVarF</span> <span class="o">=</span> <span class="p">{</span><span class="nx">gender</span><span class="o">:</span> <span class="err"></span><span class="nx">male</span><span class="err"></span><span class="p">};</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myVarF</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">();)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="nx">True</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Instance Properties</h3>

<p>Instances of a constructor can be given their own properties. This includes objects created from the nine native constructors, but does not include primitives.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVarG</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">();</span>
</span><span class='line'><span class="nx">myVarG</span><span class="p">.</span><span class="nx">prop</span> <span class="o">=</span> <span class="err"></span><span class="nx">test</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myVarG</span><span class="p">.</span><span class="nx">prop</span><span class="p">);</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="err"></span><span class="nx">test</span><span class="err"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVarH</span> <span class="o">=</span> <span class="err"></span><span class="nx">hello</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">myVarH</span><span class="p">.</span><span class="nx">prop</span> <span class="o">=</span> <span class="err"></span><span class="nx">world</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myVarH</span><span class="p">.</span><span class="nx">prop</span><span class="p">);</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kc">undefined</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Accessing Properties</h3>

<p>Dot notation vs. Bracket notation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">myVarJ</span><span class="p">.</span><span class="nx">prop1</span> <span class="o">=</span> <span class="err"></span><span class="nx">test</span><span class="err"></span>
</span><span class='line'><span class="nx">myVarJ</span><span class="p">[</span><span class="err"></span><span class="nx">prop2</span><span class="err"></span><span class="p">]</span> <span class="o">=</span> <span class="err"></span><span class="nx">bar</span><span class="err"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Bracket notation has two advantages: it can be used to concatenate strings in the property name, and it can use reserved words.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Dot Notation</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">str</span> <span class="mi">1</span> <span class="o">=</span> <span class="err"></span><span class="nx">foo</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">str2</span> <span class="o">=</span> <span class="err"></span><span class="nx">bar</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVarK</span><span class="p">[</span><span class="nx">str1</span> <span class="o">+</span> <span class="nx">str2</span><span class="p">]</span> <span class="o">=</span> <span class="err"></span><span class="nx">baz</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">myVarK</span><span class="p">.</span><span class="nx">foobar</span><span class="p">;</span>
</span><span class='line'><span class="o">=&gt;</span><span class="err"></span><span class="nx">baz</span><span class="err">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Bracket Notation</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVarL</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err"></span><span class="nx">Algebra</span><span class="err"></span><span class="p">;</span>
</span><span class='line'><span class="nx">myVarL</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">];</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="err"></span><span class="nx">Algebra</span><span class="err"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Deleting Properties</h3>

<p>There is only only way to delete a property, which is to use the <em>delete</em> keyword.
Setting it to null or undefined will not remove it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">delete</span> <span class="nx">myVarL</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>hasOwnProperty()</h3>

<p>This method can be used to check if a property belongs to a given object. It may return false when an object&rsquo;s constructor does have the property; it only tells whether the object itself has the property.</p>

<h3>The Prototype Property</h3>

<p>All instances of a constructor contain this property. The properties of the &lsquo;prototype&rsquo; property itself are inherited by instances of the constructor.
Object.prototype is at the top of the inheritance chain, so all objects inherit from it. It is a very bad idea to change Object.prototype&rsquo;s properties.</p>

<h3>The &lsquo;in&rsquo; Keyword</h3>

<p>Checks for a property in an object. Similar to hasOwnProperty(), but it <em>does</em> look up the inheritance chain.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVar</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;toString&#39;</span> <span class="k">in</span> <span class="nx">myVar</span><span class="p">);</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Inheritance and Looping</h2>

<p>If you run a for/in loop on the properties of an object, it will return inherited properties unless you use a guard clause checking each property with hasOwnProperty().</p>

<h2>Host Objects</h2>

<p>These objects are provided by the JavaScript environment. Examples include &lsquo;window&rsquo; and &lsquo;document&rsquo; in the browser.</p>

<h2>The &lsquo;this&rsquo; Keyword</h2>

<p>The &lsquo;this&rsquo; keyword is available within the scope of a function, but it refers to the object which called the current function. It does not refer to the function itself, but its containing object.</p>

<p>&lsquo;this&rsquo; acts like any other variable, only it can&rsquo;t be modified.</p>

<p>In EcmaScript 3, calling &lsquo;this&rsquo; from a nested function referred to the Head Object. This was a serious mistake that was fixed in ES5. As a workaround, programmers used a variable &lsquo;that&rsquo; to keep track of the value of &lsquo;this&rsquo; inside of nested functions.</p>

<p>&lsquo;this&rsquo; can be overridden with call() and apply(), which redefine &lsquo;this&rsquo; to be their first parameter (the object they are targetting).</p>

<p>When using a constructor to create an instance, &lsquo;this&rsquo; refers to the object-to-be (the instance that has not yet been created). This pattern works for both properties and methods.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Scope</h2>

<p>There are three kinds of scope in JavaScript:</p>

<ol>
<li>Global Scope</li>
<li>Function Scope</li>
<li>Eval Scope</li>
</ol>


<p>There is no scope created by &lsquo;for&rsquo; or &lsquo;while&rsquo; loops, nor by &lsquo;if&rsquo;.</p>

<p>If a variable is declared without the keyword &lsquo;var&rsquo;, it is created in the global scope. This is to be avoided.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">myVar</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span> <span class="c1">// this is global</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVar2</span> <span class="o">=</span> <span class="s2">&quot;world&quot;</span><span class="p">;</span> <span class="c1">// this is local</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Lexical Scoping</h3>

<p>Objects can look up the inheritance chain to find properties, functions, and methods, but they cannot look into their childrens&#8217; scopes. When looking for a value up the inheritance chain, the first found value is returned. Any values in higher scopes are &lsquo;shadowed&rsquo;, or &lsquo;masked&rsquo; by the value found in the lowest scope.</p>

<p>Priority of inheritance is defined in the definition (the code), not the state of objects at the time of invocation.</p>

<h2>Prototype</h2>

<p>Prototype is a property found in instances created by the Function() constructor. These functions can be used as constructors themselves.</p>

<p>Why should you care?</p>

<ol>
<li>Prototype is what the nine native constructors use to pass methods to their object children.</li>
<li>You can use prototypes to orchestrate inheritance.</li>
<li>You may inherit code that uses it.</li>
<li>It&rsquo;s efficient in that all instances of an object can share a method defined in only one place: the prototype object.</li>
</ol>


<p>The prototype property is basically a container (an object) for properties and methods you want instances of a given object to inherit. They will inherit the current value of the property (it is updated dynamically).</p>

<p>The values passed into prototype must be complex (not JavaScript primitives).</p>

<p>Instances of an object access the prototype&rsquo;s host object with their &lsquo;constructor&rsquo; property.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">myArray</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// This is the same as line 4. The &#39;foo&#39; property is found by inheritance.</span>
</span><span class='line'><span class="nx">myArray</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>All objects have a common highest ancestor: Object.prototype. Overriding the &lsquo;prototype&rsquo; property on Object will break its functionality.</p>

<p><br/></p>

<hr />


<p><br/></p>

<h1>The Parts of JavaScript</h1>

<h2>The Head/Global Object</h2>

<p>This object represents the highest scope in a given JavaScript environment. In the browser, it is &lsquo;window&rsquo;. It contains ALL objects in the environment.</p>

<p>Global properties and variables are contained in the Head Object, and are accessible from any other scope through inheritance.</p>

<p>The Head Object can be referenced by referring to &lsquo;window&rsquo;, or using the keyword &lsquo;this&rsquo; from the global scope. Thus, its scope is implied from outside of a function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// These mean the same thing:</span>
</span><span class='line'><span class="nx">alert</span><span class="p">();</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Global Functions</h3>

<p>These are provided by the environment.</p>

<ul>
<li>decodeURI()</li>
<li>decodeURIComponent()</li>
<li>encodeURI()</li>
<li>encodeURIComponent()</li>
<li>eval()</li>
<li>isFinite()</li>
<li>isNaN()</li>
<li>parseFloat()</li>
<li>parseInt()</li>
</ul>


<h2>Object()</h2>

<p>Gives an empty object container. Creating objects with a literal is the preferred syntax.</p>

<h3>Parameters</h3>

<p>Object() takes a parameter that is a value. It is null/undefined by default.</p>

<h3>Properties and Methods</h3>

<p>Note: ALL JavaScript objects inherit the following properties and methods from Object.prototype.</p>

<p>When defining property keys, one can use dot notation or bracket notation. Bracket notation is more flexible, because it allows for the use of concatenation and reserved words.</p>

<h4>Properties</h4>

<ul>
<li>prototype</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
</ul>


<h4>Instance Methods</h4>

<ul>
<li>hasOwnProperty()</li>
<li>isPrototypeOf()</li>
<li>propertyIsEnumerable()</li>
<li>toLocaleString()</li>
<li>toString()</li>
<li>valueOf()</li>
</ul>


<p><br /></p>

<h2>Function()</h2>

<p>Functions always return a value. This will be &lsquo;undefined&rsquo; if another return value is not specified.</p>

<p>Functions define a new scope. Variables within it cannot be seen from objects containing the function, but they <em>can</em> be seen by objects it contains. This is called &lsquo;lexical scoping&rsquo;.</p>

<p>There are three ways to define a new function:</p>

<ol>
<li>With the constructor: var myFunction = new Function(){};</li>
<li>With a literal, as an expression: var myFunction = function(){};</li>
<li>With a literal, as a statement: function myFunction(){};</li>
</ol>


<p>Functions are &lsquo;first class citizens&rsquo; in JavaScript. They are objects, they can be stored, they have properties, and they can be passed into other functions (higher-order functions).</p>

<h3>Invoking Functions</h3>

<p>Functions are invoked with (). This can be done in three ways:</p>

<ol>
<li>As a function - func();</li>
<li>As a method - when attached to an object - myVar.func();</li>
<li>Using apply() or call()</li>
<li>As a constructor:</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Cody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">cody</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cody</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cody</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Anonymous Functions</h3>

<p>Functions not given an identifier are anonymous.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span><span class="p">(){};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Self-Invoking Functions</h3>

<p>Functions that call themselves immediately upon definition. This doesn&rsquo;t work with the Function() constructor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
</span><span class='line'><span class="p">}();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Self-Invoking Anonymous Functions</h3>

<p>Functions with no identifier that immediately call themselves. These often wrap code to keep it from polluting the global object. Note that it must be wrapped in additional parentheses.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// code goes here</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Hoisting</h3>

<p>A function can be invoked before it is defined, because JavaScript collects the functions before runtime. This is called hoisting. It does not work with function expressions.</p>

<h3>Recursion</h3>

<p>Functions may call themselves while executing. This is called recursion.</p>

<h3>Parameters</h3>

<p>When creating a function with the constructor, the last param passed in becomes the inside of the function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;return foo+bar&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can create a function with too few parameters. The missing ones will be treated as &lsquo;undefined.&rsquo;</p>

<p>You can also create a function with too many parameters. The extras will be ignored, although they are accessible from the &lsquo;arguments&rsquo; property.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>prototype</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
<li>length</li>
<li>arguments</li>
</ul>


<p>Arguments has a property &lsquo;callee&rsquo; that contains a reference to the function currently executing. This can be used in creating recursive functions.</p>

<p>Arguments also has a property &lsquo;length&rsquo;, containing the number of arguments at invocation. This property is being depricated in favor of arguments.callee.length.</p>

<p><br /></p>

<h4>Instance Methods</h4>

<ul>
<li>apply()</li>
<li>call()</li>
<li>toString()</li>
</ul>


<p><br /></p>

<h2>Array()</h2>

<p>A special type of object with a couple of extra functions.</p>

<h3>Parameters</h3>

<p>Any comma-separated parameters passed in will become elements in the array.
If a single integer is passed alone, it will define the length of the array instead of an element value. If you define a high index, the elements before it will be filled in with &lsquo;undefined&rsquo;. Setting an array&rsquo;s length can add or remove values automatically.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>prototype</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
<li>index</li>
<li>input</li>
<li>length</li>
</ul>


<h4>Instance Methods</h4>

<ul>
<li>pop()</li>
<li>push()</li>
<li>reverse()</li>
<li>shift()</li>
<li>sort()</li>
<li>splice()</li>
<li>unshift()</li>
<li>concat()</li>
<li>join()</li>
<li>slice()</li>
</ul>


<p><br/></p>

<h2>String()</h2>

<h3>Creating Strings</h3>

<p>This will create a string object.
It is best to avoid this syntax due to potential problems with typeof.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// constructor function</span>
</span></code></pre></td></tr></table></div></figure>


<p>These two create a primitive:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// without new keyword</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span> <span class="c1">// literal</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Parameters</h3>

<p>Takes one parameter: the string value being created.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>prototype</li>
</ul>


<h4>Methods</h4>

<ul>
<li>fromCharChode()</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
<li>length</li>
</ul>


<h4>Instance Methods</h4>

<ul>
<li>charAt()</li>
<li>charCodeAt()</li>
<li>concat()</li>
<li>indexOf()</li>
<li>lastIndexOf()</li>
<li>localeCompare()</li>
<li>match()</li>
<li>quote()</li>
<li>replace()</li>
<li>search()</li>
<li>slice()</li>
<li>split()</li>
<li>substr()</li>
<li>substring()</li>
<li>toLocaleLowerCase()</li>
<li>toLocaleUpperCase()</li>
<li>toLowerCase()</li>
<li>toUpperCase()</li>
<li>valueOf()</li>
</ul>


<p><br /></p>

<h2>Number()</h2>

<h3>Creating Numbers</h3>

<p>This will create a number object.
It is best to avoid this syntax due to potential problems with typeof.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// constructor function</span>
</span></code></pre></td></tr></table></div></figure>


<p>These two create a primitive:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myNumber</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// without new keyword</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myNumber</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// literal</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Parameters</h3>

<p>Takes one parameter: the number value being created.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>MAX_VALUE</li>
<li>MIN_VALUE</li>
<li>NaN</li>
<li>NEGATIVE_INFINITY</li>
<li>POSITIVE_INFINITY</li>
<li>prototype</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
</ul>


<h4>Instance Methods</h4>

<ul>
<li>toExponential()</li>
<li>toFixed()</li>
<li>toLocaleString()</li>
<li>toPrecision()</li>
<li>toString()</li>
<li>valueOf()</li>
</ul>


<p><br /></p>

<h2>Boolean()</h2>

<h3>Creating Booleans</h3>

<p>This will create a boolean object.
It is best to avoid this syntax due to potential problems with typeof.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="c1">// constructor function</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">These</span> <span class="nx">two</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">primitive</span><span class="o">:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myBoolean</span> <span class="o">=</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// without new keyword</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myBoolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// literal</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Parameters</h3>

<p>Takes one parameter to be converted into a boolean.</p>

<p>The only false values are: 0, -0, null, false, NaN, undefined, and &ldquo;&rdquo;.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>prototype</li>
</ul>


<h4>Instance Properties</h4>

<ul>
<li>constructor</li>
</ul>


<h4>Instance Methods</h4>

<ul>
<li>toSource()</li>
<li>toString()</li>
<li>valueOf()</li>
</ul>


<h4>Notes</h4>

<p>If you create a false boolean object with a constructor, it creates an object. Objects convert to true. Thus do not use the constructor with false booleans.</p>

<p><br /></p>

<h2>Primitives: String, Number, and Boolean</h2>

<p>A primitive is an irreducible value.
The Primitives are: number, string, boolean, null, and undefined.</p>

<p>Primitives are stored in memory with their value:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myVarA</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVarB</span> <span class="o">=</span> <span class="nx">myVarA</span><span class="p">;</span>
</span><span class='line'><span class="nx">myVarA</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">myVarA</span> <span class="o">===</span> <span class="mi">13</span><span class="p">;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kc">true</span>
</span><span class='line'><span class="nx">myVarB</span> <span class="o">===</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is best to write these using the literal form. Using a constructor will result in a typeof result of &ldquo;object&rdquo; instead of the actual type.</p>

<h3>Object Wrappers</h3>

<p>When you call a property or method on a primitive, it is wrapped in a temporary object.
The temporary object is discarded once the properties have been accessed.</p>

<p><br /></p>

<h2>Null</h2>

<p>Use null to indicate that an object property doesn&rsquo;t have a value.
It means that a value is expected but not yet available.
Calling typeof on it will return &lsquo;object&rsquo;. It is best to test for null with ===.</p>

<p><br /></p>

<h2>Undefined</h2>

<p>Used in two ways:</p>

<ul>
<li>Indicate that a variable has no assigned value.</li>
<li>Indicate that an object property you want to access is not defined or named, and can&rsquo;t be found in the prototype lookup chain.</li>
</ul>


<p>It is best to let JavaScript itself use undefined. Don&rsquo;t use it yourself.</p>

<p><br /></p>

<h2>Math</h2>

<p>This is a built-in, static object. It is not a constructor and cannot be instantiated.</p>

<h3>Properties and Methods</h3>

<h4>Properties</h4>

<ul>
<li>E</li>
<li>LN2</li>
<li>LN10</li>
<li>LOG2E</li>
<li>LOG10E</li>
<li>PI</li>
<li>SQRT1_2</li>
<li>SQRT2</li>
</ul>


<h4>Methods</h4>

<ul>
<li>abs()</li>
<li>acos()</li>
<li>asin()</li>
<li>atan()</li>
<li>atan2()</li>
<li>ceil()</li>
<li>cos()</li>
<li>exp()</li>
<li>floor()</li>
<li>log()</li>
<li>max()</li>
<li>min()</li>
<li>pow()</li>
<li>random()</li>
<li>sin()</li>
<li>sort()</li>
<li>tan()</li>
</ul>

]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Getting Started With Rails]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/11/08/getting-started-with-rails/"/>
    
    <updated>2013-11-08T10:15:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/11/08/getting-started-with-rails</id>
    
    <content type="html"><![CDATA[<p>This week at gSchool, we&rsquo;re digging into our first major Rails project, <a href="http://tutorials.jumpstartlab.com/projects/dinner_dash.html">Dinner Dash</a>. It&rsquo;s been a challenging transition.</p>

<h2>Rails Challenges</h2>

<p>Although I know some Ruby, and I know how to drive development with tests, using Rails is a whole new ball game. There are so many new words! From ActiveRecord associations, to &ldquo;form_for&rdquo; and &ldquo;button_to&rdquo;, to strong params, there&rsquo;s a huge library of methods I don&rsquo;t know.</p>

<p>One particularly difficult challenge for me this week was figuring out how to properly use &ldquo;form_for&rdquo;. I was having a little trouble with forms and HTTP routes. I know how to write an update form like this in HTML:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/ideas&quot;</span> <span class="na">method=</span><span class="s">&#39;POST&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span> <span class="na">name=</span><span class="s">&#39;idea[title]&#39;</span> <span class="na">placeholder=</span><span class="s">&quot;Title&quot;</span> <span class="na">value=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;&lt;input/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;_method&quot;</span> <span class="na">value=</span><span class="s">&quot;PUT&quot;</span><span class="nt">&gt;&lt;input/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;submit&#39;</span> <span class="na">value=</span><span class="s">&#39;Submit&#39;</span><span class="nt">&gt;&lt;input/&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But I was having a lot of trouble submitting PUT and DELETE verbs with &ldquo;form_for&rdquo; in Rails.</p>

<p>I was trying to create a form with some code like this, but it wasn&rsquo;t really working out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">form_for</span> <span class="ss">:idea</span><span class="p">,</span> <span class="p">(</span><span class="ss">action</span><span class="p">:</span> <span class="ss">:put</span><span class="p">)</span><span class="sc">??</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;p&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="x">&lt;br&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;/p&gt;</span>
</span><span class='line'><span class="x">  &lt;p&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;/p&gt;</span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Franklin eventually straigtened us out with a different approach, which he described as the &ldquo;Rails-y way&rdquo; to do it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="n">ideas_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:put</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>I assume there will be many more &ldquo;Rails-y&rdquo; idioms to learn in my near future.</p>

<h2>Organizing Our Workgroup</h2>

<p>My group for this project is comprised of four people: myself, Bree, Nikhil, and Tyler. So far, we&rsquo;ve been working really well together. We&rsquo;re using <a href="https://www.pivotaltracker.com">Pivotal Tracker</a> and <a href="https://campfirenow.com/">Campfire</a> (this is my first time for both) to drive our development and communication. I&rsquo;ve found it hard to get used to Pivotal Tracker. Although I enjoyed learning how to write epics and stories in <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a>, I&rsquo;m used to thinking through problems one step at a time in coding. Having to go back to the website and refer to what&rsquo;s in the &lsquo;Current&rsquo; or &lsquo;Icebox&rsquo; list interrupts my flow.</p>

<p>I&rsquo;m also not yet at the point of driving everything with <a href="https://github.com/jnicklas/capybara">Capybara</a>. Although we&rsquo;re testing our models before we implement them, we aren&rsquo;t doing any integration tests in advance. Maybe if we were to transform our Gherkin stories into Cucumber, it would be an easy transition. I&rsquo;m a little shy, though, since it always takes a while to get to know a new testing framework.</p>

<p>Here&rsquo;s one testing success, though: we&rsquo;ve integrated <a href="https://github.com/guard/guard">Guard</a> into our workflow. This is the first time any of us have used it successfully.</p>

<p>I&rsquo;m also trying to itegrate some of the lessons learned from <a href="http://www.therailsview.com/">The Rails View</a>, which I&rsquo;m currently reading. In this project, I&rsquo;m trying to take on a lot of responsibility for the view layer, because I don&rsquo;t feel strong in design and would like to get better. Here&rsquo;s our current view, four days in. Unfortunately, it&rsquo;s mostly Bootstrap. I&rsquo;m planning to shine it up a bit this weekend.</p>

<p><img src="http://s5.postimg.org/8g4kan24n/Ono_Burrito_Beta_Site.png" title="Ono Burrito" alt="Screenshot of a website in development"></p>

<h2>Coming Back to Rails</h2>

<p>Before gSchool, I did a few Rails tutorials online. Coming back to it now, after all the work we&rsquo;ve done with Ruby, hand-built model associations, and SQL, I feel very positive. I may not know what I&rsquo;m doing yet, but it&rsquo;s a lot easier to figure things out, now that I have a context for them. Categorizing confusing bits of code into categories comes much more quickly now. SQL, database tables, models, controllers, views, templates, Ruby expressions, Rails helpers&hellip;these ideas have a lot more meaning than they did before. This means I&rsquo;m able to bounce back from confusion much more quickly.</p>

<h2>Moving Forward</h2>

<p>I&rsquo;m excited to get up to speed in Rails. Our group was able to build out a complete restauarant site, with basic users and ordering functionality, all in the course of a few days. No wonder they say it&rsquo;s easy to get up and running quickly with Rails!</p>

<p>I&rsquo;ve also been working with my mentor (the most awesome Mike Pack) on building a basic API in Rails, as a service for a Backbone.js app on the front end. It will eventually be an online recipe book, with Facebook and Instagram integration. I&rsquo;m really excited to continue working on it.</p>

<h2>Wrapping Up</h2>

<p>I&rsquo;m feeling a little bit intimidated by Rails at the moment, because there&rsquo;s so much to learn. But I&rsquo;m not worried: I relish the challenge of learning how to use a new tool, which is one of the reasons I got into programming in the first place. Plus, there are so many quality resources out there for learning Rails, I&rsquo;m sure I&rsquo;ll be up to speed in no time.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[RESTful Architecture]]></title>
    <link href="http://fluxusfrequency.github.io/blog/2013/11/06/restful-archicture/"/>
    
    <updated>2013-11-06T06:11:00-07:00</updated>
    <id>http://fluxusfrequency.github.io/blog/2013/11/06/restful-archicture</id>
    
    <content type="html"><![CDATA[<p>The gSchool students began our first big Rails project this week. We&rsquo;re building a restaurant site with online ordering. The project is called <a href="http://tutorials.jumpstartlab.com/projects/dinner_dash.html">Dinner Dash</a>.</p>

<p>In support of learning Rails, Jeff gave a talk on how RESTful Archecture should look in a Rails application. Here are my notes on what he said. I broke it down into CRUD (Create, Read, Update, Destroy) operations.</p>

<p>I&rsquo;ve shown the HTTP request verbs and routes and the controller methods that match them. It should be noted that GET will display request params in its URL, while POST requests will carry request params hidden in the body of the HTTP request.</p>

<p>For the examples, I used &lsquo;articles&rsquo; as a resource. For single records, I referred to an article with an id of 1, although many different ids would actually exist. I also assumed that strong params are defined in a method called &lsquo;article_params&rsquo; in the Articles Controller. These patterns came from the Jumpstart Lab <a href="tutorials.jumpstartlab.com/projects/blogger.html">Blogger Tutorial</a>.</p>

<p><br/></p>

<h2>Setting Up The Router</h2>

<p>In config/routes.rb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:articles</span>
</span></code></pre></td></tr></table></div></figure>


<p><br/></p>

<h2>Create</h2>

<h3>Creating A Single Record</h3>

<ul>
<li>GET &lsquo;/articles/new&rsquo; (displays the new article form)</li>
<li>POST &lsquo;/articles/new&rsquo;</li>
</ul>


<p>In app/controllers/articles_controller.rb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@article</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><br /></p>

<h2>Read</h2>

<h3>Reading Multiple Records</h3>

<ul>
<li>GET &lsquo;/articles&rsquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Reading A Single Record</h3>

<ul>
<li>GET &lsquo;/articles/1&rsquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><br /></p>

<h2>Update</h2>

<h3>Updating A Single Record</h3>

<ul>
<li>GET &lsquo;/articles/1/edit&rsquo; (displays the edit form)</li>
<li>PUT &lsquo;/articles/1&rsquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@article</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><br /></p>

<h2>Destroy</h2>

<h3>Deleting A Single Record</h3>

<ul>
<li>DELETE &lsquo;/articles/1&rsquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@article</span><span class="o">.</span><span class="n">destroy</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><br/></p>

<h2>Search</h2>

<h3>Searching With A Filter</h3>

<ul>
<li>GET &lsquo;/articles?author_id=6&rsquo;</li>
</ul>


<h3>Saved Searches</h3>

<ul>
<li>POST &lsquo;/searches&rsquo; (creates the search)</li>
<li>GET &lsquo;/searches/12&rsquo; (accesses the saved search)</li>
</ul>

]]></content>
    
  </entry>
  
</feed>