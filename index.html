
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fluxus Frequency</title>
  <meta name="author" content="Ben Lewis">

  
  <meta name="description" content="This post originally appeared on Engine Yard. Introduction In part one of this miniseries, we introduced formal Use Case Analysis and a simplified &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fluxusfrequency.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fluxus Frequency" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">Fluxus Frequency</a></div>


	<br><div class="header-subtitle">How I Hacked The Mainframe</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fluxusfrequency.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/05/26/happy/">Happy, Sad, Evil, Weird: Putting Use Case Planning Into Practice</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-05-26T06:11:59-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/happy-sad-evil-weird-use-case-planning-practice">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>In <a href="https://blog.engineyard.com/2015/happy-sad-evil-weird-feature-planning">part one</a> of this miniseries, we introduced formal Use Case Analysis and a simplified version called Use Case Planning which fits a rapid, iterative development process. That post went over the high-level concepts, and explained how this planning method will help you catch problems with your design before you start to implement.</p>

<p>In this post, the final post of this miniseries, we’ll step through a concrete example so you can see how to put Use Case Planning into practice.</p>

<h2>An Example</h2>

<p>We&rsquo;ll imagine that we work for a company that is building a multi-tenant Software as a Service (SaaS) platform where people can set up shops and sell products. Tenants will be able to charge their customers through the platform.</p>

<p>We&rsquo;re part of a team that&rsquo;s getting ready to create a credit card payment acceptance feature. It will be a credit card form common to all of our tenants. We&rsquo;ll be writing the markup by hand and using of <a href="https://stripe.com/">Stripe</a> for processing cards. We&rsquo;re entering a sprint planning meeting to define the scope of the work to be done and decide how long it will take to build.</p>

<p>During this meeting, we&rsquo;ll talk about many different aspects of the billing process. For the purposes of this post, let&rsquo;s hone in on one specific feature: once a user has clicked <em>Buy</em>, they are presented with a credit card form. We want to plan what will happen when they try to make use of this form.</p>

<p>Let&rsquo;s walk through the Use Case Planning process for this scenario.</p>

<h2>Step 1. Identifying the Actors and Their Roles</h2>

<p>People:</p>

<p><em>User</em>: exchanges money for goods
<em>Merchant</em>: exchanges goods for money and money for tenancy
<em>Platform Owner</em>: exchanges tenancy for money</p>

<p>Services:</p>

<p><em>SaaS Platform</em>: provides the space for tenancy and goods to be exchanged for money
<em>Stripe</em>: verifies and charges credit cards, handles much of <a href="https://www.pcisecuritystandards.org/">PCI compliance</a>
<em>Credit Card Company</em>: transfers funds between other actors</p>

<h2>Step 2. Describe The Purpose of The Feature</h2>

<p>Why do we want to build a credit card form? So that we can debit the user and credit the merchant and platform owner.</p>

<h2>Step 3. Identify Use Case Packages</h2>

<p>In this step, each of the stakeholders will contribute their point of view to the discovery of behaviors that we should consider.</p>

<p>When considering a set of use cases, I often like to think through the alternative paths first. As I mentioned above, they can yield interesting decisions that affect the way the happy path will be built.</p>

<h3>The Sad Path</h3>

<p>This time, we&rsquo;ll start with the sad path. Considering the sad path means thinking through what should happen when one of the actors does something differently than we want them to.</p>

<p>Let&rsquo;s identify some of the sad path use cases of filling out a credit card form.</p>

<p>Here are a few examples:</p>

<ol>
<li>User fills out the credit card form with invalid credit card information</li>
</ol>


<p>When this use case is identified, the designer might chime in that when this happens, the invalid fields should be highlighted and an error message should be displayed explaining what went wrong.</p>

<p>The QA technician might point out that these validations should be ironclad; no special characters should be allowed to pass through.</p>

<ol>
<li>Card is rejected by credit card company</li>
</ol>


<p>Here, the product owner might insist that it should take as few steps as possible to resubmit the form, so that the user doesn&rsquo;t become frustrated and decide not to buy the product.</p>

<ol>
<li>Stripe accepts card when submitted via JavaScript, but fails on subsequent server charge request</li>
</ol>


<p>The developer would want to make sure that passing error handling from the server back to the front end is captured in this use case.</p>

<h3>The Evil Path</h3>

<p>Coming up with evil paths requires to you to think like an attacker. How many ways can you come up with to exploit the feature you’re trying to build?</p>

<p>For example:</p>

<ol>
<li>Price as set in a hidden form field and user figures out that they can change it to zero</li>
</ol>


<p>In this scenario, the developer would want to make sure that the form is built correctly.</p>

<ol>
<li>Hacker steals credit card info from the database, server logs, or an insecure network request sent over HTTP</li>
</ol>


<p>The product owner would want to mitigate against this as much as is possible so as the protect the customer’s data. From a legal perspective, the product owner would also want to ensure that the SaaS company could not be held liable for any losses, and crucially, that PCI compliance was met.</p>

<ol>
<li>If we were to save the credit card information to the user account, a hacker could launch a <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF attack</a>, leveraging a logged in user&rsquo;s account information to order products without authorization.</li>
</ol>


<p>The developer would suggest using a CSRF token, and the QA technician would want to make sure that form submission failed when the token was changed.</p>

<ol>
<li>Security holes in session or authentication opens users up to charges</li>
</ol>


<p>Here, the QA technician might ask what would happen when cookie or local storage data is changed. Does it fail as it should?</p>

<h3>The Weird Path</h3>

<p>Coming up with weird paths requires a little more creativity.</p>

<p>Consider each component that your feature interacts with (both internally and externally, locally and remotely, and so on) and think through what would happen if that component failed or behaved in an unexpected way.</p>

<p>For instance:</p>

<ol>
<li>JavaScript is disabled in the user’s browser, and  the event listener that would prevent the form from being submitted doesn’t fire. The <code>form</code> element falls back to its default behavior, which is to submit it to the SaaS server. The credit card number now appears in the server logs, making it vulnerable to information theft.</li>
</ol>


<p>The developer would want to ensure that the form is built such that it would never be submitted to the SaaS server by mistake.</p>

<ol>
<li>Stripe server is down</li>
</ol>


<p>In this case, the designer would ask for some kind of error page, perhaps with a link to a status page where users could check for the servers to come back online.</p>

<ol>
<li>Connection to Stripe is interrupted during transaction</li>
</ol>


<p>The product owner might ask if we can resend the submission if the connection was interrupted. The developer would probably push back on that request, for security reasons. As a compromise, the designer might offer to invent an error state to be shown in this case.</p>

<h3>The Happy Path</h3>

<p>This one is easy. How do you want the feature to work?</p>

<ol>
<li>User successfully fills out form and clicks submit</li>
</ol>


<p>Again, the designer would probably like to display some kind of success message here.</p>

<ol>
<li>Credit card charge is accepted by Stripe</li>
</ol>


<p>In this scenario, the product owner might ask to have the page views leading to the successful charge tracked in an analytics service, so we could track down and encourage the same behavior in the future.</p>

<h2>Step 4. Name and Diagram Use Cases</h2>

<p>We&rsquo;ve now identified twelve use cases for the credit card form feature.</p>

<p>I tried my hand at documenting them all in a Use Case Diagram. Green arrows represent good requests or responses, and red arrows represent errors. Bombs represent a broken network connection.</p>

<p><img src="" alt="" /></p>

<p>As you can see, there are tons of arrows.</p>

<p>There are a lot of possible scenarios, and a lot of possible communications between the actors in the system. If we hadn&rsquo;t taken the time to think them through and uncover them all, there&rsquo;s high probability that we would have left some of these out.</p>

<h2>Converting To User Stories</h2>

<p>Now that we&rsquo;ve gone through these four steps, we&rsquo;ve come out with something very valuable: bite-sized sentences that can be translated directly into stories and entered into our tracker software.</p>

<p>Here&rsquo;s what the first sad path case might look like when worded as a story:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>As a user, when I complete the form with invalid information and click submit, I should see the invalid inputs become highlighted, and I should see validation errors telling me what went wrong so that I can correct my error and successfully buy products.</span></code></pre></td></tr></table></div></figure>


<p>As you can see, we have an actor (user), action (fill out and submit form), a result (show validation errors), and a business purpose (the user can give us money).</p>

<p>These twelve stories are small and clear, and lend themselves to being prioritized based on the priorities of our business. Once we enter them into our tracker, we can be assured that they will all be built, and we can estimate how long it will take to happen.</p>

<h2>Conclusion</h2>

<p>The Use Case Planning process is not super complicated. It consists of identifying who/what is involved, why we care, what should happen in the happy and alternative scenarios, and how do the scenarios relate?</p>

<p>It&rsquo;s a relatively low level of effort to answer these four questions and break down the scenarios, but the result is worth its weight in gold. It enables us to identify architectural concerns and edge cases early on and change them at a low cost. We&rsquo;ve also ended up with a set of small stories with clear acceptance criteria that we can track, providing a huge value both in accountability and estimating timelines.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/05/21/happy/">Happy, Sad, Evil, Weird: Driving Feature Development With Feature Planning</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-05-21T06:11:29-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/happy-sad-evil-weird-feature-planning">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>When building software iteratively, feature planning has to  be done early and often. But it can be a complicated process due to all of the stakeholders involved, each with different viewpoints and goals.</p>

<p>What&rsquo;s more, it&rsquo;s easy to overlook key behaviors of a feature, which can lead to expensive and rushed code later. It&rsquo;s usually intuitive to figure what should happen when everything goes according to plan, but what about edge cases? What should happen when a user supplies bad data? A hacker launches a malicious attack on our application? What about when <a href="https://github.com/Netflix/SimianArmy">chaos makes the whole system unstable</a>?</p>

<p>In the first post of this miniseries, we&rsquo;ll take a look at one way to get everyone&rsquo;s voice heard in the planning process, including the product owner, developer, designer, and QA engineer. Using this approach, teams can draw on their diverse perspectives to tease out a detailed blueprint of a feature that costs less and performs better.</p>

<h2>Introducing Use Case Planning</h2>

<p>Use Case Planning is a term that I&rsquo;ve come up with to represent a simplified version of <a href="http://en.wikipedia.org/wiki/Use-case_analysis">Use Case Analysis</a>. I&rsquo;m aiming to simplify the software feature planning process into a simple, reusable procedure that will save teams money and build more robust systems.</p>

<p>With Use Case Planning, teams can stay flexible early in the game, when it&rsquo;s still cheap to make big changes to the system.</p>

<p>It also helps us look ahead and find edge cases. For many people, it&rsquo;s easy to press forward naïvely, writing stories about how a feature should behave entirely in terms of the best-case scenario (also known as the <a href="http://en.wikipedia.org/wiki/Happy_path">Happy or Golden Path</a>). But there are many other cases to consider. What about bad data (Sad Path), hacker attacks (Evil Path), or web services going down (Weird Path)?</p>

<p>In the end, thinking through these scenarios in advance of development will save a company money and result in features that provide a better user experience.</p>

<h2>What Is Use Case Planning?</h2>

<h3>Background</h3>

<p>If you&rsquo;re not familiar with Use Case Analysis, it&rsquo;s an academic approach based in <a href="http://en.wikipedia.org/wiki/Object-oriented_analysis_and_design">Object Oriented Analysis</a>—a way of describing any kind of system (not just software) in terms of conceptual objects.</p>

<p>I first became aware of Use Case Analysis through the work of <a href="http://people.cs.uchicago.edu/~mark/">Mark Shacklette</a>, a professor of Computer Science at the University of Chicago. In <a href="http://people.cs.uchicago.edu/~mark/51023/Ucstyleg.html">this paper</a>, he lays out a very detailed process for building systems with Use Case Analysis. However, I found it to be over-complicated for regular use. I build a lot of software for clients, and need a &ldquo;boiled down&rdquo; version that I can reach for when planning sessions are  constrained by time. Use Case Planning is my attempt at creating that.</p>

<h3>What&rsquo;s Required?</h3>

<p>In the software industry, when we&rsquo;re getting ready to build a feature, we have to answer three basic questions:</p>

<p>What&rsquo;s required to build it?
How should it behave?
What people and computer systems are involved?</p>

<p>Through the Use Case Planning process, we&rsquo;ll answer these questions and come out with a  blueprint detailing what we need, the dependencies involved, and the ways our feature should work.</p>

<h3>Who&rsquo;s Involved?</h3>

<p>Feature planning is usually carried out by a team of stakeholders rather than an individual. Product owners, developers, designers, QA technicians, and so on all bring a unique perspective and set of concerns to the table. Drawing on these varied mindsets helps us make a more comprehensive plan than we could come up with on our own</p>

<h3>Scenarios</h3>

<p>Let&rsquo;s imagine we&rsquo;re on such a team, and we want to plan a feature with Use Case Planning. We&rsquo;ll need to break it down into as many use cases, or scenarios, as we can, weaving a story of interactions between people of various roles and the computer systems involved.</p>

<h2>Why Think About Use Cases?</h2>

<p>There are many benefits to breaking down a feature into use cases.</p>

<p>First of all, talking through software&rsquo;s desired behavior in simple everyday language opens the conversation up to all stakeholders. The whole team can work together to determine how a feature should work without jargon getting in the way.</p>

<p>The team involved in the planning process is essentially trying to define a <em>contract</em> of what will be built and what it will do. Use Case Planning makes this contract more resistant to change, as unforeseen circumstances are accounted for before the first line of code is ever written. Also, functional parts of the system are less likely to fall through the cracks when a variety of scenarios are considered up front.</p>

<p>This approach can also help guide architectural decisions. Sometimes, a feature can be ruled out entirely, before any time is ever spent building it. For example, concern about having bots or script-generated users in a system could push a team toward including an email confirmation workflow, or choosing <a href="http://oauth.net/">oAuth</a> over traditional authentication.</p>

<p>In my mind, perhaps the most valuable benefit of use case analysis is that it gives teams a way to describe a system that costs very little to modify. In talking through alternate paths early, it&rsquo;s easy to change requirements before anything&rsquo;s ever built. This is a huge win, because as time goes on, code is written, and the system begins to take shape, the cost of change increases significantly.</p>

<p>Adding and removing features from a use case story or diagram is easy. Changing them in UX flow diagrams and wireframes is harder, in design comps harder still, in development code even harder, and in a production app it can be extremely hard. But when you&rsquo;re planning, making changes is as easy as throwing away a sticky note and writing a new one, so it pays to think through as many of the potential scenarios as possible at this early stage.</p>

<h2>How To Do Use Case Planning</h2>

<p>Now that we&rsquo;ve talked about the benefits and goals of use case planning, <em>what exactly is it</em>? As I mentioned above, this is my attempt at boiling Use Case Analysis down into a set of memorable, repeatable steps. They mirror the steps in Mark Shacklette&rsquo;s original paper pretty closely, but I&rsquo;ve tried to rework them to the minimum of what I think <em>I</em> would need when planning a feature before beginning work.</p>

<h3>The Four Steps</h3>

<p>To complete the four steps, answer these four questions:</p>

<ol>
<li>Who are the actors and what are their roles?</li>
<li>What&rsquo;s the purpose of this feature?</li>
<li>What are the use cases?</li>
<li>How do the use cases relate to each other?</li>
</ol>


<p>In thinking about the first question, we&rsquo;ll expand our definition of &ldquo;actors&rdquo; from just people to include everything that interacts with the system: users, administrators, our client-side application, our API, external APIs, cloud services, and hardware interfaces. Each of these actors has a role and a responsibility in the system that we should identify.</p>

<p>In identifying the purpose of the feature, we are just looking for a high-level summary of why we care about it. What&rsquo;s the business value?</p>

<p>When we get to the third question, we&rsquo;re ready to dig into the meat of this process. We&rsquo;ll think through all of the use and misuse cases, considering the Happy, Sad, Evil and Weird paths. For each one, we&rsquo;ll choose a a noun (the actor), verb (actions taken), and a brief description of the desired result. We can also optionally add a more specific purpose (like we identified in step two) to each case as we go.</p>

<p>After step three, we will have identified many use cases, each with a name, an actor, and a breakdown of all the required behavior. Using this information, we can answer the last question (how do they relate?) by diagramming their interactions. There&rsquo;s an example of a use case diagram for ordering at a restaurant <a href="http://en.wikipedia.org/wiki/Use_Case_Diagram#/media/File:Use_case_restaurant_model.svg">on Wikipedia</a>.</p>

<p>The diagram is in a formal Use Case Analysis style. For the purposes of planning software, it might make sense to replace this style of diagramming with a UX flow diagram, using the screens in the app to delineate how the feature should behave.</p>

<h3>Wrapping It Up</h3>

<p>Once we&rsquo;ve identified the various use cases associated with our feature, we can translate these results directly into agile stories. Using a tracking tool like <a href="https://sprint.ly">Sprint.ly</a>, we can then prioritize the work that needs to be done and estimate the time it will take to complete the feature. Each user case can be sized, tagged, and tracked, providing a helpful look into the progress being made toward bringing our feature to fruition.</p>

<h2>Conclusion</h2>

<p>In this post, we introduced formal Use Case Analysis and a simplified version called Use Case Planning which fits a rapid, iterative development process. We went over the benefits, the steps involved, and explained how this planning method will help your team catch problems with your design before you start to implement it.</p>

<p>That’s it for this post, but tune in next week for part two (the final part) of this miniseries, where we’ll be stepping through a concrete example so you can see how to put Use Case Planning into practice.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/05/13/actually-mvp/">Actually MVP</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-05-13T06:11:09-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/actually-mvp">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>In the startup world, there is a lot of talk about building <em><a href="http://en.wikipedia.org/wiki/Minimum_viable_product">Minimum Viable Products</a></em> (MVPs). At this point, the concept has become so well-accepted that it has almost become a kind of unquestioned dogma. Yet there is a lot of disagreement about what MVP is exactly, and how to carry it out. Many people in the software industry assume that they know what MVP means, and claim to be using the process, but their production workflow tells a different story.</p>

<p>When it comes to building software, it is often tempting to take an approach akin to building a skyscraper: write the blueprints, obtain the necessary prerequisites, then build it to spec. But software is a quickly shifting market. A businessperson may think she knows what the market wants, and plan and begin a project to meet that desire. But by the time the product is built, the needs of consumers have often morphed in a direction that she could never have foreseen.</p>

<p>In this post, we&rsquo;ll take explore some common misconceptions about MVP, some different ways to approach building one with software, and how to best use this tool if you&rsquo;re the CEO or CTO of a startup, a product manager for an established company, or a consultant.</p>

<h2>Why MVP?</h2>

<p>We hear a lot of talk about MVP and its value, but as a businessperson, why should you care? The reason is simple: it prevents you from spending money building a product that nobody wants.</p>

<p>When you build your business around small, successive iterations, the time before you can reflect on lessons learned is as small as possible. It can even push you to decide <em>not</em> to build your big idea, saving you valuable time and resources.</p>

<p>Another great benefit of an MVP approach is that it allows you to test a hypothesis with minimal resources. If you have no money in the bank, you can still <a href="http://venturebeat.com/2013/12/10/homeless-coder-prevails-over-skeptics-releases-mobile-app-to-get-off-the-streets/">get something off the ground</a>.</p>

<h2>History</h2>

<p>In the startup world, the idea of MVP was popularized by <a href="http://www.amazon.com/Four-Steps-Epiphany-Steve-Blank/dp/0989200507">Steve Blank</a> and <a href="http://www.startuplessonslearned.com/2008/10/about-author.html">Eric Ries</a>. Eric&rsquo;s 2008 blog post, <a href="http://www.startuplessonslearned.com/2008/09/lean-startup.html">The Lean Startup</a>, kicked off a movement in software development toward building companies around the idea of testing business hypotheses in an iterative way. The idea of MVP is central to this approach, and has become part of the <em>lingua franca</em> of startup culture.</p>

<p>The origins of MVP (and lean software development) draw on the Toyota corporation&rsquo;s <a href="http://en.wikipedia.org/wiki/Lean_manufacturing">lean manufacturing approach</a>, called the <em>Toyota Production System</em> (TPS). Toyota bigwig <a href="http://en.wikipedia.org/wiki/Taiichi_Ohno">Taiichi Ohno</a> coined the idea of &ldquo;Just In Time&rdquo; production, in which return on investment is maximized by reducing inventory.</p>

<p>Among other things, the TPS introduced the idea of <a href="http://en.wikipedia.org/wiki/Kanban">Kanban</a>. The key takeaway of TPS as it applies to software is this: <strong><em>production is determined according to the actual demand of the customer</em></strong>.</p>

<h2>It&rsquo;s Not What You Think It Is</h2>

<p>We&rsquo;ve all seen this picture right?</p>

<p><img src="https://blog.engineyard.com/images/blog-images/actually-mvp.png" alt="" /></p>

<p>Raise your hand if you think it&rsquo;s a good idea.</p>

<p>Now raise your hand if you think you actually follow it. Really? Are you sure you didn&rsquo;t motorize your skateboard? Put a steering wheel on your bike? Let me ask you this: did you actually do a customer interview at any point to see if they even <em>wanted</em> a car?</p>

<p>An MVP may not be what you think it is. Eric Ries <a href="http://www.startuplessonslearned.com/2009/08/minimum-viable-product-guide.html">defines it</a> as &ldquo;that version of a new product which allows a team to collect the maximum amount of validated learning about customers with the least effort&rdquo;. What does that actually mean?</p>

<p>It means building just enough of a product to be deployed and used. It&rsquo;s the <em>minimum</em> feature set that you need to find out whether it makes sense to invest further in an idea. If you&rsquo;re building a dating site for dogs, what do you need? Profiles and messaging. You don&rsquo;t need favoriting, automated emails, or the ability to see who viewed your profile.</p>

<p>If you&rsquo;re breaking ground with a new idea, you can ask yourself: would people use this?
If you&rsquo;re spinning something that&rsquo;s already out there, ask: would people love this more than what they&rsquo;re using now?</p>

<p>Then answer that question. Build profiles and messaging, put it in front of some users, and see if they love it. Track clicks, invite them in for an interview, get their email and reach out personally. Identify <em><a href="http://en.wikipedia.org/wiki/Performance_indicator">Key Performance Indicators</a></em> (KPIs) and use them to verify success.</p>

<p>If they love it, keep going! Add a link to favoriting that doesn&rsquo;t work. Track clicks. If enough people are trying to favorite, build it. Invite users in for an interview. Get their email and reach out personally.</p>

<p>If you try several different feature sets and find out that nobody wants a dating site for dogs, it&rsquo;s ok. In fact, that&rsquo;s great. That means you really did it. You tested the market cheaply <em>before</em> you sunk bags of money into building Doggie Dates. That&rsquo;s a win.</p>

<p>An MVP is not just doing sprints to build your product over time. It’s an <em>experimental process</em>.</p>

<p>It&rsquo;s a small vision, tested and validated thoroughly before moving forward.</p>

<p>It&rsquo;s not twelve weeks of development and a release.</p>

<p>It&rsquo;s continuous deployment.</p>

<p>It&rsquo;s <a href="http://vincentjordan.com/2012/01/why-is-your-minimal-viable-product-mvp-really-just-a-pos/">not a buggy alpha site</a> with ten features that <em>kind of</em> work.</p>

<p>It&rsquo;s the two most defining features needed for the product to be useful.</p>

<p>It&rsquo;s bare, not broken.</p>

<p>On the other hand, an MVP approach is <a href="http://www.startuplessonslearned.com/2009/03/minimum-viable-product.html">not just <em>release early, release often</em></a>, either. Yes, build a small thing. Yes, gather feedback and incorporate it. But don&rsquo;t let the feedback cause you to pivot so hard that you can&rsquo;t remember what you were trying to do in the first place. If you find yourself testing Amazon for dog toys instead of a dating site for dogs, you haven’t pivoted for product-market fit, you’ve pivoted to an entirely new idea.</p>

<p>Start with a vision and stay true to it. Build the skeleton, and let feedback from early users help you flesh out the details.</p>

<h2>Really MVP</h2>

<p>So you want to build a thing, huh? You&rsquo;re going to change the world, like Steve Jobs? Slow down there, buckaroo! I hope you know what you&rsquo;re getting into.</p>

<p>According to <a href="http://get2growth.com/how-many-startups/">this article</a>, there were 1.35 million tech startups as of February 2014. Before you start dreaming of all that VC cash and crack your wallet open to get things off the ground, why don&rsquo;t you do a little experiment to see if it&rsquo;s at all likely that you&rsquo;ll end up anywhere besides broke.</p>

<p>The lean startup approach is all about the <a href="http://theleanstartup.com/principles">build-measure-learn</a> cycle. Before you have a company, you&rsquo;ll have to start by building something.</p>

<h3>First Step: Build</h3>

<p>What&rsquo;s the smallest first step you can take?</p>

<p>The classic example of an MVP you can use to test an idea is a landing page with a sign up form. The idea is to build a pixel-perfect landing page touting all the benefits of joining Doggie Dates and deploy it on an easy-to-use platform like <a href="https://www.engineyard.com/">Engine Yard</a>. Then you drive users to the site by purchasing some Google AdWords, and entice them to sign up with their email for early access to the application.</p>

<p>There has been some recent debate as to whether a landing page is even an MVP. Although some would say no, like <a href="http://ramlijohn.com/a-landing-page-is-not-a-minimum-viable-product/">Ramli John</a>, this strategy doesn&rsquo;t provide enough insight to complete the build-measure-learn cycle. <a href="http://www.startuplessonslearned.com/2009/03/minimum-viable-product.html">Eric Reis</a> and <a href="https://medium.com/@joelgascoigne/how-to-successfully-validate-your-idea-with-a-landing-page-mvp-ef3c2d02dc51">others</a> seem to disagree. A landing page <em>can</em> provide enough information to build a successive MVP and continue to gather feedback. If they sign up they&rsquo;re probably interested in what you&rsquo;re selling.</p>

<p>Although Ramli John isn&rsquo;t a fan of landing pages, he does have some other great suggestions for ways to build a first MVP. Some startups, like AngelList, have begun as an email list. Blogs can be another great place to gather interested users. We&rsquo;ve talked about Eric Reis quite a bit already. His <a href="http://www.startuplessonslearned.com/2008_08_01_archive.html">blog</a> covered topics like refactoring, TDD, and fundraising before he was known for the Lean Startup. You can try getting off the ground with a video and a startup campaign. Finally, you can do it the old fashioned way: <em>the hustle</em>. Just sell your service. In person. <em>Before</em> you build an app.</p>

<p>Landing pages are great for founders of small startups and developers with a great idea for a side project, but what does MVP mean if you have another sort of job?</p>

<p>If you&rsquo;re a consultant like me, encourage your clients to prioritize their feature requests. We have so many awesome things in mind for Doggie Dating! Favoriting, profile walls, see who viewed me, a Dogs You Might Dig service, responsive layouts, native mobile versions&hellip; The list goes on and on. It&rsquo;s great to write them all down and put them in a tracking tool like <a href="https://sprint.ly/">Sprint.ly</a>, so that you don&rsquo;t lose all these creative ideas. Then it&rsquo;s time to prioritize.</p>

<p>What do you need first? What is the smallest version of your idea that people (or dogs) could possibly use? Put those tickets at the top of your tracker, and mark the point when they&rsquo;ll be done with a release bar. Encourage your clients to ask themselves: &ldquo;is this necessary for people to use the site?&rdquo; before you put <em>anything</em> above that bar.</p>

<p>Once you&rsquo;ve reached it, follow the steps below! Measure and learn before you go on. That way, you can collectively decide what should <em>actually</em> be built, instead of spending the client&rsquo;s money building things that are going end up being discarded.</p>

<p>If you&rsquo;re a Product Owner, maybe you&rsquo;re charged with exploring new ways that your company can gain more users, or convince the existing ones to pay more. There are some cool tricks you can use to sneak a feature MVP into what&rsquo;s already there. You can make  links that claim to take the user to one or more features, but are actually inactive (preferably with a modal dialogue to explain what’s going on). Then you track the clicks and decide what to build from there. Or you can ask users to pay for a certain feature before you actually begin development on it. If you don&rsquo;t reach a certain threshold of sign-ups, you just cancel it, apologize, and refund the money.</p>

<p>No matter your role, if people don&rsquo;t seem to want what you&rsquo;ve put out there, delete it and build another version of your dream. Be happy about all the time and money you just saved by not building something that nobody wants! Keep going until you find something that sticks. In this way, you&rsquo;ll set up a great foundation on which to build the rest of your business.</p>

<h3>Second Step: Measure</h3>

<p>Regardless of how you choose to build the first version of your idea, you&rsquo;ll want to measure user engagement once it&rsquo;s deployed. The easiest way to do this is to add Google Analytics into the page and track clicks and pageviews. Reflecting on this information, you&rsquo;ll begin to learn what people want. If anyone actually signs up on your landing page with their email, you can reach out personally (maybe even take them to lunch) and ask them questions to learn more about what people would want to use.</p>

<p>Once you&rsquo;ve gotten past the first iteration of your MVP, you can also invite customers to user testing sessions. These sessions can offer great insight into how your application should behave, and which features are misunderstood or unwanted. Finally, <a href="http://www.startuplessonslearned.com/2008/09/one-line-split-test-or-how-to-ab-all.html">A/B testing</a> can be a great way to research which direction to go next once you&rsquo;ve passed the early stages.</p>

<h3>Third Step: Learn</h3>

<p>After you&rsquo;ve measured clicks, user responses, user testing, and A/B testing results, you can begin to draw conclusions. Maybe dating dogs don&rsquo;t care about favoriting. Delete that feature. Maybe you heard over and over again that having a profile &ldquo;wall&rdquo; would make a huge difference to users. Perhaps that should be the next thing you build?</p>

<p>You need to sift through all of the information that you get and decide how to act.</p>

<h2>Conclusion</h2>

<p>In the software industry, a lot of people pay lip service to the idea of a Minimum Viable Product. But for many of us, it&rsquo;s not what you think it is.</p>

<p>If you&rsquo;re thinking: I know what people want, and I&rsquo;m going to build it, you&rsquo;ve already misunderstood the process. MVPs are experiments, research. How you use them differs a little bit depending on your situation, but the basic premise is the same. Build a small thing, measure the way it&rsquo;s used, learn from it, repeat.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/04/07/seven-unusual-ruby-datastores/">Seven Unusual Ruby Datastores</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-04-07T06:30:04-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post appeared in <a href="http://rubyweekly.com/issues/240">Ruby Weekly #240</a>. It was also included in issue #27.1 of the <a href="http://www.pointer.io/">Pointer.io</a> newsletter. It originally appeared on the <a href="https://blog.engineyard.com/2015/seven-unusual-ruby-datastores">Engine Yard Blog</a></p>

<h2>Introduction</h2>

<p>Admit it: you like the unusual. We all do. Despite constant warnings against premature optimization, an emphasis on &ldquo;readable code&rdquo;, and the old aphorism, &ldquo;keep it simple, stupid&rdquo;, we just can&rsquo;t help ourselves. As programmers, we love exploring new things.</p>

<p>In that spirit, let&rsquo;s go on an adventure. In this post, we&rsquo;ll take a look at seven lesser-known ways to store data in the Ruby language.</p>

<h2>The Ones We Already Know</h2>

<p>Before we get started, we&rsquo;ll set a baseline. What are the ways to store data in Ruby that we use every day? Well, these are the ones that come to mind for me: string, array, hash, CSV, JSON, and the filesystem.</p>

<p>We can skip all of these.</p>

<p>So what are some of the other ways to store data in Ruby? Let&rsquo;s find out.</p>

<h2>Struct</h2>

<h3>What Is It?</h3>

<p>A struct is a way of bundling together a group of variables under a single name. If you&rsquo;ve done any C programming, you&rsquo;ve probably come across structs before.</p>

<p>A struct is similar to a class. At its most basic, it&rsquo;s a group of bundled attributes with accessor methods. You can also define methods that instances of the struct will respond to.</p>

<p>In Ruby, structs inherit from Enumerable, so they come with all kinds of great behavior, like <code>to_a</code>, <code>each</code>, <code>map</code>, and member access with <code>[]</code>.</p>

<p>You can define a struct object by setting a constant equal to <code>Struct.new</code> and passing in some default attribute names. From there, you can create any number of instances of the struct, passing in attribute values for that instance.</p>

<p>Let’s explore one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Cat</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:breed</span><span class="p">,</span> <span class="ss">:hair_length</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">meow</span>
</span><span class='line'>    <span class="s2">&quot;m-e-o-w-w&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">tabby</span> <span class="o">=</span> <span class="no">Cat</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Tabitha&quot;</span><span class="p">,</span> <span class="s2">&quot;Russian Blue&quot;</span><span class="p">,</span> <span class="s2">&quot;short&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">tabby</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Tabitha&quot;</span>
</span><span class='line'><span class="n">tabby</span><span class="o">.</span><span class="n">meow</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;m-e-o-w-w&quot;</span>
</span><span class='line'><span class="n">tabby</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Tabitha&quot;</span>
</span><span class='line'><span class="n">tabby</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">attribute</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="s2">&quot;Tabitha&quot;</span>
</span><span class='line'><span class="s2">&quot;Russian Blue&quot;</span>
</span><span class='line'><span class="s2">&quot;short&quot;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;struct Cat name=&quot;Tabitha&quot;, breed=&quot;Russian Blue&quot;, hair_length=&quot;short&quot;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use It?</h3>

<p>If you want to quickly define a class that has easily accessible attributes and little other behavior, structs are a great choice. Since they also respond to enumerable methods, they are great for use as stubs in tests.</p>

<p>If you want to stub a class and send it a message in a test, but you don&rsquo;t want to use <a href="https://relishapp.com/rspec/rspec-mocks/v/3-2/docs/verifying-doubles/using-an-instance-double">a double</a>, you can fake it with a struct in a single line of code.</p>

<p>Look how simple that is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">fake_stripe_charge</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we&rsquo;ll take a look at <code>Struct</code>&rsquo;s close cousin, <code>OpenStruct</code>.</p>

<h2>OpenStruct</h2>

<h3>What Is It?</h3>

<p>An OpenStruct is somewhat like a hash. It&rsquo;s a data structure that you can use to store and access key-value pairs. In fact, it really <em>is</em> a hash. Under the hood, each OpenStruct uses a hash for data storage. It also defines getters and setters automatically using <code>method_missing</code> and <code>define_method</code>.</p>

<p>There are three main differences between a struct and an open struct.</p>

<p>The first is that when you initialize a struct, you get back a class that inherits from <code>Struct</code>, which you must further instantiate, whereas calling <code>new</code> on an OpenStruct gives you back an <code>OpenStruct</code> object.</p>

<p>Secondly, OpenStructs don&rsquo;t allow you to define behaviors by passing a block to the initializer as we did with the struct above.</p>

<p>Finally, OpenStructs must be passed an argument that responds to <code>each_pair</code> (such as a hash), whereas stucts expect a list of strings or symbols (to define their attribute names).</p>

<p>In the end, an OpenStruct is a much simpler than a struct.</p>

<p>OpenStruct lives in the Ruby Standard Library, so to use it in your code, you&rsquo;ll have to <code>require 'ostruct'</code>.</p>

<p>Let’s explore one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">luke</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
</span><span class='line'>  <span class="ss">home</span><span class="p">:</span> <span class="s2">&quot;Tatooine&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">side</span><span class="p">:</span> <span class="ss">:light</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">weapon</span><span class="p">:</span> <span class="ss">:light_saber</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="n">luke</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;OpenStruct home=&quot;Tatooine&quot;, side=:light, weapon=:light_saber&gt;</span>
</span><span class='line'><span class="n">luke</span><span class="o">.</span><span class="n">home</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Tatooine&quot;</span>
</span><span class='line'><span class="n">luke</span><span class="o">.</span><span class="n">side</span> <span class="o">=</span> <span class="ss">:dark</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="ss">:dark</span>
</span><span class='line'><span class="n">luke</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;OpenStruct home=&quot;Tatooine&quot;, side=:dark, weapon=:light_saber&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use It?</h3>

<p>As with Structs, I like to use OpenStructs as test stubs. Unfortunately, the metaprogramming used behind the scenes makes OpenStructs <a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/ostruct/rdoc/OpenStruct.html#class-OpenStruct-label-Implementation-3A">much slower than hashes</a>, and they also respond to far fewer methods, so they aren&rsquo;t as flexible for everyday use. However, their built-in getters make them really useful anywhere that you need to inject an object that responds to a certain method.</p>

<h2>Marshalling</h2>

<h3>What Is It?</h3>

<p>Marshaling is way to serialize Ruby objects into a binary format. It converts them into a bytestream that can be saved and reconstituted later.</p>

<p>You marshal objects by calling <code>Marshal.dump</code> and <code>Marshal.load</code>.</p>

<p>Here’s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SpaceCaptain</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:rank</span><span class="p">,</span> <span class="ss">:affiliation</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">SpaceCaptain</span>
</span><span class='line'>
</span><span class='line'><span class="n">picard</span> <span class="o">=</span> <span class="no">SpaceCaptain</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Jean-Luc Picard&quot;</span><span class="p">,</span> <span class="s2">&quot;Captain&quot;</span><span class="p">,</span> <span class="s2">&quot;United Federation of Planets&quot;</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;struct SpaceCaptain name=&quot;Jean-Luc Picard&quot;, rank=&quot;Captain&quot;, affiliation=&quot;United Federation of Planets&quot;&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">saved_picard</span> <span class="o">=</span> <span class="no">Marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">picard</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="se">\x04\b</span><span class="s2">S:</span><span class="se">\x11</span><span class="s2">SpaceCaptain</span><span class="se">\b</span><span class="s2">:</span><span class="se">\t</span><span class="s2">nameI</span><span class="se">\&quot;\x14</span><span class="s2">Jean-Luc Picard</span><span class="se">\x06</span><span class="s2">:</span><span class="se">\x06</span><span class="s2">ET:</span><span class="se">\t</span><span class="s2">rankI</span><span class="se">\&quot;\f</span><span class="s2">Captain</span><span class="se">\x06</span><span class="s2">;</span><span class="se">\a</span><span class="s2">T:</span><span class="se">\x10</span><span class="s2">affiliationI</span><span class="se">\&quot;</span><span class="s2">!United Federation of Planets</span><span class="se">\x06</span><span class="s2">;</span><span class="se">\a</span><span class="s2">T&quot;</span>
</span><span class='line'><span class="c1"># Write to disk</span>
</span><span class='line'>
</span><span class='line'><span class="n">loaded_picard</span> <span class="o">=</span> <span class="no">Marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">saved_picard</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;struct SpaceCaptain name=&quot;Jean-Luc Picard&quot;, rank=&quot;Captain&quot;, affiliation=&quot;United Federation of Planets&quot;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use it?</h3>

<p>There are plenty of use cases for serializing code running in memory and saving it for later reuse. For example, if you were writing a video game and you wanted to make it possible for a player to save their game for later, you could marshal the objects in memory (e.g. the player, her location in a map, and any enemies that are nearby) and persist them. You could then load them up again when the player is ready to continue.</p>

<p>Although there are other data serialization formats available, such as JSON, XML, and YAML (which we&rsquo;ll look at next), marshalling is <a href="http://www.skorks.com/2010/04/serializing-and-deserializing-objects-with-ruby/">by far the fastest option</a> available in Ruby. That makes it particularly well-suited to situations where you dealing with large volumes of data or processing it at high speed.</p>

<h2>YAML</h2>

<h3>What is It?</h3>

<p>YAML, which stands for YAML Ain&rsquo;t Markup Language, is a widely-used format for serializing data in a human-readable format. It&rsquo;s available in many languages, of which Ruby is only one. The most widely-used Ruby YAML parser, <a href="https://github.com/tenderlove/psych">psych</a>, is a wrapper around <code>libyaml</code>, the C language parser.</p>

<p>YAML lives in the Ruby Standard Library, so to use it in your code, you&rsquo;ll have to <code>require 'yaml'</code>. You can use the <a href="http://ruby-doc.org/stdlib-2.2.1/libdoc/yaml/rdoc/YAML/Store.html">YAML::Store library</a> to easily save data to disk.</p>

<p>Here’s an example of how to use that library:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;yaml/store&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Database</span>
</span><span class='line'>  <span class="no">DATABASE</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;my_database&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">save_person</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
</span><span class='line'>    <span class="no">DATABASE</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>      <span class="no">DATABASE</span><span class="o">[</span><span class="s2">&quot;people&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>      <span class="no">DATABASE</span><span class="o">[</span><span class="s2">&quot;people&quot;</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="n">user_data</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">bilbo</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">race</span><span class="p">:</span> <span class="ss">:hobbit</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">aliases</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;Bilba Labingi&quot;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">home</span><span class="p">:</span> <span class="s2">&quot;The Shire&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">inventory</span><span class="p">:</span> <span class="o">[</span><span class="ss">:the_one_ring</span><span class="p">,</span> <span class="ss">:arkenstone</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="no">Database</span><span class="o">.</span><span class="n">save_person</span><span class="p">(</span><span class="n">bilbo</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="p">{</span><span class="ss">:race</span><span class="o">=&gt;</span><span class="ss">:hobbit</span><span class="p">,</span> <span class="ss">:aliases</span><span class="o">=&gt;[</span><span class="s2">&quot;Bilba Labingi&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:home</span><span class="o">=&gt;</span><span class="s2">&quot;The Shire&quot;</span><span class="p">,</span> <span class="ss">:inventory</span><span class="o">=&gt;[</span><span class="ss">:the_one_ring</span><span class="p">,</span> <span class="ss">:arkenstone</span><span class="o">]</span><span class="p">},</span> <span class="p">{</span><span class="ss">:race</span><span class="o">=&gt;</span><span class="ss">:hobbit</span><span class="p">,</span> <span class="ss">:aliases</span><span class="o">=&gt;[</span><span class="s2">&quot;Bilba Labingi&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:home</span><span class="o">=&gt;</span><span class="s2">&quot;The Shire&quot;</span><span class="p">,</span> <span class="ss">:inventory</span><span class="o">=&gt;[</span><span class="ss">:the_one_ring</span><span class="p">,</span> <span class="ss">:arkenstone</span><span class="o">]</span><span class="p">}</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s what <code>my_database</code> would look like after running this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">people</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:race</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">:hobbit</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:aliases</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Bilba Labingi</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:home</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">The Shire</span>
</span><span class='line'>  <span class="l-Scalar-Plain">:inventory</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:the_one_ring</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">:arkenstone</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use it?</h3>

<p>YAML serves the same function as marshaling: it&rsquo;s a way to serialize Ruby objects for storage. It&rsquo;s quite a bit slower, but it&rsquo;s human-readable.</p>

<p>YAML is working behind the scenes when ActiveRecord is used to <a href="http://apidock.com/rails/ActiveRecord/Base/serialize/class">serialize a record attribute</a> containing a hash or an array and save it to a text column in the database. When the attribute is retrieved, ActiveRecord deserializes it back from YAML into a Ruby object of its original data type.</p>

<h2>Set</h2>

<h3>What Is It?</h3>

<p>If you&rsquo;re familiar with mathematical <a href="http://en.wikipedia.org/wiki/Set_theory">set theory</a>, the <code>Set</code> class should be pretty intuitive. Sets respond to <code>intersection</code>, <code>difference</code>, <code>merge</code>, and many other Set operations.</p>

<p>It allows you to define a data structure that behaves like an unordered array that can only contain unique members. It exposes many of the same methods available when accessing arrays, but with a faster lookup. Like OpenStruct, Set uses hash under the hood.</p>

<p>Sets can be saved in <a href="http://redis.io/">redis</a>, which makes it possible to look them up very quickly.</p>

<p>Set lives in the Ruby Standard Library, so to use it in your code you&rsquo;ll have to <code>require 'set'</code>.</p>

<p>Here’s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;set&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="o">[</span><span class="ss">:swamp</span><span class="p">,</span> <span class="ss">:island</span><span class="p">,</span> <span class="ss">:forest</span><span class="p">,</span> <span class="ss">:mountain</span><span class="p">,</span> <span class="ss">:plains</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">land</span><span class="o">|</span>
</span><span class='line'>  <span class="n">basic_lands</span> <span class="o">&lt;&lt;</span> <span class="n">land</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:swamp, :island, :forest, :mountain, :plains}&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span> <span class="o">&lt;&lt;</span> <span class="ss">:swamp</span>
</span><span class='line'><span class="c1"># does nothing</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:swamp, :island, :forest, :mountain, :plains}&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">fires_lands</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="o">[</span><span class="ss">:forest</span><span class="p">,</span> <span class="ss">:mountain</span><span class="p">,</span> <span class="ss">:city_of_brass</span><span class="p">,</span> <span class="ss">:karplusan_forest</span><span class="p">,</span> <span class="ss">:rishadan_port</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">land</span><span class="o">|</span>
</span><span class='line'>  <span class="n">fires_lands</span> <span class="o">&lt;&lt;</span> <span class="n">land</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">fires_lands</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:forest, :mountain, :city_of_brass, :karplusan_forest, :rishadan_port}&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">fires_lands</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:forest, :mountain}&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">fires_lands</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:swamp, :island, :plains}&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span><span class="o">.</span><span class="n">subset?</span><span class="p">(</span><span class="n">fires_lands</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'><span class="n">basic_lands</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fires_lands</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Set: {:swamp, :island, :forest, :mountain, :plains, :city_of_brass, :karplusan_forest, :rishadan_port}&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use it?</h3>

<p>Sets are great for situations where you need to make sure that a given element isn&rsquo;t contained in a collection more than once. For example, if you were using tags in an application that was not backed by a database.</p>

<p>They&rsquo;re also great for comparing the equality of two lists without caring about their order (as an array would). You could use this feature to check whether the data stored in memory is in sync with another collection fetched from a remote server.</p>

<h2>Queue</h2>

<h3>What Is It?</h3>

<p>A <a href="http://ruby-doc.org/core-2.2.1/Queue.html">Queue</a> is a place that can be used hold values that you want to share between threads. It&rsquo;s basically a stack that is visible to all of the concurrently running thread process in a given Ruby environment.</p>

<p>If you want to limit the amount of data that can be shared, you can use a <a href="http://ruby-doc.org/core-2.2.1/SizedQueue.html">SizedQueue</a>.</p>

<p>Here’s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;thread&#39;</span>
</span><span class='line'><span class="n">chess_moves</span> <span class="o">=</span> <span class="no">Queue</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="n">player_moves</span> <span class="o">=</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">chess_moves</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;e4&quot;</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">chess_moves</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;e5&quot;</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">chess_moves</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;f4&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">game_board</span> <span class="o">=</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">chess_moves</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">move</span> <span class="o">=</span> <span class="n">chess_moves</span><span class="o">.</span><span class="n">pop</span>
</span><span class='line'>    <span class="c1"># update the ui with the move</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use it?</h3>

<p>Queues are extremely helpful in any application that runs code concurrently. For example, background processing libraries like <a href="https://github.com/resque/resque">Redis</a> <a href="https://github.com/resque/resque/blob/master/lib/resque/queue.rb">make use of a queue</a> to check for the latest jobs and instruct workers to run them.</p>

<h2>ObjectSpace</h2>

<h3>What Is It?</h3>

<p>The ObjectSpace module is a collection of methods that can be used to interact with all of the living objects in the current Ruby environment, as well as the garbage collector.</p>

<p>You can use it to check out all of the objects currently living in memory, look up objects by the object ID reference, and trigger garbage collector runs. You can also define a hook to be triggered when any object of a given class is removed from the ObjectSpace using <code>ObjectSpace#define_finalizer</code>.</p>

<p>How is ObjectSpace a data store? Well, it&rsquo;s the highest-level data store (that hasn&rsquo;t been interpreted or compiled yet) in any place that you can run Ruby code. Any time you define or remove an object from memory, you are changing what is visible in the ObjectSpace.</p>

<p>Let&rsquo;s take a look at everything that&rsquo;s available in an IRB session.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">object_counts</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span> <span class="k">do</span> <span class="o">|</span><span class="n">o</span><span class="o">|</span>
</span><span class='line'>  <span class="n">object_counts</span><span class="o">[</span><span class="n">o</span><span class="o">.</span><span class="n">class</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;pp&quot;</span>
</span><span class='line'><span class="n">pp</span> <span class="n">object_counts</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nb">String</span><span class="o">=&gt;</span><span class="mi">67073</span><span class="p">,</span>
</span><span class='line'>  <span class="nb">Array</span><span class="o">=&gt;</span><span class="mi">14474</span><span class="p">,</span>
</span><span class='line'>  <span class="no">Regexp</span><span class="o">=&gt;</span><span class="mi">164</span><span class="p">,</span>
</span><span class='line'>  <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">=&gt;</span><span class="mi">299</span><span class="p">,</span>
</span><span class='line'>  <span class="no">Hash</span><span class="o">=&gt;</span><span class="mi">1023</span><span class="p">,</span>
</span><span class='line'>  <span class="c1"># and many more...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we create a new object, it ends up in the ObjectSpace.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;ostruct&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="no">OpenStruct</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'><span class="n">spidey</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">({</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Peter Parker&quot;</span><span class="p">,</span> <span class="ss">species</span><span class="p">:</span> <span class="s2">&quot;Human Mutate&quot;</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="no">OpenStruct</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Would You Use it?</h3>

<p>Although you already use the ObjectSpace all the time, whether you realize it or not, knowing about the methods it exposes opens up a lot of possibilities for investigating and improving the performance of your code.</p>

<p>The best use I&rsquo;ve seen for ObjectSpace so far is using it to detect memory leaks. <a href="https://cirw.in/blog/find-references">This article</a> shows an interesting way to map the objects in your object space to create a graph that is useful in tracking down and fixing memory leaks.</p>

<h2>Conclusion</h2>

<p>Ruby is such a fun language to write because there are so many ways to say the same thing. It doesn&rsquo;t stop at writing statements and expressions, though. You can also store data in a huge number of ways.</p>

<p>In this post, we looked at seven fairly unusual ways to handle data in Ruby. Hopefully, reading through them has given you some ideas for how to handle persistence or in-memory storage in your own applications.</p>

<p>Until next time, happy coding!</p>

<ol type="a">
<li><ol type="a">
<li>We know that there are other unusual datastores out there. What are some of your favorites and how do you use them? Leave us a comment!</li>
</ol>
</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/04/01/integrating-react-with-backbone/">Integrating React With Backbone</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-04-01T06:29:54-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/integrating-react-with-backbone">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>There are so many JS frameworks! <a href="http://www.allenpike.com/2015/javascript-framework-fatigue/">It can get tiring</a> to keep up to date with them all.</p>

<p>But like any developer who writes JavaScript, I try to keep abreast of the trends. I like to tinker with new things, and rebuild <a href="http://todomvc.com/">TodoMVC</a> as often as possible.</p>

<p>Joking aside, when it comes to choosing frameworks for a project, emerging frameworks just haven&rsquo;t been battle-tested enough for me to recommend to clients in most cases.</p>

<p>But like much of the community, I feel pretty confident in the future of <a href="http://facebook.github.io/react/index.html">React</a>. It&rsquo;s well documented, makes reasoning about data easy, and it&rsquo;s performant.</p>

<p>Since React only provides the view layer of a client-side <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC application</a>, I still have to find a way to wrap the rest of the application. When it comes to choosing a library that I&rsquo;m confident in, I still reach for <a href="http://backbonejs.org/">BackboneJS</a>. A company that bets on Backbone won&rsquo;t have trouble finding people who can work on their code base. It&rsquo;s been around for a long time, is unopionated enough to be adaptable to many different situations. And as an added bonus, it plays well with React.</p>

<p>In this post, we&rsquo;ll explore the relationship between Backbone and React, by looking at one way to structure a project that uses them together.</p>

<h2>A Note About Setting Up Dependencies</h2>

<p>I won&rsquo;t go over setting up all of the package dependencies for the project here, since I&rsquo;ve covered this process in <a href="http://fluxusfrequency.github.io/blog/2015/02/04/setting-up-a-client-side-javascript-project-with-gulp-and-browserify/">a previous post</a>. For the purposes of this article, you can assume that we&rsquo;re using <a href="http://browserify.org/">Browserify</a>.</p>

<p>One package that is worth noting, though, is <a href="https://github.com/clayallsopp/react.backbone">ReactBackbone</a>. It will allow us to trigger an automatic update of our React components whenever Backbone model or collection data changes. You can get it with <code>npm install --save react.backbone</code>.</p>

<p>We&rsquo;ll also be making use of <a href="https://www.npmjs.com/package/backbone-route-control">backbone-route-control</a> to make it easier to split our URL routes into logically encapsulated controllers. See &ldquo;caching the controller call&rdquo; in <a href="http://fluxusfrequency.github.io/blog/2014/12/09/caching-asynchronous-queries-in-backbone/">this article</a> for more information about how to set this package up.</p>

<h2>Project Structure</h2>

<p>There are many ways to structure the directories for a client-side JS application, and every project lends itself to a slightly different setup. Today we&rsquo;ll be creating our directory structure in a fairly typical fashion for a Backbone project. But we&rsquo;ll also be introducing the concept of <em>screens</em> to our application, so we&rsquo;ll also be extending it slightly.</p>

<p>Here&rsquo;s what we&rsquo;ll need:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assets/
</span><span class='line'>  |- js/
</span><span class='line'>     |- collections/
</span><span class='line'>     |- components/
</span><span class='line'>     |- controllers/
</span><span class='line'>     |- models/
</span><span class='line'>     |- screens/
</span><span class='line'>     |- vendor/
</span><span class='line'>     |- app.js
</span><span class='line'>     |- base-view.js
</span><span class='line'>     |- index.js
</span><span class='line'>     |- router.js</span></code></pre></td></tr></table></div></figure>


<p>Much of this is standard Backbone boilerplate. The <code>collections/</code>, <code>models/</code>, and <code>vendor/</code> directories are self-explanatory. We&rsquo;ll store reusable UI components, such as pagination, pills, and toggles, in <code>components/</code>.</p>

<p>The heart of our app will live in the <code>screens/</code> directory. Here, we&rsquo;ll write React components that will handle the display logic, taking the place of traditional Backbone views and templates. However, we&rsquo;ll still include thin Backbone views to render these components.</p>

<p>We&rsquo;ll talk more about screens in a moment. For now, let&rsquo;s take a look at the how a request will flow through the application, starting from the macro level.</p>

<h2>The Application</h2>

<p>We&rsquo;ll begin by writing a root-level <code>index.js file</code>, which will be the source of the <code>require</code> tree that Browserify will use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./app&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>What is this <code>Application</code>, you may ask? Simply put, it&rsquo;s the function we&rsquo;ll use to bootstrap the entire project. Its purpose is to get all of the dependencies set up, instantiate the controllers and router, kick off Backbone history, and render the main view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./router&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">MainView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./screens/main/index&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersController</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controllers/users-controller&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Backbone</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nx">$</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Application</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">controllers</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">users</span><span class="o">:</span> <span class="k">new</span> <span class="nx">UsersController</span><span class="p">({</span> <span class="nx">app</span><span class="o">:</span> <span class="k">this</span> <span class="p">})</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">app</span><span class="o">:</span> <span class="k">this</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">controllers</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">controllers</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">mainView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MainView</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">router</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">router</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">showApp</span><span class="p">();</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Application</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showApp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">mainView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Router</h3>

<p>Once the application has been booted up, we&rsquo;ll want to be able to accept requests. When one comes in, our app will need to be able to take a look at the URL path in the navigation bar and decide what to do. This is where the router comes in. It&rsquo;s a pretty standard part of any Backbone project, so it probably won&rsquo;t look too out of the ordinary, especially if you&rsquo;ve used <code>backbone-route-control</code> before.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">BackboneRouteControl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone-route-control&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="nx">BackboneRouteControl</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;&#39;</span><span class="o">:</span>          <span class="s1">&#39;users#index&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;users&#39;</span><span class="o">:</span>     <span class="s1">&#39;users#index&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;users/:id&#39;</span><span class="o">:</span> <span class="s1">&#39;users#show&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>When one of these routes is hit, the router will take a look at the controllers we passed into it during app initialization, find the controller with the name to the left of the <code>#</code> and try to call the method name to the right of the <code>#</code> in the string defined for that route.</p>

<h3>Controllers</h3>

<p>Now that the request has been routed through one of the routes, the router will take a look in the matching controller for the method that is to be called. Note that these controllers are not a part of Backbone, but Plain Old JavaScript Objects.</p>

<p>For the purposes of this post, we&rsquo;ll just have a <code>UsersController</code> with two actions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">UsersCollection</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../collections/users-collection&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/user&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersIndexView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../screens/users/index&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserShowView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../screens/users/show&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">usersCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UsersCollection</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">usersCollection</span><span class="p">.</span><span class="nx">fetch</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">usersView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UsersIndexView</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">users</span><span class="o">:</span> <span class="nx">usersCollection</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="nx">app</span><span class="p">.</span><span class="nx">mainView</span><span class="p">.</span><span class="nx">pageRender</span><span class="p">(</span><span class="nx">usersView</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserModel</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">user</span><span class="p">.</span><span class="nx">fetch</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">userView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserShowView</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="nx">app</span><span class="p">.</span><span class="nx">mainView</span><span class="p">.</span><span class="nx">pageRender</span><span class="p">(</span><span class="nx">userView</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UsersController</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This controller loads the <code>User</code> model and collection, and uses them to display the user index and show screens. It instantiates a Backbone collection or model, depending on the route, fetches its data from the server, loads it into the screen (which we&rsquo;ll get to momentarily), then shows that screen in the app&rsquo;s <code>mainView</code> container.</p>

<h2>Screens</h2>

<p>At this point, we&rsquo;ve accepted a request, routed it through a controller action, decided what kind of collection or model we are dealing with, and fetched the data from the server. We&rsquo;re ready to render a Backbone view. In this case, it will do little more than pass the data on to the React component.</p>

<h3>The Base View</h3>

<p>Since there&rsquo;s going to be a lot of repeated boilerplate in our Backbone views, it makes sense to abstract it out into a <code>BaseView</code>, which child views will extend from.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">BaseView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">component</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">component</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">BaseView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This base view sets any options passed in as properties on itself, and defines a <code>render()</code> method that renders whatever React component is defined in the <code>component()</code> method.</p>

<h3>The Main View</h3>

<p>In order to switch between screens without doing a page re-render, we&rsquo;ll wrap all of our screens in an outer screen called the <code>mainView</code>. This view acts as a sort of &ldquo;picture frame&rdquo; for the other screens in the app, displaying, hiding, and cleaning them up.</p>

<p>As with all of our screens, it will consist of two parts: a Backbone view, defined in <code>screens/main/index.js</code>, and a React component, defined in <code>screens/main/component.js</code>.</p>

<h4>Backbone View</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">BaseView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../base-view&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">MainComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./component&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">MainView</span> <span class="o">=</span> <span class="nx">BaseView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">component</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nx">MainComponent</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">router</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">router</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">pageRender</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-container&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">$el</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MainView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we passed <code>#app</code> as the element for this view to attach to back in <code>app.js</code>, it will render itself there. Thinking through what <code>render</code> actually means, we know that it will call the code defined in the <code>BaseView</code>, which means it will render the whatever&rsquo;s returned by the <code>component()</code> function. In this case, it&rsquo;s the React <code>MainComponent</code>. We&rsquo;ll take a look at that in a moment.</p>

<p>The other special thing this view does is to render any subviews passed to <code>pageRender</code> in the <code>#main-container</code> element found within <code>#app</code>. As I said, it&rsquo;s basically just a frame for whatever else is going to happen.</p>

<h4>React Component</h4>

<p>Now let&rsquo;s take a look at that <code>MainComponent</code>. It&rsquo;s a very simple React component that does nothing more than render the &ldquo;container&rdquo; into the DOM.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/** @jsx React.DOM */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ReactBackbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react.backbone&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">MainComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createBackboneClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;main-container&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MainComponent</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it, the whole <code>MainView</code>. Since it&rsquo;s so simple, it makes a good introduction to how we can render components in this project.</p>

<p>Now let&rsquo;s take a look at something a little more advanced.</p>

<h3>User Show View</h3>

<p>We&rsquo;ll start by taking a look at how we might write a React component for a user show page.</p>

<h4>Backbone View</h4>

<p>First, we&rsquo;ll define the <code>UserShowView</code> we referenced back in the <code>UsersController</code>. It should live at <code>screens/users/show/index.js</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">BaseView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../../base-view&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserScreen</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./component&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserView</span> <span class="o">=</span> <span class="nx">BaseView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">component</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserScreen</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">user</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">user</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UsersView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. Mostly just boilerplate. In fact, pretty much all of our Backbone views will look like this. A simple extension of <code>BaseView</code> that defines a <code>component()</code> method. That method instantiates a React component and returns it to the <code>render()</code> method in the <code>BaseView</code>, which in turn is called by the <code>mainView</code>&rsquo;s <code>pageRender()</code> method.</p>

<h4>React Component</h4>

<p>Now, let&rsquo;s dig into the meat of user show screen: the <code>UserScreen</code> component. It will live at <code>screens/users/show/component.js</code>.</p>

<p>We&rsquo;ll imagine that we can &ldquo;like&rdquo; users. We want to be able to increment a user&rsquo;s <code>likes</code> attribute by clicking a button. Here&rsquo;s how we&rsquo;d write this component to handle that behavior.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/** @jsx React.DOM */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ReactBackbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react.backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../../models/user&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserShowScreen</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createBackboneClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">mixins</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>     <span class="nx">React</span><span class="p">.</span><span class="nx">BackboneMixin</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">liked</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">handleLike</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">currentLikes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;likesCount&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span> <span class="nx">likesCount</span><span class="o">:</span> <span class="nx">currentLikes</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">avatar</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">).</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">likesCount</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;likesCount&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;user-container&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">&#39;</span><span class="nx">s</span> <span class="nx">Profile</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">avatar</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">likesCount</span><span class="p">}</span> <span class="nx">likes</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;like-button&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleLike</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="nx">Like</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UserShowScreeen</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You may have noticed that curious <code>mixins</code> property. What is that? <code>react.backbone</code> gives us some niceties here, since we&rsquo;re calling <code>React.createBackboneClass</code> instead of <code>React.createClass</code>. Whenever the <code>user</code> prop that was passed into this component fires a <code>change</code> event, the component&rsquo;s <code>render()</code> method will be called. For more information, take a look at <a href="https://github.com/clayallsopp/react.backbone">the package on GitHub</a>.</p>

<p>When we click that like button, we&rsquo;re incrementing the <code>likesCount</code> attribute on the user, and saving it to the server with our <code>save()</code> call. When the result of that <code>sync</code> comes back, our view will automatically re-render, and the likes count indication will update! Pretty sweet!</p>

<h3>Users Index Screen</h3>

<p>Before we conclude this post, lets take a look at one more case: the index screen. Here, we&rsquo;ll see how using React can make it easier to render repetitive subcomponents.</p>

<h4>Backbone View</h4>

<p>The view for this screen will live at <code>/screens/users/index/index.js</code>, and look similar to the <code>UserShowView</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">BaseView</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../../../base-view&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersIndexScreen</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./component&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersIndexScreen</span> <span class="o">=</span> <span class="nx">BaseView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">component</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nx">UsersIndexScreen</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">users</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">users</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UsersIndexView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Backbone Component</h4>

<p>The <code>UsersIndexScreen</code> component will also be fairly similar to the <code>UserShowScreen</code> one, but with one key difference: since we&rsquo;re going to be rendering the same DOM elements repeatedly, we can leverage subcomponents.</p>

<p>Here&rsquo;s the main component, which lives at <code>screens/users/index/component.js</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/** @jsx React.DOM */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ReactBackbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react.backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">UserBlock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;.user-block&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">UsersIndexScreen</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createBackboneClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">mixins</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>     <span class="nx">React</span><span class="p">.</span><span class="nx">BackboneMixin</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">userBlocks</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">UserBlock</span> <span class="nx">user</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="o">/&gt;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;users-container&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Users</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>        <span class="p">{</span><span class="nx">userBlocks</span><span class="p">}</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UsersIndexScreen</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re just looping through the users that were passed into the component, and wrapping each one in a <code>UserBlock</code> React component. This component can be defined in a file that lives right alongside <code>index.js</code> and <code>component.js</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/** @jsx React.DOM */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ReactBackbone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react.backbone&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">MemberBlock</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createBackboneClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">avatar</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">).</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="s1">&#39;/users/&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;user-block&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="nx">link</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">avatar</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">UserBlock</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Voila! An index view at <code>/users</code> that shows all of our users&#8217; beautiful faces and links to their show pages. It was pretty painless, thanks to React!</p>

<h2>Wrapping Up</h2>

<p>We&rsquo;ve now traced the entire series of events that happens when someone loads up our application and requests a route. After going through the router and controller, the fetched data is injected through a Backbone view into a React component, which is then rendered by the app&rsquo;s <code>mainView</code>.</p>

<p>We only barely scratched the surface of what React is capable of here. If you haven&rsquo;t checked out the <a href="http://facebook.github.io/react/docs/component-api.html">React component API docs</a>, I highly suggest doing so. Once I began to fully harness the power it gave me, I found my projects&#8217; view layers much cleaner. Plus, I get all of the React <a href="http://facebook.github.io/react/docs/advanced-performance.html">performance benefits</a> for free!</p>

<p>I hope that this post has helped make it more obvious how to get started with integrating React into a Backbone app. To me, it always seemed like a good idea, but I didn’t know where to begin. Once I got a sense of the pattern, though, it became pretty easy to do.</p>

<p>P.S. Do you have a different pattern for using React in your Backbone app? Want to talk about using React in Ember or Angular? Leave us a note in the comments!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/03/26/understanding-rack-apps-and-middleware/">Understanding Rack Apps and Middleware</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-03-26T06:29:45-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/understanding-rack-apps-and-middleware">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>For many of us web developers, we work on the highest levels of abstraction when we program. Sometimes it&rsquo;s easy to take things for granted. Especially when we&rsquo;re using Rails.</p>

<p>Have you ever dug into the internals of how the request/response cycle works in Rails? I recently realized that I knew almost nothing about how Rack or middlewares work, so I spent a little time finding out. In this post, I&rsquo;ll share what I learned.</p>

<h2>What&rsquo;s Rack?</h2>

<p>Did you know that Rails is a <a href="http://rack.github.io/">Rack</a> app? Sinatra too. What is Rack? I&rsquo;m glad you asked. Rack is a Ruby package that provides an easy-to-use interface to the Ruby <a href="http://ruby-doc.org/stdlib-2.2.0/libdoc/net/http/rdoc/Net/HTTP.html">Net::HTTP</a> library.</p>

<p>It&rsquo;s possible to quickly build simple web applications using just Rack.</p>

<p>To get started, all you need is an object that responds to a <code>call</code> method, taking in an environment hash and returning an Array with the HTTP response code, headers, and response body. Once you&rsquo;ve written the server code, all you have to do is boot it up with a Ruby server like <code>Rack::Handler::WEBrick</code>, or put it into a <code>config.ru</code> file and run it from the command line with <code>rackup config.ru</code>.</p>

<p>Ok, cool. So what does Rack actually <em>do</em>?</p>

<h2>How Rack Works</h2>

<p>Rack is really just a way for a developer to create a server application while avoiding the boilerplate code that would be required to do so using <code>Net::HTTP</code>. If you&rsquo;ve written some code that meets the Rack specifications, you can load it up in a Ruby server like <code>WEBrick</code>, <code>Mongrel</code>, or <code>Thin</code>, and you&rsquo;re ready to accept requests and respond to them.</p>

<p>There are a few methods you should know about that are provided for you. You can call these directly from within your <code>config.ru</code> file.</p>

<p><strong><em><code>run</code></em></strong>
Takes an application (the object that responds to <code>call</code>) as an argument. The following code from the Rack website demonstrates how this looks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>run Proc.new { |env| ['200', {'Content-Type' =&gt; 'text/html'}, ['get rack\'d']] }</span></code></pre></td></tr></table></div></figure>


<p><strong><em><code>map</code></em></strong>
Takes a string specifying the path to be handled, and a block containing the Rack application code to be run when a request with that path is received. Here&rsquo;s an example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map '/posts' do
</span><span class='line'>  run Proc.new { |env| ['200', {'Content-Type' =&gt; 'text/html'}, ['first_post', 'second_post', 'third_post']] }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p><strong><em><code>use</code></em></strong>
Tells Rack to use certain middleware.</p>

<p>So what else do you need to know? Let&rsquo;s take a closer look at the environment hash and the response Array.</p>

<h3>The Environment Hash</h3>

<p>Your Rack server object takes in an environment hash. What&rsquo;s contained in that hash? Here are a few of the more interesting parts:</p>

<ul>
<li><code>REQUEST_METHOD</code>: The HTTP verb of the request. This is required.</li>
<li><code>PATH_INFO</code>: The request URL path, relative to the root of the application.</li>
<li><code>QUERY_STRING</code>: Anything that followed <code>?</code> in the request URL string.</li>
<li><code>SERVER_NAME</code> and <code>SERVER_PORT</code>: The server&rsquo;s address and port.</li>
<li><code>rack.version</code>: The rack version in use.</li>
<li><code>rack.url_scheme</code>: is it <code>http</code> or <code>https</code>?</li>
<li><code>rack.input</code>: an IO-like object that contains the raw HTTP POST data.</li>
<li><code>rack.errors</code>: an object that response to <code>puts</code>, <code>write</code>, and <code>flush</code>.</li>
<li><code>rack.session</code>: A key value store for storing request session data.</li>
<li><code>rack.logger</code>: An object that can log interfaces. It should implement <code>info</code>, <code>debug</code>, <code>warn</code>, <code>error</code>, and <code>fatal</code> methods.</li>
</ul>


<p>A lot of frameworks built on Rack wrap the <code>env</code> hash in a <code>Rack::Request</code> object. This object provides a lot of convenience methods. For example, <code>request_method</code>, <code>query_string</code>, <code>session</code>, and <code>logger</code> return the values from the keys described above. It also lets you check out things like the <code>params</code>, HTTP <code>scheme</code>, or whether you&rsquo;re using <code>ssl?</code>. For a complete listing of methods, I would suggest digging through <a href="https://github.com/rack/rack/blob/master/lib/rack/request.rb">the source</a>.</p>

<h3>The Response</h3>

<p>When your Rack server object returns a response, it must contain three parts: the status, headers, and body. As there was for the request, there is a <a href="https://github.com/rack/rack/blob/master/lib/rack/response.rb">Rack::Response</a> object that gives you convenience methods like <code>write</code>, <code>set_cookie</code>, <code>finish</code>, and more. Alternately, you can just return an array containing the three components.</p>

<h4>Status</h4>

<p>An <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status</a>, like 200 or 404.</p>

<h4>Headers</h4>

<p>Something that responds to each, and yields key-value pairs. The keys have to be strings and conform to the <a href="https://tools.ietf.org/html/rfc7230">RFC7230 token specification</a>. Here&rsquo;s where you can set <code>Content-Type</code> and <code>Content-Length</code> if it&rsquo;s appropriate for your response.</p>

<h4>Body</h4>

<p>The body is the data that the server sends back to the requester. It has to respond to <code>each</code>, and yield string values.</p>

<h3>All Racked Up!</h3>

<p>Now that we&rsquo;ve created a Rack app, how can we customize it to make it actually useful? The first step is to consider adding some middleware.</p>

<h2>What is Middleware?</h2>

<p>One of the things that makes Rack so great is how easy it is to add a chain middleware components between the webserver and the app to customize the way your request/response behaves. But what <em>is</em> a middleware component?</p>

<p>A middleware component sits between the client and the server, processing inbound requests and outbound responses. Why would you want to do that? There are tons of <a href="https://github.com/rack/rack/wiki/List-of-Middleware">middleware components available for Rack</a> that take the guesswork out of problems like enabling caching, authentication, trapping spam, and many other problems.</p>

<h2>Using Middleware in a Rack App</h2>

<p>To add middleware to a Rack application, all you have to do is tell Rack to use it. You can use multiple middleware components, and they will change the request or response before passing it on to the next component. This series of components is called the <em>middleware stack</em>.</p>

<h3>Warden</h3>

<p>We&rsquo;re going to take a look at how you would add <a href="https://github.com/hassox/warden">Warden</a> to a project. Warden has to come <em>after</em> some kind of session middleware in the stack, so we&rsquo;ll use <code>Rack::Session::Cookie</code> as well.</p>

<p>First, add it to your project <code>Gemfile</code> with <code>gem "warden"</code> and install it with <code>bundle install</code>.</p>

<p>Now add it to your <code>config.ru</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require "warden"
</span><span class='line'>
</span><span class='line'>use Rack::Session::Cookie, secret: "MY_SECRET"
</span><span class='line'>
</span><span class='line'>failure_app = Proc.new { |env| ['401', {'Content-Type' =&gt; 'text/html'}, ["UNAUTHORIZED"]] }
</span><span class='line'>
</span><span class='line'>use Warden::Manager do |manager|
</span><span class='line'>  manager.default_strategies :password, :basic
</span><span class='line'>  manager.failure_app = failure_app
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>run Proc.new { |env| ['200', {'Content-Type' =&gt; 'text/html'}, ['get rack\'d']] }</span></code></pre></td></tr></table></div></figure>


<p>Finally, run the server with <code>rackup</code>. It will find <code>config.ru</code> and boot up on port 9292.</p>

<p>Note that there is more setup involved in getting Warden to actually do authentication with your app. This is just an example of how to get it loaded into the middleware stack. To see a more fleshed-out example of integrating Warden, check out <a href="https://gist.github.com/lukesutton/107966">this gist</a>.</p>

<p>By the way, there&rsquo;s another way to define the middleware stack. Instead of calling <code>use</code> directly in <code>config.ru</code>, you can use <code>Rack::Builder</code> to wrap several middlewares and app(s) in one big application. For example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>failure_app = Proc.new { |env| ['401', {'Content-Type' =&gt; 'text/html'}, ["UNAUTHORIZED"]] }
</span><span class='line'>
</span><span class='line'>app = Rack::Builder.new do
</span><span class='line'>  use Rack::Session::Cookie, secret: "MY_SECRET"
</span><span class='line'>
</span><span class='line'>  use Warden::Manager do |manager|
</span><span class='line'>    manager.default_strategies :password, :basic
</span><span class='line'>    manager.failure_app = failure_app
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>run app</span></code></pre></td></tr></table></div></figure>


<h3>Rack Basic Auth</h3>

<p>One really useful piece of middleware is <code>Rack::Auth::Basic</code>, which you can use to protect any Rack app with <a href="http://tools.ietf.org/html/rfc2617">HTTP basic authentication</a>. It is really lightweight and comes in handy for protecting little bits of an application. For example, Ryan Bates uses it to protect a Resque server in a Rails app in <a href="http://railscasts.com/episodes/271-resque?view=asciicast">this episode of Railscasts</a>.</p>

<p>Here&rsquo;s how to set it up:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>use Rack::Auth::Basic, "Restricted Area" do |username, password|
</span><span class='line'>  [username, password] == ['admin', 'abc123']
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>That was easy!</p>

<h2>Using Middleware in Rails</h2>

<p>Now, so what? Rack is pretty cool, and we know that Rails is built on it. But just because we understand what it is, doesn&rsquo;t make it actually useful in working with a production app.</p>

<h3>How Rails Uses Rack</h3>

<p>Did you ever notice that there&rsquo;s a <code>config.ru</code> file in the root of every generated Rails project. Have you ever taken a look inside? Here&rsquo;s what it contains:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># This file is used by Rack-based servers to start the application.
</span><span class='line'>
</span><span class='line'>require ::File.expand_path('../config/environment', __FILE__)
</span><span class='line'>run Rails.application</span></code></pre></td></tr></table></div></figure>


<p>Pretty simple. It just loads up the <code>config/environment</code> file, then boots up <code>Rails.application</code>. Wait, what&rsquo;s that? Taking a look in <code>config/environment</code>, we can see that it&rsquo;s defined in <code>config/application.rb</code>. <code>config/environment</code> is just calling <code>initialize!</code> on it.</p>

<p>So what&rsquo;s in <code>config/application.rb</code>? If we take a look, we see that it loads in the bundled gems from <code>config/boot.rb</code>, requires <code>rails/all</code>, loads up the environment (test, development, production, etc.), and defines a namespaced version of our application. It looks something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>module MyApplication
</span><span class='line'>  class Application &lt; Rails::Application
</span><span class='line'>    ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>So I guess that means that <code>Rails::Application</code> must be a Rack app? Sure enough! If we check out <a href="https://github.com/rails/rails/blob/master/railties/lib/rails/application.rb#L161">the source code</a>, it responds to <code>call</code>!</p>

<p>So what middleware is it using? Well, I see that <a href="https://github.com/rails/rails/blob/master/railties/lib/rails/application.rb#L182">it&rsquo;s autoloading</a> <code>rails/application/default_middleware_stack</code>. <a href="https://github.com/rails/rails/blob/master/railties/lib/rails/application/default_middleware_stack.rb#L13">Checking that out</a>, it looks like it&rsquo;s defined in <code>ActionDispatch</code>. Where does <code>ActionDispatch</code> come from? <code>ActionPack</code>.</p>

<h3>Action Dispatch</h3>

<p><a href="https://github.com/rails/rails/tree/master/actionpack">Action Pack</a> is Rails&rsquo;s framework for handling web requests and responses. Action Pack home to quite a few of the niceties you find in Rails, such as routing, the the abstract controllers that you inherit from, and view rendering.</p>

<p>The most relevant part of AP for our discussion here is <a href="https://github.com/rails/rails/tree/master/actionpack/lib/action_dispatch">Action Dispatch</a>. It provides several middleware components that deal with ssl, cookies, debugging, static files, and much more.</p>

<p>If you go take a look at each of the <a href="https://github.com/rails/rails/tree/master/actionpack/lib/action_dispatch/middleware">Action Dispatch middleware components</a>, you&rsquo;ll notice they&rsquo;re all following the Rack specification: they all respond to <code>call</code>, taking in an <code>app</code> and returning <code>status</code>, <code>headers</code>, and <code>body</code>. Many of them also make use of <code>Rack::Request</code> and <code>Rack::Response</code> objects.</p>

<p>For me, reading through the code in these components took a lot of the mystery out of what&rsquo;s going on behind the scenes when making requests to a Rails app. When I realized that it&rsquo;s just a bunch of Ruby objects that follow the Rack specification, passing the request and response to each other, it made this whole section of Rails a lot less mysterious.</p>

<p>Now that we understand a little bit of what&rsquo;s happening under the hood, let&rsquo;s take a look at how to actually include some custom middleware in a Rails app.</p>

<h3>Adding Your Own Middleware</h3>

<p>Imagine you are <a href="https://www.engineyard.com/trial">hosting an application on Engine Yard</a>. You have a Rails API running on one server, and a client-side JavaScript app running on another. The API has a url of <code>https://api.myawesomeapp.com</code>, and the client-side app lives at <code>https://app.myawesomeapp.com</code>.</p>

<p>You&rsquo;re going to run into a problem pretty quick: you can&rsquo;t access resources at <code>api.myawesomeapp.com</code> from your JS app, because of the <a href="http://en.wikipedia.org/wiki/Same-origin_policy">same-origin policy</a>. As you may know, the solution to this problem is to enable <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing</a> (CORS). There are many ways to enable CORS on your server, but one of the easiest is to use the <a href="https://github.com/cyu/rack-cors">Rack::Cors middleware gem</a>.</p>

<p>Begin by requiring it in the <code>Gemfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;rack-cors&quot;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="s2">&quot;rack/cors&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As with so many things, Rails provides a very easy way to get middleware loaded. Although we certainly <em>could</em> add it to a <code>Rack::Builder</code> block in <code>config.ru</code>, as we did above, the Rails convention is to place it in <code>config/application.rb</code>, using the following syntax:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">MyAwesomeApp</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
</span><span class='line'>    <span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">insert_before</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Rack::Cors&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">allow</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">origins</span> <span class="s1">&#39;*&#39;</span>
</span><span class='line'>        <span class="n">resource</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:expose</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;X-User-Authentication-Token&#39;</span><span class="p">,</span> <span class="s1">&#39;X-User-Id&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:options</span><span class="p">,</span> <span class="ss">:patch</span><span class="p">,</span> <span class="ss">:delete</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we&rsquo;re using <a href="http://guides.rubyonrails.org/rails_on_rack.html#configuring-middleware-stack">insert_before</a> here to ensure that <code>Rack::Cors</code> comes before the rest of the middleware included in the stack by ActionPack (and any other middleware you might be using).</p>

<p>Now if you reboot the server, you should be good to go! Your client-side app can access <code>api.myawesomeapp.com</code> without running into same-origin policy JS errors.</p>

<p>If you want to learn more about how HTTP requests are routed through Rack in Rails, I’d suggest taking a look at <a href="https://www.omniref.com/ruby/gems/railties/4.2.0/symbols/Rails::Application#annotation=4084035&amp;line=161">this tour</a> of the Rails source code that deals with handling requests.</p>

<h2>Conclusion</h2>

<p>In this post, we&rsquo;ve take an in-depth at the internals of Rack, and by extension, the request/response cycle for several Ruby web frameworks, including Ruby on Rails.</p>

<p>Hopefully, understanding what&rsquo;s going on when a request hits your server and your application sends back a response helps make things feel a little less <em>magical</em>. Because I don&rsquo;t know about you, but when things go wrong, I have a lot harder time troubleshooting when there&rsquo;s magic involved than when I understand what&rsquo;s going on. In that case, I can say &ldquo;oh, it&rsquo;s just a Rack response&rdquo;, and get down to fixing the bug.</p>

<p>If I&rsquo;ve done my job, reading this article will enable you to do the same thing.</p>

<p>P.S. Do you know of any use-cases where a simple Rack app was enough to meet your business needs? What other ways do you integrate Rack apps in your bigger applications? We want to hear your battle stories! Leave us a comment!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/03/12/deploying-and-customizing-applications-on-engine-yard/">Deploying and Customizing Applications on Engine Yard</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-03-12T06:29:30-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/deploying-and-customizing-applications">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>I&rsquo;ve tried a lot of different Platform as a Service (PaaS) providers for hosting my applications. Some of them make it super-easy to get everything running on the server, but the magic gets in the way when you need to customize things.</p>

<p>Some platforms give you full control, but it can be time-consuming to get all of your dependencies properly set up. It would be nice to have some of the boilerplate taken care of, while still retaining full control of my server environment.</p>

<p>If you haven’t deployed an application to Engine Yard (EY), you should give it a try. You’ll be pleasantly surprised to find that this is exactly the kind of service offered. It’s a breeze to get Redis, cron, and any other tools you need installed. You also get root access to your server and can SSH in just as you would with a bare server.</p>

<p>My favorite feature has always been the ability to push custom Chef recipes to my server, making it super-easy to tweak the server as needed without having to spend a lot of time downloading Ubuntu packages and managing user permissions.</p>

<p>There is a little bit of a learning curve though, so I decided to deploy and customise a new app on Engine Yard so that I could document the process and help first-timers get up and running with a minimum of fuss.</p>

<h2>Setting Up An Engine Yard Environment</h2>

<p>I started out with a production application in a Git repository that was ready to go. It just needed a server to run on.</p>

<p>I went to Engine Yard and signed up for <a href="https://www.engineyard.com/trial">a free trial account</a>.</p>

<p>Once I was done filling out my contact and billing information, I created my first &ldquo;application&rdquo; resource on Engine Yard Cloud. Here are the steps I followed to get it running from there.</p>

<p>First, I created a &ldquo;production&rdquo; environment for my application and configured it. I was given four choices of server beefiness: single instance, staging, production, or custom. I went with a production box, and added Phusion Passenger and PostgreSQL to the stack. Since I was deploying a Rails app, I also added Ruby 2.2.0 and set up my migration command. I was happy to see that EY would backup by my database and take a server snapshot on a recurring schedule. I opted in for that service.</p>

<p>While the server was being provisioned, there were a few access-related tasks I had to take care of as well. First, I <a href="https://support.cloud.engineyard.com/entries/21016533-Connect-to-Your-Instance-Using-SSH">added the SSH keys</a> from my development machine to my production environment. To do so, I visited the EY Cloud dashboard, then clicked on <em>Tools</em>, then <em>SSH Keys</em> and pasted my key into the text area, then hit the big <em>Apply</em> button on my app&rsquo;s &ldquo;production&rdquo; environment page.</p>

<p>I also had to add an SSH key EY provided to my GitHub account. This allowed EY to grab my code and push it to the server directly.</p>

<p>A few minutes later, the server and my credentials were all set up, and I was ready to deploy. Next, I pressed <em>Deploy</em>.  Unfortunately, there was a problem with my deploy, so I decided to dig into it from the command line&hellip;</p>

<h2>Using the <code>engineyard</code> Gem</h2>

<h3>Configuring and Deploying</h3>

<p>It turned out I’d forgotten to add a <code>config/ey.yml</code> file to my Rails project. This file is used to customize each of the Engine Yard environments the app is being deployed to. To add one, it’s easiest use the <a href="https://github.com/engineyard/engineyard">engineyard gem</a>.</p>

<p>To install the gem globally, I ran <code>gem install engineyard</code> on my local machine. Then I initialized an EY configuration file using <code>ey init</code>. I checked out the <code>config/ey.yml</code> file it generated. Everything looked good, so I committed and pushed it up to GitHub.</p>

<p>This time, I deployed using <code>ey deploy</code>, and it worked like a charm. Success!</p>

<h3>Logging In and Out</h3>

<ul>
<li><code>ey login</code></li>
<li><code>ey logout</code></li>
<li><code>ey whoami</code></li>
</ul>


<h3>Custom Deploys</h3>

<ul>
<li><code>ey status</code> shows the status of your most recent deploy</li>
<li><code>ey timeout-deploy</code> marks the current deploy as failed and begins a new deploy</li>
<li><code>ey rollback</code> revert to a previous deployment</li>
</ul>


<h3>Environments</h3>

<ul>
<li><code>ey environments</code> shows the environments for this app (pass <code>--all</code> to see all environments for all apps)</li>
<li><code>ey servers</code> shows all the servers for an environment (if you have multiple)</li>
<li><code>ey rebuild</code> reruns the configuration bootstrap process, useful for security patches and upgrades</li>
<li><code>ey restart</code> restarts the servers</li>
</ul>


<h3>Debugging</h3>

<ul>
<li><code>ey logs</code> shows the logs</li>
<li><code>ey web disable</code>/<code>enable</code> toggles a maintenance page</li>
<li><code>ey ssh</code> lets you SSH in</li>
<li><code>ey launch</code> launches app in a browser window</li>
</ul>


<h3>Customizing The Server Environment</h3>

<ul>
<li><code>ey recipes upload</code> adds Chef recipes from your dev machine and the remote server</li>
<li><code>ey recipes download</code> syncs Chef recipes from the remote server to your dev machine</li>
<li><code>ey recipes apply</code> trigger a Chef run</li>
</ul>


<p>These last few commands come in really handy when you want to customize your server setup. Let&rsquo;s take a deeper look at how to upload custom Chef recipes to an application environment.</p>

<h2>Chef Recipes</h2>

<p>Engine Yard uses Chef under the hood to make your deploys quick and easy. There&rsquo;s a default set of recipes that get run every time you deploy.</p>

<p>After the default recipes run, Engine Yard runs any custom recipes that you&rsquo;ve added to your environment. Since there are <a href="https://github.com/opscode-cookbooks">so many Chef recipes available</a>, getting dependencies set up is pretty straightforward.</p>

<p>Your Chef recipes will run whenever you create a new instance, add an instance to a cluster, run <code>ey recipes apply</code>, or trigger a Chef run with from the Cloud Dashboard with the <em>Upgrade</em> or <em>Apply</em> buttons.</p>

<h3>Getting Set Up</h3>

<p>To add recipes to your application, you&rsquo;ll need to fork the <a href="https://github.com/engineyard/ey-cloud-recipes">Engine Yard Cloud Recipes repo</a>. Then, clone your fork down to your development machine, in a different directory than your application.</p>

<h3>Default Recipes</h3>

<p>The Engine Yard Cloud Recipes repo comes with comes with cookbooks for most of the things you would ever need: Sidekiq, Redis, Solr, Elasticsearch, cron, PostgreSQL Extensions, and much more.</p>

<p>Here&rsquo;s what I did to add Redis to my project.</p>

<p>1) Opened <code>/cookbooks</code> and found the subdirectory I wanted (<code>/redis</code>)
2) Uncommented <code>include_recipe redis</code> in <code>cookbooks/main/recipes/default.rb</code>
3) Saved the file, committed it, and push to my forked repo
4) Uploaded the recipes to my app with <code>ey recipes upload -e production</code>
5) Applied the recipes to my app with <code>ey recipes apply -e production</code></p>

<p>I took a look at my Engine Yard dashboard, and a few short moments later, Redis was running on my server!</p>

<h3>Custom Recipes</h3>

<p>I wanted to add HTTP Basic Auth to my server, but it wasn&rsquo;t one of the recipes in the repo, so I wrote my own recipe for it.</p>

<p>Here&rsquo;s how I did it.</p>

<p>First, I opened up my <code>ey-cloud-recipes</code> fork repo and ran <code>rake new_cookbook COOKBOOK=httpauth</code>. This generated a bunch of files under <code>cookbooks/httpauth/</code>. Then I edited <code>cookbooks/httpauth/recipes/default.rb</code> like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysadmins = search(:users, 'groups:sysadmin')
</span><span class='line'>
</span><span class='line'>template "/etc/nginx/htpasswd.users" do
</span><span class='line'>  source "nginx/htpasswd.users.erb"
</span><span class='line'>  owner node['staging']['nginx']['user']
</span><span class='line'>  group node['staging']['nginx']['user']
</span><span class='line'>  mode "0640"
</span><span class='line'>  variables(
</span><span class='line'>    :sysadmins =&gt; sysadmins
</span><span class='line'>  )
</span><span class='line'>  notifies :restart, "service[nginx]", :delayed
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>With the <code>httpauth</code> recipe written, I next created a <code>htpasswd.users.erb</code> under the `cookbooks/httpauth/templates/default/nginx directory, and put this code in it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;% @sysadmins.each do |sa| -%&gt;
</span><span class='line'>  &lt;%= sa["id"] %&gt;:&lt;%= sa["htpasswd"] %&gt;
</span><span class='line'>&lt;% end -%&gt;</span></code></pre></td></tr></table></div></figure>


<p>With the template in place, I added the recipe to <code>cookbooks/main/recipes/default.rb</code> (my main cookbook) by adding this line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>include_recipe "httpauth"</span></code></pre></td></tr></table></div></figure>


<p>Finally, I checked my syntax with <code>rake test</code> (all good), committed my changes, and pushed to my fork. With the recipe ready, all that was left was to upload and apply it to my application with the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ey recipes upload -e production
</span><span class='line'>ey recipes apply -e production</span></code></pre></td></tr></table></div></figure>


<p>The recipe was successfully added to my server in the <code>/etc/chef-custom</code> directory. I know this because I logged in and took a look around.</p>

<p>How did I do that? I&rsquo;m glad you asked.</p>

<h2>Remote Access with SSH</h2>

<p>If you ever need to confirm that your Chef recipes are configuring the server the way you expected, or need to access your server directly with root access for any other reason, you can use SSH to get a remote terminal.</p>

<p>There are three ways to do this:</p>

<p>1) Run <code>ssh username@123.123.123.123</code>, the old-fashioned way (you can find your server&rsquo;s IP address in the Engine Yard dashboard).
2) Click on the SSH link in your application dashboard on EY instead
3) Run <code>ey ssh</code> from the application directory on your dev machine</p>

<p>When you login to your server, some helpful information about your app&rsquo;s server environment is displayed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Applications:
</span><span class='line'>myapplication:
</span><span class='line'>cd /data/myapplication/current # go to the application root folder
</span><span class='line'>tail -f /data/myapplication/current/log/production.log # production logs
</span><span class='line'>cat /data/nginx/servers/myapplication.conf # current nginx conf
</span><span class='line'>
</span><span class='line'>SQL database:
</span><span class='line'>cd /db # your attached DB volume
</span><span class='line'>
</span><span class='line'>PostgreSQL:
</span><span class='line'>tail -f /db/postgresql/$1.$2/data/pg_log/* # logs
</span><span class='line'>pg_top -dmyapplication
</span><span class='line'>
</span><span class='line'>Inspect node data passed to chef cookbooks:
</span><span class='line'>sudo gem install jazor
</span><span class='line'>sudo jazor /etc/chef/dna.json
</span><span class='line'>sudo jazor /etc/chef/dna.json 'applications.map {|app, data| [app, data.keys]}'</span></code></pre></td></tr></table></div></figure>


<p>Pretty cool. It&rsquo;s nice to have access like this if you need it, without being responsible for configuring (and re-configuring) the entire machine by hand.</p>

<h2>Conclusion</h2>

<p>If you&rsquo;re anything like me, you drag your feet about trying new things when it comes to sysops. Perhaps you&rsquo;ve felt the pain of trying to take a server from vanilla Ubuntu to a custom build with cron, Redis, Elasticsearch and a bunch of other packages—carefully balancing everything so that it doesn&rsquo;t fall apart. Many of us have also experienced getting stuck when using a full-service PaaS that isn&rsquo;t working the way we expect, and not being able to customise things. Experiences like this make it hard for me to get excited about setting up servers, so I typically avoid it when I can.</p>

<p>That said, Engine Yard makes this sort of work a breeze. Their balance between automation and control gives you the best of both worlds. Getting up and running takes a little bit of learning, but the <a href="https://support.cloud.engineyard.com/home">docs</a>  are super helpful and  the support team is very responsive if you ever have any questions or need a hand.</p>

<p>If you haven&rsquo;t given Engine Yard a try, why not give it a go?</p>

<p>P.S. What kind of custom Chef recipes are you using on your servers? I know that business requirements can lead to some pretty gnarly setups. Tell me about it via the comments.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/serving-custom-json-from-your-rails-api-with-activemodel-serializers/">Serving Custom JSON From Your Rails API With ActiveModel::Serializers</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-03-01T06:23:01-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/active-model-serializers">Engine Yard</a>.</p>

<h1>Introduction</h1>

<p>These days, there are so many different choices when it comes to serving data from an API. You can build it in Node with <a href="http://expressjs.com/">ExpressJS</a>, in Go with <a href="http://martini.codegangsta.io/">Martini</a>, Clojure with <a href="https://github.com/weavejester/compojure">Compojure</a>, and many more. But in many cases, you just want to bring something to market as fast as you can. For those times, I still reach for <a href="http://rubyonrails.org/">Ruby on Rails</a>.</p>

<p>With Rails, you can spin up a function API server in a very short period of time. Rails is large. Perhaps you object that there&rsquo;s &ldquo;too much magic&rdquo;. Have you ever checked out the <a href="https://github.com/rails-api/rails-api">rails-api gem</a>? It lets you enjoy all the benefits of Rails without including unnecessary view-layer and asset-related code.</p>

<p>Rails-api is maintained by <a href="https://github.com/carlosantoniodasilva">Carlos Antonio Da Silva</a>, <a href="https://github.com/spastorino">Santiago Pastorino</a>, Rails Core team members, and all-around great Rubyist <a href="http://www.steveklabnik.com/">Steve Klabnik</a>. While not busy working on Rails or the Rails API Gem, they found the time to put together the <a href="https://github.com/rails-api/active_model_serializers">active_model_serializers gem</a> to make it easier to format JSON responses when using Rails as an API server.</p>

<p>ActiveModel::Serializers (AMS) is a powerful alternative to <a href="https://github.com/rails/jbuilder">jbuilder</a>, <a href="https://github.com/nesquena/rabl">rabl</a>, and other Ruby templating solutions. It&rsquo;s easy to get started with, but when you want to serve data that quite doesn&rsquo;t match up with the way ActiveRecord (AR) structures things, it can be hard to figure out how to get it to do what you want.</p>

<p>In this post, we&rsquo;ll take a look at how to extend AMS to serve up custom data in the context of a Rails-based chat app.</p>

<h2>Kicking It Off: Setting Up a Rails Server</h2>

<p>Any two users in the system can have a continuous thread that goes back and forth. Let&rsquo;s imagine we are building a chat app, similar to Apple&rsquo;s Messages. People can sign up for the service, then chat with their friends.</p>

<p>Most of the presentation logic will happen in a client-side JavaScript app. For now, we&rsquo;re only concerned with accepting and returning raw data, and we&rsquo;ve decided to use a Rails server to build it.</p>

<p>To get started, we&rsquo;ll run a <code>rails new</code>, but since we&rsquo;re using the <code>rails-api</code> gem, we&rsquo;ll need to make sure we have it installed first, with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install rails-api</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s done, we&rsquo;ll run the following (familiar) command to start the project:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails-api new mensajes --database=postgresql</span></code></pre></td></tr></table></div></figure>


<p><code>cd</code> into the directory and setup the database with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:create</span></code></pre></td></tr></table></div></figure>


<h2>Creating the Models</h2>

<p>We&rsquo;ll need a couple of models: <code>User</code>s and <code>Messages</code>. The workflow to create them should be fairly familiar:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g scaffold user username:string
</span><span class='line'>rails g scaffold message sender_id:integer recipient_id:integer body:text</span></code></pre></td></tr></table></div></figure>


<p>Open up the migrations, and set everything to <code>null: false</code>, then run <code>rake db:migrate</code>.</p>

<p>We&rsquo;ll also need to set up the relationships. Be sure to test these relationships (I would suggest using the <a href="https://github.com/thoughtbot/shoulda-matchers">shoulda gem</a> to make it easy on yourself.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  has_many :sent_messages, class_name: "Message", foreign_key: "sender_id"
</span><span class='line'>  has_many :received_messages, class_name: "Message", foreign_key: "recipient_id"
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Message &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :recipient, class_name: "User", inverse_of: :received_messages
</span><span class='line'>  belongs_to :sender, class_name: "User", inverse_of: :sent_messages
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h2>Serving the Messages</h2>

<p>Let&rsquo;s send some messages! Imagine for a minute that you&rsquo;ve already set up some kind of token-based authentication system, and you have some way of getting ahold of the user that is making requests to your API.</p>

<p>We can open up the <code>MessagesController</code>, and since we used a <code>scaffold</code>, we should already be able to view all the messages. Let&rsquo;s scope that to the current user. First we&rsquo;ll write a convenience method to get all the sent and received messages for a user, then we&rsquo;ll rework the <code>MessagesController</code> to work the way we want it to.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  ...
</span><span class='line'>  def messages
</span><span class='line'>    Message.where("sender_id = ? OR recipient_id = ?", self.id, self.id)
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessagesController &lt; ApplicationController
</span><span class='line'>  def index
</span><span class='line'>    @messages = current_user.messages
</span><span class='line'>    render json: @messages
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Assuming that we have created a couple of sent and received messages for the <code>current_user</code>, we should be able to take a look at <code>http://localhost:3000/messages</code> and see some raw JSON that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"sender_id":1,"id":1,"recipient_id":2,"body":"YOLO","created_at":"2015-02-03T21:05:12.908Z","updated_at":"2015-02-03T21:05:12.908Z"},{"recipient_id":1,"id":2,"sender_id":2,"body":"Hello, world!","created_at":"2015-02-03T21:05:51.309Z","updated_at":"2015-02-03T21:05:51.309Z"}]</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s kind of ugly. It would be nice if we could remove the timestamps and ids. This is where AMS comes in.</p>

<h2>Adding ActiveModel::Serializers</h2>

<p>Once we add AMS to our project, it should be easy to get a much prettier JSON format back from our <code>MessagesController</code>.</p>

<p>To get AMS, add it to the <code>Gemfile</code> with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem "active_model_serializers", github: "rails-api/active_model_serializers"
</span></code></pre></td></tr></table></div></figure>


<p>Then <code>bundle install</code>. Note that I&rsquo;m using a the edge version of AMS here because it supports <code>belongs_to</code> and other features. See the <a href="https://github.com/rails-api/active_model_serializers/blob/master/README.md">github project README</a> for some information about maintenance and why you might want to use an older version.</p>

<p>Now we can easily set up a serializer with <code>rails g serializer message</code>. Let&rsquo;s take a look at what this generated for us. In <code>app/serializers/message_serializer.rb</code>, we find this code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessageSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :id
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Whichever <code>attributes</code> we specify (as a list of symbols) will be returned in the JSON response. Let&rsquo;s skip <code>id</code>, and instead return the <code>sender_id</code>, <code>recipient_id</code>, and <code>body</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessageSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :sender_id, :recipient_id, :body
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now when we visit <code>/messages</code>, we get this slightly cleaner JSON:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{"messages":[{"sender_id":1,"recipient_id":2,"body":"YOLO"},{"sender_id":2,"recipient_id":1,"body":"Hello, world!"}]}</span></code></pre></td></tr></table></div></figure>


<h2>Cleaning Up the Format</h2>

<p>It sure would be nice if we could get more information about the other user, like their username, so that we could display it in the messaging UI on the client-side. That&rsquo;s easy enough, we just change the <code>MessageSerializer</code> to use AR objects as attributes for the <code>sender</code> and <code>recipient</code>, instead of <code>id</code>s.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessageSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :sender, :recipient, :body
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now we can see more about the Sender and Recipient:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{"messages":[{"sender":{"id":1,"username":"Ben","created_at":"2015-02-03T21:04:09.220Z","updated_at":"2015-02-03T21:04:09.220Z"},"recipient":{"id":2,"username":"David","created_at":"2015-02-03T21:04:45.948Z","updated_at":"2015-02-03T21:04:45.948Z"},"body":"YOLO"},{"sender":{"id":2,"username":"David","created_at":"2015-02-03T21:04:45.948Z","updated_at":"2015-02-03T21:04:45.948Z"},"recipient":{"id":1,"username":"Ben","created_at":"2015-02-03T21:04:09.220Z","updated_at":"2015-02-03T21:04:09.220Z"},"body":"Hello, world!"}]}</span></code></pre></td></tr></table></div></figure>


<p>Actually, that might be too much. Let&rsquo;s clean up how <code>User</code> objects are serialized by generating a User serializer with <code>rails g serializer user</code>. We&rsquo;ll set it up to just return the username.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class UserSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :username
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>In the <code>MessageSerializer</code>, we&rsquo;ll use <code>belongs_to</code> to have AMS format our <code>sender</code> and <code>recipient</code> using the <code>UserSerializer</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessageSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :body
</span><span class='line'>  belongs_to :sender
</span><span class='line'>  belongs_to :recipient
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>If we take a look at <code>/messages</code>, we now see:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"recipient":{"username":"David"},"body":"YOLO","sender":{"username":"Ben"}},{"recipient":{"username":"Ben"},"body":"Hello, world!","sender":{"username":"David"}}]</span></code></pre></td></tr></table></div></figure>


<p>Things are really starting to come together!</p>

<h2>Conversations</h2>

<p>Although we can view all of a user&rsquo;s messages using the <code>index</code> controller action, or a specific message at the <code>show</code> action, there&rsquo;s something important to the business logic of our app that we can&rsquo;t do. We can&rsquo;t view all of the messages sent between two users. We need some concept of a <code>conversation</code>.</p>

<p>When thinking about creating a conversation, we have to ask, does this model need to be stored in the database? I think the answer is no. We already have messages that know which users they belong to. All we really need is a way to get back all the messages between two users from one endpoint.</p>

<p>We can use a Plain Old Ruby Object (PORO) to create this concept of a <code>conversation</code> model. We will <em>not</em> inherit from <code>ActiveRecord::Base</code> in this case.</p>

<p>Since we already know about the <code>current_user</code>, we really only need it to keep track of the other user. We&rsquo;ll call her the <code>participant</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># app/models/conversation.rb
</span><span class='line'>class Conversation
</span><span class='line'>  attr_reader :participant, :messages
</span><span class='line'>
</span><span class='line'>  def initialize(attributes)
</span><span class='line'>    @participant = attributes[:participant]
</span><span class='line'>    @messages = attributes[:messages]
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll want to be able to serve up these conversations, so we&rsquo;ll need a <code>ConversationsController</code>. We want to get all of the conversations for a given user, so we&rsquo;ll add a class-level method to the <code>Conversation</code> model to find them and return them in this format:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># TODO: Insert JSON blob here</span></code></pre></td></tr></table></div></figure>


<p>To make this work, we&rsquo;ll run a <code>group_by</code> on the user&rsquo;s messages, grouping by the <em>other</em> user&rsquo;s id. We&rsquo;ll then map the resulting hash into a collection of <code>Conversation</code> objects, passing in the other user and the list of messages.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Conversation
</span><span class='line'>  ...
</span><span class='line'>  def self.for_user(user)
</span><span class='line'>    user.messages.group_by { |message|
</span><span class='line'>      if message.sender == user
</span><span class='line'>        message.recipient_id
</span><span class='line'>      else
</span><span class='line'>        message.sender_id
</span><span class='line'>      end
</span><span class='line'>    }.map do |user_id, messages|
</span><span class='line'>      Conversation.new({
</span><span class='line'>        participant: User.find(user_id),
</span><span class='line'>        messages: messages
</span><span class='line'>      })
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>If we run this in the Rails Console, it seems to be working.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;Conversation.for_user(User.first)
</span><span class='line'>...
</span><span class='line'>=&gt; [#&lt;Conversation:0x007fbd6e5b9428 @participant=#&lt;User id: 2, username: "David", created_at: "2015-02-03 21:04:45", updated_at: "2015-02-03 21:04:45"&gt;, @messages=[#&lt;Message id: 1, sender_id: 1, recipient_id: 2, body: "YOLO", created_at: "2015-02-03 21:05:12", updated_at: "2015-02-03 21:05:12"&gt;, #&lt;Message id: 2, sender_id: 2, recipient_id: 1, body: "Hello, world!", created_at: "2015-02-03 21:05:51", updated_at: "2015-02-03 21:05:51"&gt;]&gt;]</span></code></pre></td></tr></table></div></figure>


<p>Great! We&rsquo;ll just call this method in our <code>ConversationsController</code> and everything will be great!</p>

<p>First, we&rsquo;ll define the route in <code>config/routes.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Rails.application.routes.draw do
</span><span class='line'>  ...
</span><span class='line'>  resources :conversations, only: [:index]
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Then, we&rsquo;ll write the controller action.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># app/controllers/conversations_controller.rb
</span><span class='line'>
</span><span class='line'>class ConversationsController &lt; ApplicationController
</span><span class='line'>  def index
</span><span class='line'>    conversations = Conversation.for_user(current_user)
</span><span class='line'>    render json: conversations
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Visiting <code>/conversations</code>, we should see a list of all the conversations for the current user.</p>

<h2>Serializing Plain Old Ruby Objects</h2>

<p>Whoops! When we visit that route, we get an error: <code>undefined method</code>new&#8217; for nil:NilClass`. It&rsquo;s coming from this line in the controller:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>render json: conversations</span></code></pre></td></tr></table></div></figure>


<p>It looks like the error is coming from the fact that we don&rsquo;t have a serializer. Let&rsquo;s make one with <code>rails g serializer conversation</code>. We&rsquo;ll edit it to return its attributes, <code>participant</code> and <code>message</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class ConversationSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :participant, :messages
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now when we try, we get another error, coming from the same line of the controller: <code>undefined method 'read_attribute_for_serialization' for #&lt;Conversation:0x007ffc9c1bed10&gt;</code></p>

<p>Digging around in the source code for ActiveModel::Serializers, I couldn&rsquo;t find where that method was defined. So I took a look at ActiveModel itself, and found it <a href="https://github.com/rails/rails/blob/08754f12e65a9ec79633a605e986d0f1ffa4b251/activemodel/lib/active_model/serialization.rb#L141">here</a>. It turns out that it&rsquo;s just an alias for <code>send</code>!</p>

<p>We can add that into our PORO easily enough:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Conversation
</span><span class='line'>  alias :read_attribute_for_serialization :send
</span><span class='line'>  ...
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Or, we could <code>include ActiveModel::Serialization</code> which is where our AR-backed objects got it.</p>

<p>Now when we take a look at <code>/conversations</code>, we get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"participant":{"id":2,"username":"David","created_at":"2015-02-03T21:04:45.948Z","updated_at":"2015-02-03T21:04:45.948Z"},"messages":[{"sender_id":1,"recipient_id":2,"id":1,"body":"YOLO","created_at":"2015-02-03T21:05:12.908Z","updated_at":"2015-02-03T21:05:12.908Z"},{"sender_id":2,"id":2,"recipient_id":1,"body":"Hello, world!","created_at":"2015-02-03T21:05:51.309Z","updated_at":"2015-02-03T21:05:51.309Z"}]}]</span></code></pre></td></tr></table></div></figure>


<p>Whoops. Not quite right. But the problem is similar to the one we had before in the <code>MessageSerializer</code>. Maybe the same approach will work. We&rsquo;ll change the <code>attributes</code> to AR relationships.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class ConversationSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  has_many :messages, class_name: "Message"
</span><span class='line'>  belongs_to :participant, class_name: "User"
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Almost! Now <code>/conversations</code> returns:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"messages":[{"body":"YOLO"},{"body":"Hello, world!"}],"participant":{"username":"David"}}]</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t see who the sender of each message was! AMS isn&rsquo;t using the <code>UserSerializer</code> for the message sender and recipient, because we&rsquo;re not using an AR object.</p>

<p>A little <a href="https://github.com/rails-api/active_model_serializers/blob/master/lib/active_model/serializer.rb#136">source code</a> spelunking point the way to a fix.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MessageSerializer &lt; ActiveModel::Serializer
</span><span class='line'>  attributes :body, :recipient, :sender
</span><span class='line'>
</span><span class='line'>  def sender
</span><span class='line'>    UserSerializer.new(object.sender).attributes
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  def recipient
</span><span class='line'>    UserSerializer.new(object.recipient).attributes
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now <code>/conversations</code> gives us what we want:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"messages":[{"body":"YOLO","recipient":{"username":"David"},"sender":{"username":"Ben"}},{"body":"Hello, world!","recipient":{"username":"Ben"},"sender":{"username":"David"}}],"participant":{"username":"David"}}]</span></code></pre></td></tr></table></div></figure>


<p>And <code>/messages</code> still works as well!</p>

<h2>Wrapping Up</h2>

<p>The ActiveModel::Serializers gem claims to bring &ldquo;convention over configuration to your JSON generation&rdquo;. It does a great job of it, but when you need to massage the data, things can get a little bit hairy.</p>

<p>Hopefully some of the tricks we&rsquo;ve covered will help you present JSON from your Rails API the way you want. For this, and virtually any other problem caused by <em>the magic</em> getting in the way, I can&rsquo;t suggest digging through the source code enough.</p>

<p>At the end of the day ARS is an excellent choice for getting your JSON API off the ground with a minimum of fuss. Good luck!</p>

<p>P.S. Have a different approach? Prefer <code>rabl</code> or <code>jbuilder</code>? Did I leave something out? Leave us a comment below!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/02/26/getting-started-with-ruby-processing/">Getting Started With Ruby Processing</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-02-26T06:20:55-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post was a featured article in <a href="http://rubyweekly.com/issues/234">Ruby Weekly #234</a>.</p>

<p>It was originally published on <a href="https://blog.engineyard.com/2015/getting-started-with-ruby-processing">Engine Yard</a>.</p>

<h1>Introduction</h1>

<p>If you&rsquo;re like me, you love to code because it is a creative process. In another life, I am a musician.</p>

<p>I&rsquo;ve always loved music because it represents a synthesis of the measurable concreteness of math and the ambiguity of language. Programming is the same way.</p>

<p>But desipite the creative potential of programming, I often myself spending my days working out the kinks of HTTP requests or dealing with SSL certificates. Some part of my yearns for a purely <a href="http://en.wikipedia.org/wiki/Apollonian_and_Dionysian">Apollonion</a> environment in which to use code to make something new and unseen.</p>

<p>When I feel a void for purely creative coding, I turn to the <a href="https://processing.org/">Processing language</a>. Processing is a simple language, based on Java, that you can use to create digital graphics. It&rsquo;s easy to learn, fun to use, and has an amazing online community comprised of programmers, visual artists, musicians, and interdiscplinary artists of all kinds.</p>

<p>In 2009, <a href="https://twitter.com/jashkenas">Jeremy Ashkenas</a>, creator of Backbone.JS, Underscore.JS, and Coffeescript), published the <a href="https://rubygems.org/gems/ruby-processing">ruby-processing gem</a>. It wraps Processing in a &ldquo;thin little shim&rdquo; that makes it even easier to get started as a Ruby developer. In this post, we&rsquo;ll take a look at how you can create your first interactive digital art project in just a few minutes.</p>

<h2>What Is Processing?</h2>

<p>Processing is programming language and IDE built by <a href="http://reas.com/">Casey Reas</a> and <a href="http://benfry.com/">Benjamin Fry</a>, two protegés of indisciplinary digital art guru <a href="http://www.maedastudio.com/">John Maeda</a> at the MIT Media Lab.</p>

<p>Since the project began in 2001, it&rsquo;s been helping teach people to program in a visual art context using a simplified version of Java. It comes packaged as an <a href="https://processing.org/download/">IDE</a> that can be downloaded and used to create and save sketches.</p>

<h2>Why Ruby Processing?</h2>

<p>Since Processing already comes wrapped in an easy-to-use package, you may ask: &ldquo;why should I bother with Ruby Processing?&rdquo;</p>

<p>The answer: if you know how to write Ruby, you can use Processing as a visual interface to a much more complex program. Games, interactive art exhibits, innovative music projects, anything you can imagine; it&rsquo;s all at your fingertips.</p>

<p>Additionally, you don&rsquo;t have to declare types, <code>void</code>s, or understand the differences between <code>float</code>s and <code>int</code>s to get started.</p>

<p>Although there are some drawbacks to using Ruby Processing, most notably slower performance, having Ruby&rsquo;s API available to translate your ideas into sketches more than makes up for it.</p>

<h2>Setup</h2>

<p>When getting started with Ruby Processing for the first time, it can be a little bit overwhelming to get all of the dependencies set up correctly. The gem relies on JRuby, Processing, and a handful of other things. Here&rsquo;s how to get them all installed and working.</p>

<p>I&rsquo;ll assume you already have the following installed: homebrew, wget, java, and a ruby manager such as rvm, rbenv or chruby.</p>

<h3>Processing</h3>

<p><a href="https://www.processing.org/download/">Download Processing</a> from the official website and install it.</p>

<p>When you&rsquo;re done, make sure that the resulting app is located in your <code>/Applications</code> directory.</p>

<h3>JRuby</h3>

<p>Although it&rsquo;s possible to run Ruby Processing on the <a href="http://en.wikipedia.org/wiki/Ruby_MRI">MRI</a>, I highly suggest using JRuby. It works much better, since Processing itself is built on Java.</p>

<p>Install the latest JRuby version (1.7.18 at the time of this writing). For example, if you&rsquo;re using <code>rbenv</code>, the command would be <code>rbenv install jruby-1.7.18</code>, followed by <code>rbenv global jruby-1.7.18</code> to set your current ruby to JRuby.</p>

<h3>Ruby Processing</h3>

<p>Install the <code>ruby-processing</code> gem globally with <code>gem install ruby-processing</code>.
If you&rsquo;re using <code>rbenv</code>, don&rsquo;t forget to run <code>rbenv rehash</code>.</p>

<h3>JRuby Complete</h3>

<p>You&rsquo;ll need the <code>jruby-complete</code> Java jar. Fortunately, there are a couple of built-in Ruby Processing commands that make it easy to install. <code>rp5</code> is the Ruby Processing command. It can be used to do many things, one of which is to install <code>jruby-complete</code> using <code>wget</code>. To do so, run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rp5 setup install</span></code></pre></td></tr></table></div></figure>


<p>Once it&rsquo;s complete, you can use <code>rp5 setup check</code> to make sure everything worked.</p>

<h3>Setup Processing Root</h3>

<p>One final step. You&rsquo;ll need to set the root of your Processing app. This one-liner should take care of it for you:</p>

<p><code>echo 'PROCESSING_ROOT: /Applications/Processing.app/Contents/Java' &gt;&gt; ~/.rp5rc</code></p>

<h3>Ready To Go</h3>

<p>Now that we have everything installed and ready to go, we can start creating our first piece of art!</p>

<h2>Making Your First Sketch</h2>

<p>There are two basic parts to a Processing program: <code>setup</code> and <code>draw</code>.</p>

<p>The code in <code>setup</code> runs one time, to get everything ready to go.</p>

<p>The code in <code>draw</code> runs repeatedly in a loop. How fast is the loop? By default, it&rsquo;s 60 frames per second, although it can be limited by your machine&rsquo;s processing power. You can also manipulate it with the <code>frame_rate</code> method.</p>

<p>Here&rsquo;s an example sketch that sets the window size, background and stroke colors, and draws a circle with a square around it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>  <span class="n">size</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span>
</span><span class='line'>  <span class="n">background</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">stroke</span> <span class="mi">255</span>
</span><span class='line'>  <span class="n">no_fill</span>
</span><span class='line'>  <span class="n">rect_mode</span> <span class="no">CENTER</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw</span>
</span><span class='line'>  <span class="n">ellipse</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span>
</span><span class='line'>  <span class="n">rect</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s a quick run-through of what each of these methods is doing:</p>

<p>-<code>size()</code>: Sets the window size. It takes two arguments: width and height (in pixels).
-<code>background()</code>: Sets the background color. It takes four arguments: R, G, B, and an alpha (opacity) value.
-<code>stroke()</code>: Sets the stroke color. Takes RGBA arguments, like <code>background()</code>.
-<code>no_fill()</code>: Tells Processing not to fill in shapes with the fill color. You can turn it back on with <code>fill()</code>, which takes RGBA values.
-<code>rect_mode</code>: Tells Processing to draw rectangles using the x and y coordinates as a center point, with the other two arguments specifying width and height. The other <a href="https://processing.org/reference/rectMode_.html">available modes</a> are: CORNER, CORNERS, and RADIUS.
-<code>ellipse</code>: Draws an ellipse or circle. Takes four arguments: x-coordinate, y-coordinate, width, and height.
-<code>rect</code>: Draws a rectangle or square. Takes four arguments: x-coordinate, y-coordinate, width, and height.</p>

<p>Note that the coordinate system in Processing starts at the top-left corner, not in the middle as in the Cartesian Coordinate System.</p>

<h2>Running the Program</h2>

<p>If you&rsquo;re following along at home, let&rsquo;s see what we&rsquo;ve made! Save the code above into a file called <code>my_sketch.rb</code>.</p>

<p>There are two ways to run your program: you can either have it run once with <code>rp5 run my_sketch.rb</code>, or you can watch the filesystem for changes with <code>rp5 watch my_sketch.rb</code>. Let&rsquo;s just use the <code>run</code> version for now.</p>

<p><img src="http://i.imgur.com/VhQo15W.png"/></p>

<p>Pretty basic, but it&rsquo;s a good start! Using just the seven methods above, you can create all kinds of sketches.</p>

<h2>Other Commonly Used Methods</h2>

<p>Here are a few other useful Processing methods to add to your toolbox:</p>

<p>-<code>line()</code>: Draws a line. Takes four argments: x1, y1, x2, y2. The line is drawn from the point at the x, y coordinates of the first two arguments to the point at the coordinates of the last two arguments.
-<code>stroke_weight()</code>: Sets the width of the stroke in pixels.
-<code>no_stroke()</code>: Tells Processing to draw shapes without outlines.
-<code>smooth()</code>: Tells Processing to draw shapws with anti-aliased edges. On by default, but can be disables with <code>noSmooth()</code>.
-<code>fill()</code>: Sets the fill color of shapes. Takes RGBA arguments.</p>

<p>For a list of all the methods available in vanilla Processing, check out <a href="https://www.processing.org/reference/">this list</a>. Note that the Java implementation of these methods is in <code>camelCase</code>, but in Ruby they are <em>probably</em> in <code>snake_case</code>.</p>

<p><a href="https://github.com/jashkenas/ruby-processing/wiki/Deprecation-of-methods">Some methods have also been deprecated</a>, usually because you can use Ruby to do the same thing more easily.</p>

<p>If you see anything in the Processing docs and can&rsquo;t get it to run in Ruby Processing, use <code>$app.find_method("foo")</code> to to search the method names available in Ruby Processing.</p>

<h2>Responding to Input</h2>

<p>Now that we know how to make a basic sketch, let&rsquo;s build something that can respond to user input. This is where we leave static visual art behind, and start to make interactive digital art.</p>

<p>Although you can use all kinds of physical inputs to control Processing (e.g. Arduino, Kinect, LeapMotion), today we&rsquo;ll just use the mouse.</p>

<p>Processing exposes a number of variables exposing its state at runtime, such as <code>frame_count</code>, <code>width</code>, <code>height</code>. We can use the <code>mouse_x</code> and <code>mouse_y</code> coordinates to control aspects of our program.</p>

<p>Here&rsquo;s a sketch based on the <code>mouse_x</code> and <code>mouse_y</code> positions. It draws lines of random weight starting at the top of the screen at the mouse&rsquo;s x position (<code>mouse_x, 0</code>) to a y coordinate between 0 and 200 pixels to the right of the mouse&rsquo;s y position (<code>mouse_y + offset, height</code>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>  <span class="n">size</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span>
</span><span class='line'>  <span class="n">background</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">stroke</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">60</span> <span class="c1"># first argument is grayscale value, second is opacity</span>
</span><span class='line'>  <span class="n">frame_rate</span> <span class="mi">8</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">draw</span>
</span><span class='line'>  <span class="n">r</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span class='line'>  <span class="n">stroke_weight</span> <span class="n">r</span>
</span><span class='line'>  <span class="n">offset</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">10</span>
</span><span class='line'>  <span class="n">line</span> <span class="n">mouse_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mouse_y</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">height</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Load that up and check it out!</p>

<p><img src="http://i.imgur.com/HkS0XiH.png" /></p>

<h2>Wrapping Your Sketch in a Class</h2>

<p>One last not before we go: you can totally call other methods from within your <code>setup</code> and <code>draw</code> methods. In fact, you can even wrap everything in a class that inherits from <code>Processing::App</code>.</p>

<p>You can do everything you normally do in Ruby, so you can build a whole project, with logic branches and state, that controls the visual effect through these two methods.</p>

<p>Here&rsquo;s a snippet from a version of Tic Tac Toe I built with <a href="https://twitter.com/RolenTLe">Rolen Le</a> during gSchool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;ruby-processing&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TicTacToe</span> <span class="o">&lt;</span> <span class="no">Processing</span><span class="o">::</span><span class="no">App</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:current_player</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>    <span class="n">size</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span>
</span><span class='line'>    <span class="n">background</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@current_player</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">draw</span>
</span><span class='line'>    <span class="n">create_lines</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_lines</span>
</span><span class='line'>    <span class="n">stroke</span> <span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">666</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">488</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">488</span><span class="p">,</span> <span class="mi">666</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">301</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">488</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">488</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#borders</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">133</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">666</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">666</span>
</span><span class='line'>    <span class="n">line</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">666</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To see the rest of the code, visit the <a href="https://github.com/fluxusfrequency/tic-tac-toe">GitHub repo</a>.</p>

<p>Another example of a game I built early on in my programming career can be found <a href="https://github.com/fluxusfrequency/mancala">here</a>. I later did a <a href="http://fluxusfrequency.github.io/blog/2014/01/17/refactoring-2-replace-method-with-method-object/">series</a> of <a href="http://fluxusfrequency.github.io/blog/2014/01/18/refactoring-3-introduce-named-parameter-and-introduce-class-annotation/">refactorings</a> of this <a href="http://fluxusfrequency.github.io/blog/2014/01/27/refactoring-4-remove-middle-man/">code</a> on my <a href="http://fluxusfrequency.github.io/blog/archives/">personal blog</a>.</p>

<p>I&rsquo;m still working on a pattern for game development with that I like. Keep an eye out for future posts about the best way to build a game with Ruby Processing.</p>

<h2>Learning More</h2>

<p>There&rsquo;s so much more you can do in Processing than what we&rsquo;ve covered here! Bézier curves, translations, rotations, images, fonts, audio, video, and 3D sketching are all available.</p>

<p>The best way to figure out how to do a lot of sketching. Just tinkering with the methods covered in this post would be enough to keep you busy creating new things for years.</p>

<p>If you&rsquo;ve really caught the bug and want to go even <em>deeper</em>, check out some of these resources to learn more.</p>

<h3>Built-in Samples</h3>

<p>If you run <code>rp5 setup unpack_samples</code>, you&rsquo;ll get a bunch of Processing sketch samples in a directory located at <code>~/rp_samples</code>. I encourage you to open them up and take a look. There&rsquo;s a lot you can glean by changing little bits of code in other projects.</p>

<h3>Online Examples From Books</h3>

<p>Learning Processing is an excellent book by Daniel Shiffman. In addition to being a valuable resource for Processing users, it has a number of <a href="http://www.learningprocessing.com/examples/">examples available online</a>.</p>

<p>Daniel Shiffman also wrote a book called <a href="http://natureofcode.com/">The Nature of Code</a>. The examples from it have been <a href="https://github.com/ruby-processing/The-Nature-of-Code-Examples-in-Ruby">ported to Ruby</a> and are another great resource for learning more.</p>

<h3>Process Artist</h3>

<p>There&rsquo;s a great Jumpstart Lab tutorial called <a href="http://tutorials.jumpstartlab.com/projects/process_artist.html">Process Artist</a>, that walks you through building a drawing program à la MSPaint.</p>

<h2>Conclusion</h2>

<p>Processing is an awesome multi-disciplinary tool. It sits at the intersection of coding, visual art, photography, sound art, and interactive digital experiences. With the availability of Ruby Processing, it&rsquo;s super easy to get started.</p>

<p>If you&rsquo;re a programmer looking for a way to express your creativity, you couldn&rsquo;t find a better way to do it than to try tinkering with Processing. I hope this post gets you off to a great start. Good luck and keep sketching!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2015/02/04/setting-up-a-client-side-javascript-project-with-gulp-and-browserify/">Setting Up a Client-Side JavaScript Project With Gulp and Browserify</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2015-02-04T21:17:21-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post originally appeared on <a href="https://blog.engineyard.com/2015/client-side-javascript-project-gulp-and-browserify">Engine Yard</a>.</p>

<h2>Introduction</h2>

<p>For JavaScript developers, it can be hard to keep up to date with the latest frameworks and libraries. It seems like every day there&rsquo;s a new <em>something</em>.js to check out. Luckily, there is one part of the toolchain that doesn&rsquo;t change as often, and that&rsquo;s the build process. That said, it&rsquo;s worth checking out your options every now and then.</p>

<p>My build process toolset has traditionally been comprised of <a href="http://requirejs.org/">RequireJS</a> for dependency loading, and <a href="http://gruntjs.com/">Grunt</a>. They&rsquo;ve worked great, but recently I was pairing with someone who prefers to use <a href="http://gulpjs.com/">Gulp</a> and <a href="http://browserify.org/">Browserify</a> instead. After using them on a couple of projects, I&rsquo;m coming to like them quite a bit. They&rsquo;re great for use with Backbone, Angular, Ember, React, and my own hand-rolled JavaScript projects.</p>

<p>In this post, we&rsquo;ll explore how to set up a clientside JavaScript project for success using Gulp and Browserify.</p>

<h2>Defining the Project Structure</h2>

<p>For the purposes of this post, we&rsquo;ll pretend we&rsquo;re building an app called Car Finder, that helps you remember where you parked your car. If you want to follow along, check out the <a href="https://github.com/fluxusfrequency/car-finder">code on GitHub</a>.</p>

<p>When building a full application that includes both an API server and a clientside JavaScript app, there&rsquo;s a certain project structure that I&rsquo;ve found often works well for me. I like to put my clientside app in a folder one level down from the root of my project, called <code>client</code>. This folder usually has sibling folders named <code>server</code>, <code>test</code>, <code>public</code>, and <code>build</code>. Here&rsquo;s how this would look for Car Finder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>car-finder
</span><span class='line'>|- build
</span><span class='line'>|- client
</span><span class='line'>   |- less
</span><span class='line'>|- public
</span><span class='line'>   |- javascripts
</span><span class='line'>   |- stylesheets
</span><span class='line'>|- server
</span><span class='line'>|- test</span></code></pre></td></tr></table></div></figure>


<p>The idea is to do our app developent inside of <code>client</code>, then use a build task to compile the JS and copy it to the <code>build</code> folder, where it will be minified, uglified, and copied to <code>public</code> to be served by the backend.</p>

<h2>Pulling In Dependencies</h2>

<p>To get up and running, we&rsquo;ll need to pull in some dependencies.</p>

<p>Run <code>npm init</code> and follow the prompts.</p>

<p>Add <code>browserify</code>, <code>gulp</code>, and our build and testing dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install --save-dev gulp gulp-browserify browserify-shim gulp-jshint gulp-mocha-phantomjs <span class="se">\</span>
</span><span class='line'>gulp-rename gulp-uglify gulp-less gulp-autoprefixer gulp-minify-css mocha chai
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re using git, you may want to ignore your <code>node_modules</code> folder with <code>echo "node_modules" &gt;&gt; .gitignore</code>.</p>

<h2>Shimming Your Frameworks</h2>

<p>You&rsquo;ll probably want to use <code>browserify-shim</code> to shim jQuery and your JavaScript framework so that you can write <code>var $ = require('jquery')</code> into your code. We&rsquo;ll use jQuery here, but the process is the same for any other library (Angular, Ember, Backbone, React, etc.). To set it up, modify your <code>package.json</code> like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;car-finder&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Ben Lewis&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;gulp-rename&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.2.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp&quot;</span><span class="p">:</span> <span class="s2">&quot;^3.8.10&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-mocha-phantomjs&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.5.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-jshint&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.9.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-browserify&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.5.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;browserify&quot;</span><span class="p">:</span> <span class="s2">&quot;^6.3.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;browserify-shim&quot;</span><span class="p">:</span> <span class="s2">&quot;^3.8.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;mocha&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-minify-css&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.3.11&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-uglify&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.0.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-autoprefixer&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;gulp-less&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.3.6&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;chai&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.10.0&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;browserify-shim&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;jquery&quot;</span><span class="p">:</span> <span class="s2">&quot;$&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;browserify&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;transform&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>      <span class="s2">&quot;browserify-shim&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re getting JSHint errors in your editor for this file, you can turn them off with <code>echo "package.json" &gt;&gt; .jshintignore</code>.</p>

<h2>Setting Up Gulp</h2>

<p>Now that we have the <code>gulp</code> package installed, we&rsquo;ll configure <code>gulp</code> tasks to lint our code, test it, trigger the compilation process, and copy our minified JS into the <code>public</code> folder.  We&rsquo;ll also set up a <code>watch</code> task that we can use to trigger a lint and recompile of our project whenever a source file is changed.</p>

<p>We&rsquo;ll start by requiring the <code>gulp</code> packages we want in a <code>gulpfile.js</code> that lives in the root of the project.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Gulp Dependencies</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">rename</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-rename&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Build Dependencies</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-browserify&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-uglify&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Style Dependencies</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">less</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-less&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-autoprefixer&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">minifyCSS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-minify-css&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Development Dependencies</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">jshint</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-jshint&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Test Dependencies</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">mochaPhantomjs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-mocha-phantomjs&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can start defining some tasks.</p>

<h3>JSHint</h3>

<p>To set up linting for our clientside code as well as our test code, we&rsquo;ll add the following to the <code>gulpfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;lint-client&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;./client/**/*.js&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;lint-test&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;./test/**/*.js&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll also need to define a <code>.jshintrc</code> in the root of our project, so that JSHint will know which rules to apply. If you have a JSHint plugin turned on in your editor, it will show you any linting errors as well. I use <a href="https://github.com/wookiehangover/jshint.vim">jshint.vim</a>. Here&rsquo;s an example of a typical <code>.jshintrc</code> for one of my projects. You&rsquo;ll notice that it has some predefined globals that we&rsquo;ll be using in our testing environment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;camelcase&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;curly&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;eqeqeq&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;expr&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;forin&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;immed&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;latedef&quot;</span><span class="p">:</span> <span class="s2">&quot;nofunc&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;newcap&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;noarg&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;node&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;nonbsp&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;quotmark&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;undef&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;unused&quot;</span><span class="p">:</span> <span class="s2">&quot;vars&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;trailing&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;globals&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;after&quot;</span>      <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;afterEach&quot;</span>  <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;before&quot;</span>     <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;beforeEach&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;context&quot;</span>    <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;describe&quot;</span>   <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;it&quot;</span>         <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;window&quot;</span>     <span class="p">:</span> <span class="kc">false</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Mocha</h3>

<p>I&rsquo;m a Test-Driven Development junkie, so one of the first things I always do when setting up a project is to make sure I have a working testing framework. For clientside unit testing, I like to use <a href="https://www.npmjs.org/package/gulp-mocha-phantomjs">gulp-mocha-phantomjs</a>, which we already pulled in above.</p>

<p>Before we can run any tests, we&rsquo;ll need to create a <code>test/client/index.html</code> file for Mocha to load up in the headless PhantomJS browser environment. It will pull Mocha in from our <code>node_modules</code> folder, require <code>build/client-test.js</code> (more on this in a minute), then run the scripts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>Mocha Test Runner<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;../../node_modules/mocha/mocha.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;mocha&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../node_modules/mocha/mocha.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span><span class="nx">mocha</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="s1">&#39;bdd&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../build/client-test.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">mochaPhantomJS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">mochaPhantomJS</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">mocha</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setting Up Browserify</h2>

<p>Now we need to set up Browserify to compile our code. First, we&rsquo;ll define a couple of <code>gulp</code> tasks: one to build the app, and one to build the tests. We&rsquo;ll copy the result of the compile to <code>public</code> so we can serve it unminified in development, and we&rsquo;ll also put a copy into <code>build</code>, where we&rsquo;ll grab it for minification. The  compiled test file will also go into <code>build</code>. Finally, we&rsquo;ll set up a <code>watch</code> task to trigger rebuilds of the app and test when one of the source files changes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;browserify-client&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lint-client&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;client/index.js&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">browserify</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">insertGlobals</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">}))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;car-finder.js&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">));</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;public/javascripts&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;browserify-test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lint-test&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;test/client/index.js&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">browserify</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">insertGlobals</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">}))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;client-test.js&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;client/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;browserify-client&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;test/client/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;browserify-test&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s one more thing we&rsquo;ll need to do before we can run our <code>gulp</code> tasks, which is to make sure we actually have <code>index.js</code> files in each of the folders we&rsquo;ve it to look at, so it doesn&rsquo;t raise an error. Add one to the <code>client</code> and <code>test/client</code> folders.</p>

<p>Now, when we run <code>gulp browserify-client</code> from the command line, we see new <code>build/car-finder.js</code> and <code>public/javascripts/car-finder.js</code> files. In the same way, <code>gulp browserify-test</code> creates a <code>build/client-test.js</code> file.</p>

<h2>More Testing</h2>

<p>Now that we have Browserify set up, we can finish getting our test environment up and running. Let&rsquo;s define a <code>test</code> Gulp task and add it to our <code>watch</code>. We&rsquo;ll add <code>browserify-test</code> as a dependency for the <code>test</code> task, so our <code>watch</code> will just require <code>test</code>. We should also update our watch to run the tests whenever we change any of the app <em>or</em> test files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lint-test&#39;</span><span class="p">,</span> <span class="s1">&#39;browserify-test&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;test/client/index.html&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mochaPhantomjs</span><span class="p">());</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;client/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;browserify-client&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;test/client/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>To verify that this is working, let&rsquo;s write a simple test in <code>test/client/index.js</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;chai&#39;</span><span class="p">).</span><span class="nx">expect</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;test setup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should work&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when we run <code>gulp test</code>, we should see Gulp run the <code>lint-test</code>, <code>browserify-test</code>, and <code>test</code> tasks and exit with one passing example. We can also test the <code>watch</code> task by running <code>gulp watch</code>, then making changes to <code>test/client/index.js</code> or <code>client/index.js</code>, which should trigger the tests.</p>

<h2>Building Assets</h2>

<p>Next, let&rsquo;s turn our attention to the rest of our build process. I like to use <code>less</code> for styling. We&rsquo;ll need a <code>styles</code> task to compile it down to CSS. In the process, we&rsquo;ll use <a href="https://www.npmjs.org/package/gulp-autoprefixer">gulp-autoprefixer</a> so that we don&rsquo;t have to write vendor prefixes in our CSS rules. As we did with the app, we&rsquo;ll create a development copy and a build copy, and place them in <code>public/stylesheets</code> and <code>build</code>, respectively. We&rsquo;ll also add the <code>less</code> directory to our <code>watch</code>, so changes to our styles will get picked up.</p>

<p>We should also uglify our JavaScript files to improve page load time. We&rsquo;ll write tasks for minification and uglification, then copy the minified production versions of the files to <code>public/stylesheets</code> and <code>public/javascripts</code>. Finally, we&rsquo;ll wrap it all up into a <code>build</code> task.</p>

<p>Here are the changes to the <code>gulpfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;styles&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;client/less/index.less&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">less</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">prefix</span><span class="p">({</span> <span class="nx">cascade</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;car-finder.css&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;public/stylesheets&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;minify&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;styles&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;build/car-finder.css&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">minifyCSS</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;car-finder.min.css&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;public/stylesheets&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;uglify&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;browserify-client&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;build/car-finder.js&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">uglify</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;car-finder.min.js&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;public/javascripts&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;uglify&#39;</span><span class="p">,</span> <span class="s1">&#39;minify&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we now run <code>gulp build</code>, we see the following files appear:
- <code>build/car-finder.css</code>
- <code>public/javascripts/car-finder.min.js</code>
- <code>public/stylesheets/car-finder.css</code>
- <code>public/stylesheets/car-finder.min.css</code></p>

<h2>Did It Work?</h2>

<p>We&rsquo;ll want to check that what we&rsquo;ve built is actually going to work.  Let&rsquo;s add a little bit of styling and JS code to make sure it&rsquo;s all getting compiled and served the way we hope it is. We&rsquo;ll start with an <code>index.html</code> file in the <code>public</code> folder. It will load up the development versions of our CSS and JS files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>Car Finder<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;stylesheets/car-finder.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;javascripts/car-finder.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll add some styling in <code>client/less/index.less</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="n">DarkOliveGreen</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll write our million dollar app in <code>client/index.js</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;I found your car!&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s put it all together. Run <code>grunt build</code>, then <code>open public/index.html</code>. Our default browser opens a beautiful olive green screen with an alert box. Profit!</p>

<h2>One Task To Rule Them All</h2>

<p>At this point, I usually like to tie it all together with a <code>default</code> Gulp task, so all I have to do is run <code>gulp</code> to check that everything&rsquo;s going together the way I expect, and start watching for changes. Since <code>test</code> already does the linting and browserifying, all we really need here is <code>test</code>, <code>build</code>, and <code>watch</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;watch&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Wrapping Up</h2>

<p>We&rsquo;ve now set up our project to use Browserify and Gulp. The former took the headache out of requiring modules and dependencies, and the latter made defining tasks for linting, testing, <code>less</code> compilation, minification, and uglification a breeze.</p>

<p>I hope you&rsquo;ve found this exploration of Gulp and Browserify has been enlightening. I personally love these tools. For the moment, they&rsquo;re my defaults when creating a personal project. I hope this post helps make your day-to-day development more fun by simplifying things. Thanks for reading!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/26/happy/">Happy, Sad, Evil, Weird: Putting Use Case Planning Into Practice</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/21/happy/">Happy, Sad, Evil, Weird: Driving Feature Development With Feature Planning</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/13/actually-mvp/">Actually MVP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/07/seven-unusual-ruby-datastores/">Seven Unusual Ruby Datastores</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/01/integrating-react-with-backbone/">Integrating React With Backbone</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 -  Ben Lewis <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
